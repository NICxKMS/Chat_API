self.onmessage=t=>{let{data:e}=t;const o=[],a=e.split("\n\n");for(const t of a)if(t.trim()&&!t.startsWith(":heartbeat")&&t.startsWith("data:")){const e=t.slice(5).trim();if("[DONE]"===e)o.push({isDone:!0});else try{var s;const t=JSON.parse(e),a=t.id&&t.model&&t.usage,n=t.content||"";let l=null;t.usage?l={promptTokens:t.usage.promptTokens,completionTokens:t.usage.completionTokens,totalTokens:t.usage.totalTokens}:null!==(s=t.raw)&&void 0!==s&&s.usageMetadata&&(l={promptTokens:t.raw.usageMetadata.promptTokenCount,completionTokens:t.raw.usageMetadata.candidatesTokenCount,totalTokens:t.raw.usageMetadata.totalTokenCount});const i=n.split(/\s+/).filter(Boolean).length;o.push({content:n,tokenCount:i,tokenInfo:l,finishReason:t.finishReason,model:t.model,provider:t.provider,isFinalChunk:a,rawChunk:t})}catch(t){}}self.postMessage(o)};