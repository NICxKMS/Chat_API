self.onmessage=o=>{let{data:e}=o;const t=[],s=e.split("\n\n");for(const o of s)if(o.trim()&&!o.startsWith(":heartbeat")&&o.startsWith("data:")){const e=o.slice(5).trim();if("[DONE]"===e)t.push({isDone:!0});else try{var a,n;const o=JSON.parse(e),s=o.id&&o.model&&o.usage,p=o.content||"";let u=null;if(null!==(a=o.raw)&&void 0!==a&&a.usage){var l,i,r;const e=o.raw.usage;u={promptTokens:null!==(l=e.prompt_tokens)&&void 0!==l?l:e.promptTokens,completionTokens:null!==(i=e.completion_tokens)&&void 0!==i?i:e.completionTokens,totalTokens:null!==(r=e.total_tokens)&&void 0!==r?r:e.totalTokens}}else o.usage?u={promptTokens:o.usage.promptTokens,completionTokens:o.usage.completionTokens,totalTokens:o.usage.totalTokens}:null!==(n=o.raw)&&void 0!==n&&n.usageMetadata&&(u={promptTokens:o.raw.usageMetadata.promptTokenCount,completionTokens:o.raw.usageMetadata.candidatesTokenCount,totalTokens:o.raw.usageMetadata.totalTokenCount});t.push({content:p,usage:u,finishReason:o.finishReason,model:o.model,provider:o.provider,isFinalChunk:s,rawChunk:o})}catch(o){}}self.postMessage(t)};