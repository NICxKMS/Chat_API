"use strict";(self.webpackChunkai_chat_interface=self.webpackChunkai_chat_interface||[]).push([[3326],{35016:(e,t,n)=>{n.d(t,{A:()=>r,O:()=>i});var o=n(65043),s=n(70579);const a=(0,o.createContext)(),r=()=>{const e=(0,o.useContext)(a);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},i=e=>{let{children:t}=e;const[r,i]=(0,o.useState)(null),[l,u]=(0,o.useState)(null),[c,d]=(0,o.useState)(!1),[m,p]=(0,o.useState)(null),[h,g]=(0,o.useState)(!1),[k,v]=(0,o.useState)(!1),f=(0,o.useCallback)((async()=>{g(!0)}),[g]),T=(0,o.useCallback)((async()=>{if(!k)return;const{getFirebaseAuth:e}=await Promise.all([n.e(3424),n.e(5171),n.e(4698),n.e(2702),n.e(8986),n.e(3815),n.e(8507)]).then(n.bind(n,91729)),{signOut:t}=await Promise.all([n.e(3424),n.e(5171),n.e(4698),n.e(2702),n.e(8986),n.e(3815),n.e(2991)]).then(n.bind(n,94135)),o=e();if(o)try{await t(o)}catch(e){p(e.message||"Failed to logout.")}else p("Firebase not initialized.")}),[k,p]);(0,o.useEffect)((()=>{let e=null;const t=()=>{v(!0),o()},o=async()=>{d(!0);const{getFirebaseAuth:t}=await Promise.all([n.e(3424),n.e(5171),n.e(4698),n.e(2702),n.e(8986),n.e(3815),n.e(8507)]).then(n.bind(n,91729)),{onAuthStateChanged:o}=await Promise.all([n.e(3424),n.e(5171),n.e(4698),n.e(2702),n.e(8986),n.e(3815),n.e(2991)]).then(n.bind(n,94135)),s=t();s?e=o(s,(async e=>{if(i(e),e)try{const t=await e.getIdToken();u(t);try{localStorage.setItem("idToken",t)}catch(e){}p(null),g(!1)}catch(e){p("Failed to get authentication token."),u(null);const{signOut:t}=await Promise.all([n.e(3424),n.e(5171),n.e(4698),n.e(2702),n.e(8986),n.e(3815),n.e(2991)]).then(n.bind(n,94135));await t(s)}else{u(null);try{localStorage.removeItem("idToken")}catch(e){}g(!1)}d(!1)})):d(!1)};return window.addEventListener("firebaseInitialized",t),()=>{window.removeEventListener("firebaseInitialized",t),"function"==typeof e&&e()}}),[]);const C=(0,o.useMemo)((()=>({currentUser:r,idToken:l,loading:c,error:m,login:f,logout:T,isAuthenticated:!!r&&!!l,isLoggingIn:h,setIsLoggingIn:g,isFirebaseInitialized:k})),[r,l,c,m,f,T,h,g,k]);return(0,s.jsx)(a.Provider,{value:C,children:t})}},36514:(e,t,n)=>{n.d(t,{A:()=>r,g:()=>i});var o=n(65043),s=n(70579);const a=(0,o.createContext)(),r=()=>{const e=(0,o.useContext)(a);if(void 0===e)throw new Error("useChatStatus must be used within a ChatStatusProvider");return e},i=e=>{let{children:t}=e;const[n,r]=(0,o.useState)(!1),[i,l]=(0,o.useState)(null),u=(0,o.useMemo)((()=>({isWaitingForResponse:n,setIsWaitingForResponse:r,error:i,setError:l})),[n,i]);return(0,s.jsx)(a.Provider,{value:u,children:t})}},52523:(e,t,n)=>{n.d(t,{v:()=>k});var o=n(65043),s=n(13005),a=n(91578),r=n(96377),i=n(20409),l=n(36514),u=n(52932),c=n(14255),d=n(71789),m=n(92503),p=n(92167),h=n(70579);const g=(0,o.createContext)(null),k=e=>{let{children:t}=e;const n=(0,o.useMemo)((()=>({isInitialized:!1,setInitialized:e=>{n.isInitialized=e}})),[]);return(0,o.useEffect)((()=>{n.setInitialized(!0)}),[n]),(0,h.jsx)(g.Provider,{value:n,children:(0,h.jsx)(s.N,{children:(0,h.jsx)(a.K,{children:(0,h.jsx)(r.lx,{children:(0,h.jsx)(i.Z,{children:(0,h.jsx)(l.g,{children:(0,h.jsx)(u.U,{children:(0,h.jsx)(c.b,{children:(0,h.jsx)(d.V,{children:(0,h.jsx)(m.h,{children:(0,h.jsx)(p.n,{children:t})})})})})})})})})})})}},52932:(e,t,n)=>{n.d(t,{U:()=>i,m:()=>r});var o=n(65043),s=n(70579);const a=(0,o.createContext)(),r=()=>{const e=(0,o.useContext)(a);if(void 0===e)throw new Error("useChatHistory must be used within a ChatHistoryProvider");return e},i=e=>{let{children:t}=e;const[n,r]=(0,o.useState)([]),i=(0,o.useRef)([]);(0,o.useEffect)((()=>{i.current=n}),[n]);const l=(0,o.useCallback)(((e,t,n)=>{const o={role:e,content:t,timestamp:Date.now(),...n&&{metrics:n}};return r((e=>[...e,o])),o}),[r]),u=(0,o.useCallback)((e=>{r((t=>{const n=t.length-1;if(n<0)return t;const o=t[n];if("assistant"!==o.role||o.content===e)return t;const s=[...t];return s[n]={...o,content:e},s}))}),[r]),c=(0,o.useMemo)((()=>({chatHistory:n,chatHistoryRef:i,setChatHistory:r,addMessageToHistory:l,updateChatWithContent:u})),[n,i,r,l,u]);return(0,s.jsx)(a.Provider,{value:c,children:t})}},83717:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});var o=n(65043),s=n(23232),a=n(70579);const r=e=>{let{size:t="medium",color:n}=e;const o=s.A[t]||s.A.medium,r=n?{borderTopColor:n}:{};return(0,a.jsx)("div",{className:`${s.A.spinnerContainer} ${o}`,children:(0,a.jsx)("div",{className:s.A.spinner,style:r,"aria-label":"Loading",role:"status"})})},i=o.memo(r)},91578:(e,t,n)=>{n.d(t,{K:()=>i,g:()=>r});var o=n(65043),s=n(70579);const a=(0,o.createContext)(),r=()=>{const e=(0,o.useContext)(a);if(void 0===e)throw new Error("useApi must be used within an ApiProvider");return e},i=e=>{let{children:t}=e;const[n]=(0,o.useState)("http://localhost:3000"),r=(0,o.useMemo)((()=>({apiUrl:n})),[n]);return(0,s.jsx)(a.Provider,{value:r,children:t})}},92167:(e,t,n)=>{n.d(t,{n:()=>k,r:()=>g});var o=n(65043),s=n(91578),a=n(96377),r=n(20409),i=n(35016),l=n(52932),u=n(36514),c=n(14255),d=n(71789),m=n(87164),p=n(70579);const h=(0,o.createContext)(),g=()=>{const e=(0,o.useContext)(h);if(void 0===e)throw new Error("useChatControl must be used within a ChatControlProvider");return e},k=e=>{let{children:t}=e;const n=(0,o.useRef)(null),{apiUrl:g}=(0,s.g)(),{selectedModel:k}=(0,a.fn)(),{settings:v,getModelAdjustedSettings:f}=(0,r.t)(),{idToken:T}=(0,i.A)(),{chatHistory:C,chatHistoryRef:y,setChatHistory:w,addMessageToHistory:b}=(0,l.m)(),{setIsWaitingForResponse:x,setError:j}=(0,u.A)(),{resetPerformanceMetrics:M,startPerformanceTimer:P,setTokenMetricsForLastMessage:S}=(0,c.B)(),{streamMessageWithFetch:I,stopStreaming:U}=(0,d.$)(),A=(0,o.useCallback)((e=>e&&e.provider&&e.id?`${e.provider}/${e.id}`:null),[]),R=(0,o.useCallback)(((e,t)=>{var n,o,s,a,r,i,l,u;return null!=e&&null!==(n=e.usage)&&void 0!==n&&n.completion_tokens?e.usage.completion_tokens:null!=e&&null!==(o=e.usage)&&void 0!==o&&o.completionTokens?e.usage.completionTokens:null!=e&&null!==(s=e.tokenUsage)&&void 0!==s&&s.output?e.tokenUsage.output:null!=e&&null!==(a=e.tokenUsage)&&void 0!==a&&a.total?e.tokenUsage.total:null!=e&&null!==(r=e.usage)&&void 0!==r&&r.total_tokens?e.usage.total_tokens:null!=e&&null!==(i=e.usage)&&void 0!==i&&i.totalTokens?e.usage.totalTokens:null!=e&&null!==(l=e.raw)&&void 0!==l&&null!==(u=l.usageMetadata)&&void 0!==u&&u.candidatesTokenCount?e.raw.usageMetadata.candidatesTokenCount:Math.ceil(1.3*t.split(/\s+/).length)}),[]),_=(0,o.useCallback)((e=>e&&"object"==typeof e&&e.id&&e.model&&e.usage&&"object"==typeof e.usage?{tokenInfo:{promptTokens:e.usage.promptTokens,completionTokens:e.usage.completionTokens,totalTokens:e.usage.totalTokens},finishReason:e.finishReason,model:e.model,provider:e.provider}:null),[]),H=(0,o.useCallback)((e=>{var t;if(!e)return null;if(e.usage&&"object"==typeof e.usage){if("promptTokens"in e.usage&&"completionTokens"in e.usage&&"totalTokens"in e.usage)return{promptTokens:e.usage.promptTokens,completionTokens:e.usage.completionTokens,totalTokens:e.usage.totalTokens};if("prompt_tokens"in e.usage&&"completion_tokens"in e.usage&&"total_tokens"in e.usage)return{promptTokens:e.usage.prompt_tokens,completionTokens:e.usage.completion_tokens,totalTokens:e.usage.total_tokens}}return e.tokenUsage?{promptTokens:e.tokenUsage.input||e.tokenUsage.prompt,completionTokens:e.tokenUsage.output||e.tokenUsage.completion,totalTokens:e.tokenUsage.total}:null!==(t=e.raw)&&void 0!==t&&t.usageMetadata?{promptTokens:e.raw.usageMetadata.promptTokenCount,completionTokens:e.raw.usageMetadata.candidatesTokenCount,totalTokens:e.raw.usageMetadata.totalTokenCount}:null}),[]),E=(0,o.useCallback)((async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2)+Date.now().toString(36);n.current=o;const s=null!==t&&Number.isInteger(t)&&t>=0;if(v.streaming)return I(e,s?t:null);if(!e||!k)return j("Please enter a message and select a model"),null;const a=A(k);if(!a)return j("Invalid model selection"),null;let r;s?w((n=>{const o=n.slice(0,t);return r={role:"user",content:e,timestamp:Date.now()},[...o,r]})):r=b("user",e);const i=Date.now();x(!0),j(null);try{const e=f(k),t=y.current.map((e=>{let{metrics:t,...n}=e;return n}));!e.systemPrompt||t.length&&"system"===t[0].role||t.unshift({role:"system",content:e.systemPrompt,timestamp:Date.now()-1}),t.push(r);const n={requestId:o,model:a,messages:t,temperature:e.temperature,max_tokens:e.max_tokens,top_p:e.top_p,frequency_penalty:e.frequency_penalty,presence_penalty:e.presence_penalty};M(),P();const s={"Content-Type":"application/json",Accept:"application/json"};T&&(s.Authorization=`Bearer ${T}`);const u=await(0,m.J)(new URL("/api/chat/completions",g).toString(),{method:"POST",headers:s,body:JSON.stringify(n)});if(!u.ok){let e=`API error: ${u.status}`;try{var l;const t=await u.json();e=(null==t||null===(l=t.error)||void 0===l?void 0:l.message)||(null==t?void 0:t.message)||e}catch{}throw new Error(e)}const c=await u.json(),d=c.content||"No Response returned",p=_(c),h=(null==p?void 0:p.tokenInfo)||H(c),v=(null==p?void 0:p.finishReason)||c.finishReason,C=(null==h?void 0:h.completionTokens)||R(c,d);if(h&&(h.promptTokens||h.completionTokens)){const e=Date.now(),t=e-i,n={startTime:i,endTime:e,elapsedTime:t,tokenCount:C,tokensPerSecond:Math.round(C/(t/1e3)*10)/10,isComplete:!0,timeToFirstToken:null,promptTokens:h.promptTokens,completionTokens:h.completionTokens,totalTokens:h.totalTokens,finishReason:v};b("assistant",d,n)}else{b("assistant",d,{promptTokens:0,completionTokens:C,totalTokens:C,finishReason:v})}return d}catch(e){return j(e.message),b("error",e.message||"An error occurred"),null}finally{n.current=null,x(!1)}}),[g,k,v.streaming,f,T,y,w,b,I,A,H,R,_,M,P,j,x]),F=(0,o.useCallback)((async()=>(U(),!0)),[U]),L=(0,o.useCallback)((()=>{w([]),M()}),[w,M]),z=(0,o.useCallback)((()=>{if(0===C.length)return;const e=C.map((e=>`${"user"===e.role?"You":"assistant"===e.role?(null==k?void 0:k.name)||"Assistant":e.role}: ${"string"==typeof e.content?e.content:""}\n`)).join("\n"),t=new Blob([e],{type:"text/plain"}),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download=`chat_${(new Date).toISOString()}.txt`,document.body.appendChild(o),o.click(),setTimeout((()=>{document.body.removeChild(o),URL.revokeObjectURL(n)}),100)}),[C,k]),$=(0,o.useCallback)((e=>{}),[]),D=(0,o.useMemo)((()=>({sendMessage:E,stopGeneration:F,addMessageToHistory:b,clearChat:L,downloadChatHistory:z,getOrCreateConversation:$,setTokenMetricsForLastMessage:S})),[E,F,b,L,z,$,S]);return(0,p.jsx)(h.Provider,{value:D,children:t})}},92503:(e,t,n)=>{n.d(t,{P:()=>l,h:()=>u});var o=n(65043),s=n(52932),a=n(36514),r=n(70579);const i=(0,o.createContext)(),l=()=>{const e=(0,o.useContext)(i);if(void 0===e)throw new Error("useChatState must be used within a ChatStateProvider");return e},u=e=>{let{children:t}=e;const{chatHistory:n,chatHistoryRef:l}=(0,s.m)(),{isWaitingForResponse:u,error:c}=(0,a.A)(),d=(0,o.useMemo)((()=>({chatHistory:n,chatHistoryRef:l,isWaitingForResponse:u,error:c})),[n,l,u,c]);return(0,r.jsx)(i.Provider,{value:d,children:t})}}}]);
//# sourceMappingURL=main-52f0199e.3f4519fa.js.map