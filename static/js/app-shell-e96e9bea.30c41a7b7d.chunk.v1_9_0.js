(self.webpackChunkai_chat_interface=self.webpackChunkai_chat_interface||[]).push([["app-shell-e96e9bea"],{10446:(e,t,s)=>{var n=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,i=/^0o[0-7]+$/i,a=parseInt,l="object"==typeof s.g&&s.g&&s.g.Object===Object&&s.g,c="object"==typeof self&&self&&self.Object===Object&&self,d=l||c||Function("return this")(),u=Object.prototype.toString,f=Math.max,b=Math.min,m=function(){return d.Date.now()};function h(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function y(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==u.call(e)}(e))return NaN;if(h(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=h(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(n,"");var s=o.test(e);return s||i.test(e)?a(e.slice(2),s?2:8):r.test(e)?NaN:+e}e.exports=function(e,t,s){var n,r,o,i,a,l,c=0,d=!1,u=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var s=n,o=r;return n=r=void 0,c=t,i=e.apply(o,s)}function g(e){var s=e-l;return void 0===l||s>=t||s<0||u&&e-c>=o}function _(){var e=m();if(g(e))return w(e);a=setTimeout(_,function(e){var s=t-(e-l);return u?b(s,o-(e-c)):s}(e))}function w(e){return a=void 0,v&&n?p(e):(n=r=void 0,i)}function T(){var e=m(),s=g(e);if(n=arguments,r=this,l=e,s){if(void 0===a)return function(e){return c=e,a=setTimeout(_,t),d?p(e):i}(l);if(u)return a=setTimeout(_,t),p(l)}return void 0===a&&(a=setTimeout(_,t)),i}return t=y(t)||0,h(s)&&(d=!!s.leading,o=(u="maxWait"in s)?f(y(s.maxWait)||0,t):o,v="trailing"in s?!!s.trailing:v),T.cancel=function(){void 0!==a&&clearTimeout(a),c=0,n=l=r=a=void 0},T.flush=function(){return void 0===a?i:w(m())},T}},28251:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>I});var n=s(17906),r=s(35016),o=s(13005),i=s(91578),a=s(96377),l=s(20409),c=s(36514),d=s(52932),u=s(14255),f=s(71789),b=s(92503),m=s(92167),h=s(63121);const y=(0,n.q6)(null),v=e=>{let{children:t}=e;const s=(0,n.Kr)((()=>({isInitialized:!1,setInitialized:e=>{s.isInitialized=e}})),[]);return(0,n.vJ)((()=>{s.setInitialized(!0)}),[s]),(0,h.Y)(y.Provider,{value:s,children:(0,h.Y)(o.N,{children:(0,h.Y)(i.K,{children:(0,h.Y)(a.lx,{children:(0,h.Y)(l.Z,{children:(0,h.Y)(c.g,{children:(0,h.Y)(d.U,{children:(0,h.Y)(u.b,{children:(0,h.Y)(f.V,{children:(0,h.Y)(b.h,{children:(0,h.Y)(m.n,{children:t})})})})})})})})})})})};var p=s(83717),g=s(23400);const _={layout:()=>Promise.all([s.e("icons-8b15a53d"),s.e("icons-c1b46ba6"),s.e("icons-8e8c8d13"),s.e("icons-4b3f4eb3"),s.e("icons-f2a4f970"),s.e("styles-b2c1640e"),s.e("styles-31743c5a"),s.e("styles-b4afe919"),s.e("styles-fe5b6f8a"),s.e("styles-88d3322f"),s.e("styles-61a228d7"),s.e("styles-237f6cdc"),s.e("layout")]).then(s.bind(s,9243)),chatContainer:()=>Promise.all([s.e("icons-8b15a53d"),s.e("icons-c1b46ba6"),s.e("icons-8e8c8d13"),s.e("icons-4b3f4eb3"),s.e("icons-f2a4f970"),s.e("styles-b2c1640e"),s.e("styles-31743c5a"),s.e("styles-b4afe919"),s.e("styles-fe5b6f8a"),s.e("styles-88d3322f"),s.e("styles-61a228d7"),s.e("styles-237f6cdc"),s.e("chat-container")]).then(s.bind(s,4807)),chatInput:()=>Promise.all([s.e("icons-8b15a53d"),s.e("icons-c1b46ba6"),s.e("icons-8e8c8d13"),s.e("icons-4b3f4eb3"),s.e("icons-f2a4f970"),s.e("styles-b2c1640e"),s.e("styles-31743c5a"),s.e("styles-b4afe919"),s.e("styles-fe5b6f8a"),s.e("styles-88d3322f"),s.e("styles-61a228d7"),s.e("styles-237f6cdc"),s.e("chat-input")]).then(s.bind(s,93912)),modelDropdown:()=>Promise.all([s.e("icons-8b15a53d"),s.e("icons-c1b46ba6"),s.e("icons-8e8c8d13"),s.e("icons-4b3f4eb3"),s.e("icons-f2a4f970"),s.e("styles-b2c1640e"),s.e("styles-31743c5a"),s.e("styles-b4afe919"),s.e("styles-fe5b6f8a"),s.e("styles-88d3322f"),s.e("styles-61a228d7"),s.e("styles-237f6cdc"),s.e("models-dropdown")]).then(s.bind(s,5925)),sidebar:()=>Promise.all([s.e("icons-8b15a53d"),s.e("icons-c1b46ba6"),s.e("icons-8e8c8d13"),s.e("icons-4b3f4eb3"),s.e("icons-f2a4f970"),s.e("styles-b2c1640e"),s.e("styles-31743c5a"),s.e("styles-b4afe919"),s.e("styles-fe5b6f8a"),s.e("styles-88d3322f"),s.e("styles-61a228d7"),s.e("styles-237f6cdc"),s.e("layout-sidebar")]).then(s.bind(s,61243)),themeToggle:()=>Promise.all([s.e("styles-b2c1640e"),s.e("styles-31743c5a"),s.e("styles-b4afe919"),s.e("styles-fe5b6f8a"),s.e("styles-88d3322f"),s.e("styles-61a228d7"),s.e("styles-237f6cdc"),s.e("common-theme")]).then(s.bind(s,62813)),sidebarToggle:()=>Promise.all([s.e("styles-b2c1640e"),s.e("styles-31743c5a"),s.e("styles-b4afe919"),s.e("styles-fe5b6f8a"),s.e("styles-88d3322f"),s.e("styles-61a228d7"),s.e("styles-237f6cdc"),s.e("layout-sidebar-toggle")]).then(s.bind(s,60391)),messageList:()=>Promise.all([s.e("icons-8b15a53d"),s.e("icons-c1b46ba6"),s.e("icons-8e8c8d13"),s.e("icons-4b3f4eb3"),s.e("icons-f2a4f970"),s.e("styles-b2c1640e"),s.e("styles-31743c5a"),s.e("styles-b4afe919"),s.e("styles-fe5b6f8a"),s.e("styles-88d3322f"),s.e("styles-61a228d7"),s.e("styles-237f6cdc"),s.e("chat-messagelist")]).then(s.bind(s,43548)),authButton:()=>Promise.all([s.e("icons-8b15a53d"),s.e("icons-c1b46ba6"),s.e("icons-8e8c8d13"),s.e("icons-4b3f4eb3"),s.e("icons-f2a4f970"),s.e("styles-b2c1640e"),s.e("styles-31743c5a"),s.e("styles-b4afe919"),s.e("styles-fe5b6f8a"),s.e("styles-88d3322f"),s.e("styles-61a228d7"),s.e("styles-237f6cdc"),s.e("auth-button")]).then(s.bind(s,3247)),globalMetrics:()=>Promise.all([s.e("styles-b2c1640e"),s.e("styles-31743c5a"),s.e("styles-b4afe919"),s.e("styles-fe5b6f8a"),s.e("styles-88d3322f"),s.e("styles-61a228d7"),s.e("styles-237f6cdc"),s.e("chat-globalmetrics")]).then(s.bind(s,92932)),moreActions:()=>Promise.all([s.e("icons-8b15a53d"),s.e("icons-c1b46ba6"),s.e("icons-8e8c8d13"),s.e("icons-4b3f4eb3"),s.e("icons-f2a4f970"),s.e("styles-b2c1640e"),s.e("styles-31743c5a"),s.e("styles-b4afe919"),s.e("styles-fe5b6f8a"),s.e("styles-88d3322f"),s.e("styles-61a228d7"),s.e("styles-237f6cdc"),s.e("common-more-actions")]).then(s.bind(s,96960))},w=(0,n.RZ)(_.layout),T=(0,n.RZ)((()=>Promise.all([s.e("icons-8b15a53d"),s.e("icons-c1b46ba6"),s.e("icons-8e8c8d13"),s.e("icons-4b3f4eb3"),s.e("icons-f2a4f970"),s.e("styles-b2c1640e"),s.e("styles-31743c5a"),s.e("styles-b4afe919"),s.e("styles-fe5b6f8a"),s.e("styles-88d3322f"),s.e("styles-61a228d7"),s.e("styles-237f6cdc"),s.e("login-modal")]).then(s.bind(s,5532)))),k={essential:Object.values(_),heavy:[()=>Promise.all([s.e("markdown"),s.e("katex-9241dc7c"),s.e("katex-ff6c5009"),s.e("vendor.micromark-core-commonmark-7bcc962f"),s.e("vendor.micromark-core-commonmark-3f280b54"),s.e("vendor.micromark-core-commonmark-de7a737e"),s.e("vendor.micromark-core-commonmark-63b8257e"),s.e("vendor.remark-rehype-bb555bc8"),s.e("vendor.remark-rehype-329b9836"),s.e("vendor.hast-util-from-dom-fe9b1242"),s.e("vendor.hast-util-from-dom-379f00e3"),s.e("vendor.micromark-eb1fd148"),s.e("vendor.micromark-0d7ea0ba"),s.e("vendor.mdast-util-gfm-autolink-literal"),s.e("vendor.micromark-extension-gfm-table"),s.e("vendor.vfile"),s.e("vendor.mdast-util-from-markdown"),s.e("vendor.property-information"),s.e("vendor.micromark-extension-gfm-autolink-literal"),s.e("vendor.micromark-extension-math"),s.e("vendor.micromark-extension-gfm-footnote"),s.e("vendors-node_modules_extend_index_js-node_modules_inline-style-parser_index_js-node_modules_b-bb45d9"),s.e("vendors-node_modules_micromark-factory-label_index_js-node_modules_micromark-factory-title_in-604cc4"),s.e("vendors-node_modules_prop-types_index_js-node_modules_micromark-util-classify-character_index-98f830"),s.e("vendors-node_modules_ccount_index_js-node_modules_mdast-util-gfm_lib_index_js"),s.e("vendors-node_modules_mdast-util-to-markdown_lib_handle_inline-code_js-node_modules_mdast-util-b824d0"),s.e("vendors-node_modules_hast-util-from-html-isomorphic_lib_browser_js-node_modules_hast-util-to--d97c0b"),s.e("vendors-node_modules_unist-util-find-after_lib_index_js-node_modules_unist-util-visit-parents-1cc2f3"),s.e("markdown-renderer")]).then(s.bind(s,19224)),()=>Promise.all([s.e("styles-b2c1640e"),s.e("styles-31743c5a"),s.e("styles-b4afe919"),s.e("styles-fe5b6f8a"),s.e("styles-88d3322f"),s.e("styles-61a228d7"),s.e("styles-237f6cdc"),s.e("streaming-message")]).then(s.bind(s,74759)),()=>Promise.all([s.e("firebase-19f9d112"),s.e("firebase-a456dcbb"),s.e("vendor.firebase-15d6dbba"),s.e("vendor.firebase-1b4271fd"),s.e("vendor.firebase-608eddd6"),s.e("firebase-config")]).then(s.bind(s,91729)).then((()=>{window.dispatchEvent(new Event("firebaseInitialized"))}))]},P=async e=>{await Promise.all(e.map((e=>e())))},A=(e,t)=>{requestIdleCallback((()=>{e.forEach(((e,s)=>e().then((()=>t(s))).catch((()=>{}))))}))};function C(){const[e,t]=(0,n.J0)(!1),[s,o]=(0,n.J0)(!1),{isLoggingIn:i,setIsLoggingIn:a}=(0,r.A)();return(0,n.vJ)((()=>{let e=!1;return async function(){g.Hp.mark(g.wz.APP_START);try{await P(k.essential),g.Hp.mark(g.wz.IMPORTANT_COMPONENTS_LOADED),g.Hp.measure(g.l9.IMPORTANT_LOAD_TIME,g.wz.APP_START,g.wz.IMPORTANT_COMPONENTS_LOADED),g.Hp.mark(g.wz.COMPONENT_LOAD),g.Hp.measure(g.l9.COMPONENT_LOAD,g.wz.APP_START,g.wz.COMPONENT_LOAD)}catch(e){}requestAnimationFrame((async()=>{e||(t(!0),g.Hp.mark(g.wz.APP_INTERACTIVE),g.Hp.measure(g.l9.TIME_TO_INTERACTIVE,g.wz.APP_START,g.wz.APP_INTERACTIVE),A(k.heavy,(e=>{e===k.heavy.length-1&&o(!0)})))}))}(),()=>{e=!0,g.Hp.clear()}}),[]),e?(0,h.FD)(h.FK,{children:[(0,h.Y)(n.tY,{fallback:(0,h.Y)(p.default,{size:"small"}),children:(0,h.Y)(w,{})}),i&&s&&(0,h.Y)(n.tY,{fallback:(0,h.Y)(p.default,{size:"small"}),children:(0,h.Y)(T,{onClose:()=>a(!1)})})]}):(0,h.Y)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},children:(0,h.Y)(p.default,{size:"medium"})})}function I(){return(0,h.Y)(r.O,{children:(0,h.Y)(v,{children:(0,h.Y)(C,{})})})}},35016:(e,t,s)=>{"use strict";s.d(t,{A:()=>l,O:()=>c});var n=s(17906),r=s(92637),o=s(50578),i=s(63121);const a=(0,n.q6)(),l=()=>{const e=(0,n.NT)(a);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},c=e=>{let{children:t}=e;const[l,c]=(0,n.J0)(null),[d,u]=(0,n.J0)(null),[f,b]=(0,n.J0)(!1),[,m,h]=(0,o.M3)("auth"),[y,v]=(0,n.J0)(null),[p,g]=(0,n.J0)(!1),[_,w]=(0,n.J0)(!1),{showToast:T}=(0,r.d)();(0,n.vJ)((()=>{f?m():h()}),[f,m,h]);const k=(0,n.hb)((async()=>{g(!0)}),[g]),P=(0,n.hb)((async()=>{if(!_)return;const{getFirebaseAuth:e}=await Promise.all([s.e("firebase-19f9d112"),s.e("firebase-a456dcbb"),s.e("vendor.firebase-15d6dbba"),s.e("vendor.firebase-1b4271fd"),s.e("vendor.firebase-608eddd6"),s.e("firebase-config")]).then(s.bind(s,91729)),{signOut:t}=await Promise.all([s.e("firebase-19f9d112"),s.e("firebase-a456dcbb"),s.e("vendor.firebase-15d6dbba"),s.e("vendor.firebase-1b4271fd"),s.e("vendor.firebase-608eddd6"),s.e("firebase-auth")]).then(s.bind(s,94135)),n=e();if(!n){const e="Firebase not initialized.";return v(e),void T({type:"error",message:e})}try{await t(n)}catch(e){const t=e.message||"Failed to logout.";v(t),T({type:"error",message:t})}}),[_,v,T]);(0,n.vJ)((()=>{let e=null;const t=()=>{w(!0),n()},n=async()=>{b(!0);const{getFirebaseAuth:t}=await Promise.all([s.e("firebase-19f9d112"),s.e("firebase-a456dcbb"),s.e("vendor.firebase-15d6dbba"),s.e("vendor.firebase-1b4271fd"),s.e("vendor.firebase-608eddd6"),s.e("firebase-config")]).then(s.bind(s,91729)),{onAuthStateChanged:n}=await Promise.all([s.e("firebase-19f9d112"),s.e("firebase-a456dcbb"),s.e("vendor.firebase-15d6dbba"),s.e("vendor.firebase-1b4271fd"),s.e("vendor.firebase-608eddd6"),s.e("firebase-auth")]).then(s.bind(s,94135)),r=t();r?e=n(r,(async e=>{if(c(e),e)try{const t=await e.getIdToken();u(t);try{localStorage.setItem("idToken",t)}catch(e){}v(null),g(!1)}catch(e){const t="Failed to get authentication token.";v(t),T({type:"error",message:t}),u(null);const{signOut:n}=await Promise.all([s.e("firebase-19f9d112"),s.e("firebase-a456dcbb"),s.e("vendor.firebase-15d6dbba"),s.e("vendor.firebase-1b4271fd"),s.e("vendor.firebase-608eddd6"),s.e("firebase-auth")]).then(s.bind(s,94135));await n(r)}else{u(null);try{localStorage.removeItem("idToken")}catch(e){}g(!1)}b(!1)})):b(!1)};return window.addEventListener("firebaseInitialized",t),()=>{window.removeEventListener("firebaseInitialized",t),"function"==typeof e&&e()}}),[T]);const A=(0,n.Kr)((()=>({currentUser:l,idToken:d,loading:f,error:y,login:k,logout:P,isAuthenticated:!!l&&!!d,isLoggingIn:p,setIsLoggingIn:g,isFirebaseInitialized:_})),[l,d,f,y,k,P,p,g,_]);return(0,i.Y)(a.Provider,{value:A,children:t})}},36514:(e,t,s)=>{"use strict";s.d(t,{A:()=>a,g:()=>l});var n=s(17906),r=s(50578),o=s(63121);const i=(0,n.q6)(),a=()=>{const e=(0,n.NT)(i);if(void 0===e)throw new Error("useChatStatus must be used within a ChatStatusProvider");return e},l=e=>{let{children:t}=e;const[s,a]=(0,n.J0)(!1),[l,c]=(0,n.J0)(null),[,d,u]=(0,r.M3)("chat");(0,n.vJ)((()=>{s?d():u()}),[s,d,u]);const f=(0,n.Kr)((()=>({isWaitingForResponse:s,setIsWaitingForResponse:a,error:l,setError:c})),[s,l]);return(0,o.Y)(i.Provider,{value:f,children:t})}},52932:(e,t,s)=>{"use strict";s.d(t,{U:()=>a,m:()=>i});var n=s(17906),r=s(63121);const o=(0,n.q6)(),i=()=>{const e=(0,n.NT)(o);if(void 0===e)throw new Error("useChatHistory must be used within a ChatHistoryProvider");return e},a=e=>{let{children:t}=e;const[s,i]=(0,n.J0)([]),a=(0,n.li)([]),l=(0,n.hb)((e=>{i((t=>{const s="function"==typeof e?e(t):e;return a.current=s,s}))}),[]),c=(0,n.hb)(((e,t,s)=>{const n=Date.now(),r={id:n,role:e,content:t,timestamp:n,...s&&{metrics:s}};return l((e=>[...e,r])),r}),[l]),d=(0,n.hb)((e=>{l((t=>{const s=t.length-1;if(s<0)return t;const n=t[s];if("assistant"!==n.role||n.content===e)return t;const r=[...t];return r[s]={...n,content:e},r}))}),[l]),u=(0,n.Kr)((()=>({chatHistory:s,chatHistoryRef:a,setChatHistory:l,addMessageToHistory:c,updateChatWithContent:d})),[s,l,c,d]);return(0,r.Y)(o.Provider,{value:u,children:t})}},83717:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});s(17906);var n=s(23232),r=s(63121);const o=e=>{let{size:t="medium",tag:s}=e;const o=n.A[`Spinner--${t}`]||n.A["Spinner--medium"];return(0,r.Y)("div",{className:`${n.A.Spinner} ${o}`,"data-loading-tag":s,"aria-label":"Loading",role:"status",children:(0,r.Y)("div",{className:n.A.Spinner__loader})})}},91578:(e,t,s)=>{"use strict";s.d(t,{K:()=>a,g:()=>i});var n=s(17906),r=s(63121);const o=(0,n.q6)(),i=()=>{const e=(0,n.NT)(o);if(void 0===e)throw new Error("useApi must be used within an ApiProvider");return e},a=e=>{let{children:t}=e;const[s]=(0,n.J0)("http://localhost:3000"),i=(0,n.Kr)((()=>({apiUrl:s})),[s]);return(0,r.Y)(o.Provider,{value:i,children:t})}},92167:(e,t,s)=>{"use strict";s.d(t,{n:()=>v,r:()=>y});var n=s(17906),r=s(91578),o=s(96377),i=s(20409),a=s(35016),l=s(52932),c=s(36514),d=s(14255),u=s(71789),f=s(87164),b=s(92637),m=s(63121);const h=(0,n.q6)(),y=()=>{const e=(0,n.NT)(h);if(void 0===e)throw new Error("useChatControl must be used within a ChatControlProvider");return e},v=e=>{let{children:t}=e;const s=(0,n.li)(null),{apiUrl:y}=(0,r.g)(),{selectedModel:v}=(0,o.fn)(),{settings:p,getModelAdjustedSettings:g}=(0,i.t)(),{idToken:_}=(0,a.A)(),{chatHistoryRef:w,setChatHistory:T,addMessageToHistory:k}=(0,l.m)(),{setIsWaitingForResponse:P,setError:A}=(0,c.A)(),{resetPerformanceMetrics:C,startPerformanceTimer:I,setTokenMetricsForLastMessage:O}=(0,d.B)(),{streamMessageWithFetch:E,stopStreaming:Y}=(0,u.$)(),{showToast:N}=(0,b.d)(),R=(0,n.hb)((e=>e&&e.provider&&e.id?`${e.provider}/${e.id}`:null),[]),j=(0,n.hb)((async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2)+Date.now().toString(36);s.current=n;const r=null!==t&&Number.isInteger(t)&&t>=0;if(p.streaming)return E(e,r?t:null);if(!e||!v)return A("Please enter a message and select a model"),null;const o=R(v);if(!o)return A("Invalid model selection"),null;let i;r?T((s=>{const n=s.slice(0,t),r=s[t];return i={...r,content:e},[...n,i]})):i=k("user",e);const a=Date.now();P(!0),A(null);try{var l,c,d,u,b,m,h;const e=g(v),t=w.current.map((e=>{let{metrics:t,...s}=e;return s}));!e.systemPrompt||t.length&&"system"===t[0].role||t.unshift({role:"system",content:e.systemPrompt,timestamp:Date.now()-1}),t.push(i);const s={requestId:n,model:o,messages:t,temperature:e.temperature,max_tokens:e.max_tokens,top_p:e.top_p,frequency_penalty:e.frequency_penalty,presence_penalty:e.presence_penalty};C(),I();const r={"Content-Type":"application/json",Accept:"application/json"};_&&(r.Authorization=`Bearer ${_}`);const p=await(0,f.J)(new URL("/api/chat/completions",y).toString(),{method:"POST",headers:r,body:JSON.stringify(s)});if(!p.ok){let e=`API error: ${p.status}`;try{var O;const t=await p.json();e=(null==t||null===(O=t.error)||void 0===O?void 0:O.message)||(null==t?void 0:t.message)||e}catch{}throw new Error(e)}const T=await p.json();if(null!==(l=T.error)&&void 0!==l&&l.message||"error"===T.finishReason){var Y,N,j,M,S,x,z;const e=(null===(Y=T.error)||void 0===Y?void 0:Y.message)||"Error occurred during generation";A(e);const t=T.usage||{},s=null!==(N=null!==(j=t.promptTokens)&&void 0!==j?j:t.prompt_tokens)&&void 0!==N?N:0,n=null!==(M=null!==(S=t.completionTokens)&&void 0!==S?S:t.completion_tokens)&&void 0!==M?M:0,r=null!==(x=null!==(z=t.totalTokens)&&void 0!==z?z:t.total_tokens)&&void 0!==x?x:n,o=Date.now(),i=o-a,l={startTime:a,endTime:o,elapsedTime:i,tokenCount:n,tokensPerSecond:i?Math.round(n/(i/1e3)*10)/10:null,isComplete:!0,timeToFirstToken:null,promptTokens:s,completionTokens:n,totalTokens:r,finishReason:T.finishReason||"error",error:!0};return k("assistant",e,l),null}const P=T.content||"No Response returned",E=T.usage||{},R=null!==(c=null!==(d=E.promptTokens)&&void 0!==d?d:E.prompt_tokens)&&void 0!==c?c:0,H=null!==(u=null!==(b=E.completionTokens)&&void 0!==b?b:E.completion_tokens)&&void 0!==u?u:0,F=null!==(m=null!==(h=E.totalTokens)&&void 0!==h?h:E.total_tokens)&&void 0!==m?m:H,L=Date.now(),D=L-a,J=H>0?H:0,$={startTime:a,endTime:L,elapsedTime:D,tokenCount:J,tokensPerSecond:D?Math.round(J/(D/1e3)*10)/10:null,isComplete:!0,timeToFirstToken:null,promptTokens:R,completionTokens:H,totalTokens:F,finishReason:T.finishReason};return k("assistant",P,$),P}catch(e){return A(e.message),k("assistant",e.message||"An error occurred"),null}finally{s.current=null,P(!1)}}),[y,v,p.streaming,g,_,w,T,k,E,R,C,I,A,P]),M=(0,n.hb)((async()=>(Y(),!0)),[Y]),S=(0,n.hb)((()=>{T([]),C()}),[T,C]),x=(0,n.hb)((()=>{w.current.length>0&&S()}),[w,S]),z=(0,n.hb)((()=>{0!==w.current.length&&window.confirm("Are you sure you want to clear the current chat?")&&(S(),N({type:"info",message:"Chat has been cleared"}))}),[w,S,N]),H=(0,n.hb)((()=>{const e=w.current;if(e.length)try{const t=e.map((e=>{const t="user"===e.role?"You":"assistant"===e.role?(null==v?void 0:v.name)||"Assistant":e.role;let s="";return"string"==typeof e.content?s=e.content:Array.isArray(e.content)&&(s=e.content.map((e=>"text"===e.type?e.text:"[Image]")).join("\n")),`${t}: ${s}\n`})).join(""),s=new Blob([t],{type:"text/plain"}),n=URL.createObjectURL(s),r=document.createElement("a");r.href=n,r.download=`chat_${(new Date).toISOString().replace(/:/g,"-")}.txt`,document.body.appendChild(r),r.click(),N({type:"success",message:"Chat downloaded successfully"}),document.body.removeChild(r),URL.revokeObjectURL(n)}catch(e){N({type:"error",message:"Failed to download chat. Please try again."})}}),[w,v,N]),F=(0,n.hb)((e=>{}),[]),L=(0,n.Kr)((()=>({sendMessage:j,stopGeneration:M,addMessageToHistory:k,clearChat:S,newChat:x,resetChat:z,downloadChat:H,getOrCreateConversation:F,setTokenMetricsForLastMessage:O})),[j,M,k,S,x,z,H,F,O]);return(0,m.Y)(h.Provider,{value:L,children:t})}},92503:(e,t,s)=>{"use strict";s.d(t,{P:()=>l,h:()=>c});var n=s(17906),r=s(52932),o=s(36514),i=s(63121);const a=(0,n.q6)(),l=()=>{const e=(0,n.NT)(a);if(void 0===e)throw new Error("useChatState must be used within a ChatStateProvider");return e},c=e=>{let{children:t}=e;const{chatHistory:s,chatHistoryRef:l}=(0,r.m)(),{isWaitingForResponse:c,error:d}=(0,o.A)(),u=(0,n.Kr)((()=>({chatHistory:s,chatHistoryRef:l,isWaitingForResponse:c,error:d})),[s,l,c,d]);return(0,i.Y)(a.Provider,{value:u,children:t})}}}]);
//# sourceMappingURL=app-shell-e96e9bea.30c41a7b7d.chunk.v1_9_0.js.map