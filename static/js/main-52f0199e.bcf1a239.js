"use strict";(self.webpackChunkai_chat_interface=self.webpackChunkai_chat_interface||[]).push([[3326],{13005:(e,t,n)=>{n.d(t,{D:()=>a,N:()=>i});var r=n(65043),s=n(70579);const o=(0,r.createContext)(),a=()=>{const e=(0,r.useContext)(o);if(void 0===e)throw new Error("useTheme must be used within a ThemeProvider");return e},i=e=>{let{children:t}=e;const[n,a]=(0,r.useState)((()=>localStorage.getItem("theme")||"dark")),i=(0,r.useCallback)((()=>{a((e=>{const t="dark"===e?"light":"dark";return localStorage.setItem("theme",t),t}))}),[]);(0,r.useEffect)((()=>{document.body.classList.remove("light-mode","dark-mode"),document.body.classList.add(`${n}-mode`)}),[n]);const l=(0,r.useMemo)((()=>({theme:n,toggleTheme:i,isDark:"dark"===n})),[n,i]);return(0,s.jsx)(o.Provider,{value:l,children:t})}},14255:(e,t,n)=>{n.d(t,{B:()=>i,b:()=>l});var r=n(65043),s=n(52932),o=n(70579);const a=(0,r.createContext)(),i=()=>{const e=(0,r.useContext)(a);if(void 0===e)throw new Error("usePerformanceMetrics must be used within a PerformanceMetricsProvider");return e},l=e=>{let{children:t}=e;const{setChatHistory:n}=(0,s.m)(),[i,l]=(0,r.useState)({startTime:null,endTime:null,elapsedTime:null,tokenCount:null,tokensPerSecond:null,isComplete:!1,timeToFirstToken:null,promptTokens:null,completionTokens:null,totalTokens:null,finishReason:null}),c=(0,r.useCallback)((()=>{l({startTime:null,endTime:null,elapsedTime:null,tokenCount:null,tokensPerSecond:null,isComplete:!1,timeToFirstToken:null,promptTokens:null,completionTokens:null,totalTokens:null,finishReason:null})}),[]),u=(0,r.useCallback)((()=>{l((e=>({...e,startTime:Date.now(),isComplete:!1})))}),[]),d=(0,r.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;l((s=>{const o=Date.now(),a=s.startTime?o-s.startTime:0,i=e&&a?Math.round(e/(a/1e3)*10)/10:s.tokensPerSecond,l=s.timeToFirstToken||(e>0?a:null);return{startTime:s.startTime,endTime:o,elapsedTime:a,tokenCount:e,tokensPerSecond:i,isComplete:t,timeToFirstToken:l,promptTokens:(null==n?void 0:n.promptTokens)||s.promptTokens,completionTokens:(null==n?void 0:n.completionTokens)||s.completionTokens,totalTokens:(null==n?void 0:n.totalTokens)||s.totalTokens,finishReason:r||s.finishReason}}))}),[]);(0,r.useEffect)((()=>{null!=i.endTime&&n((e=>{const t=[...e],n=t[t.length-1];return n&&"assistant"===n.role&&(n.metrics={...i}),t}))}),[i,n]);const m=(0,r.useCallback)((e=>{n((t=>{const n=[...t],r=n[n.length-1];return r&&"assistant"===r.role&&(r.metrics={...r.metrics||{},...e,isComplete:!0}),n}))}),[n]),h=(0,r.useMemo)((()=>({currentMessageMetrics:i,resetPerformanceMetrics:c,startPerformanceTimer:u,updatePerformanceMetrics:d,setTokenMetricsForLastMessage:m})),[i,c,u,d,m]);return(0,o.jsx)(a.Provider,{value:h,children:t})}},20409:(e,t,n)=>{n.d(t,{Z:()=>c,t:()=>l});var r=n(65043),s=n(94916),o=n(70579);const a={temperature:.7,top_p:1,max_tokens:8191,frequency_penalty:0,presence_penalty:0,streaming:!0,systemPrompt:"You are ChatGPT, a helpful and knowledgeable AI assistant. Your primary role is to assist Nikhil, a university engineering student, by providing clear, concise, and technically accurate information. Adopt a friendly and approachable tone, akin to a knowledgeable peer or mentor. Enhance your responses with relevant emojis to convey tone and emotion, making interactions more engaging. Structure your answers logically, using bullet points or numbered lists where appropriate to enhance clarity. When applicable, incorporate interactive elements such as code snippets or diagrams to facilitate deeper understanding. Encourage curiosity by suggesting related topics or questions that Nikhil might explore further. Always tailor your assistance to support Nikhil's academic and personal growth in the field of engineering"},i=(0,r.createContext)(),l=()=>{const e=(0,r.useContext)(i);if(void 0===e)throw new Error("useSettings must be used within a SettingsProvider");return e},c=e=>{let{children:t}=e;const[n,l]=(0,s.M)("appSettings",a),c=(0,r.useCallback)(((e,t)=>{e in a&&l((n=>({...n,[e]:t})))}),[l]),u=(0,r.useCallback)((()=>{l(a)}),[l]),d=(0,r.useCallback)((e=>!!e&&(!0===e.requiresFixedTemperature||e.properties&&e.properties.includes("fixed_temperature")||e.id&&e.id.toLowerCase().startsWith("o")||e.series&&"o-series"===e.series.toLowerCase())),[]),m=(0,r.useCallback)((e=>d(e)?{...n,temperature:1}:n),[n,d]),h=(0,r.useMemo)((()=>({settings:n,updateSetting:c,resetSettings:u,shouldRestrictTemperature:d,getModelAdjustedSettings:m})),[n,c,u,d,m]);return(0,o.jsx)(i.Provider,{value:h,children:t})}},35016:(e,t,n)=>{n.d(t,{A:()=>l,O:()=>c});var r=n(65043),s=n(92637),o=n(50578),a=n(70579);const i=(0,r.createContext)(),l=()=>{const e=(0,r.useContext)(i);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},c=e=>{let{children:t}=e;const[l,c]=(0,r.useState)(null),[u,d]=(0,r.useState)(null),[m,h]=(0,r.useState)(!1),[,p,g]=(0,o.M3)("auth"),[f,y]=(0,r.useState)(null),[w,v]=(0,r.useState)(!1),[C,k]=(0,r.useState)(!1),{showToast:b}=(0,s.d)();(0,r.useEffect)((()=>{m?p():g()}),[m,p,g]);const T=(0,r.useCallback)((async()=>{v(!0)}),[v]),x=(0,r.useCallback)((async()=>{if(!C)return;const{getFirebaseAuth:e}=await Promise.all([n.e(3424),n.e(2052),n.e(4698),n.e(2702),n.e(8986),n.e(3815),n.e(8507)]).then(n.bind(n,91729)),{signOut:t}=await Promise.all([n.e(3424),n.e(2052),n.e(4698),n.e(2702),n.e(8986),n.e(3815),n.e(2991)]).then(n.bind(n,94135)),r=e();if(!r){const e="Firebase not initialized.";return y(e),void b({type:"error",message:e})}try{await t(r)}catch(e){const t=e.message||"Failed to logout.";y(t),b({type:"error",message:t})}}),[C,y]);(0,r.useEffect)((()=>{let e=null;const t=()=>{k(!0),r()},r=async()=>{h(!0);const{getFirebaseAuth:t}=await Promise.all([n.e(3424),n.e(2052),n.e(4698),n.e(2702),n.e(8986),n.e(3815),n.e(8507)]).then(n.bind(n,91729)),{onAuthStateChanged:r}=await Promise.all([n.e(3424),n.e(2052),n.e(4698),n.e(2702),n.e(8986),n.e(3815),n.e(2991)]).then(n.bind(n,94135)),s=t();s?e=r(s,(async e=>{if(c(e),e)try{const t=await e.getIdToken();d(t);try{localStorage.setItem("idToken",t)}catch(e){}y(null),v(!1)}catch(e){const t="Failed to get authentication token.";y(t),b({type:"error",message:t}),d(null);const{signOut:r}=await Promise.all([n.e(3424),n.e(2052),n.e(4698),n.e(2702),n.e(8986),n.e(3815),n.e(2991)]).then(n.bind(n,94135));await r(s)}else{d(null);try{localStorage.removeItem("idToken")}catch(e){}v(!1)}h(!1)})):h(!1)};return window.addEventListener("firebaseInitialized",t),()=>{window.removeEventListener("firebaseInitialized",t),"function"==typeof e&&e()}}),[]);const M=(0,r.useMemo)((()=>({currentUser:l,idToken:u,loading:m,error:f,login:T,logout:x,isAuthenticated:!!l&&!!u,isLoggingIn:w,setIsLoggingIn:v,isFirebaseInitialized:C})),[l,u,m,f,T,x,w,v,C]);return(0,a.jsx)(i.Provider,{value:M,children:t})}},36514:(e,t,n)=>{n.d(t,{A:()=>i,g:()=>l});var r=n(65043),s=n(50578),o=n(70579);const a=(0,r.createContext)(),i=()=>{const e=(0,r.useContext)(a);if(void 0===e)throw new Error("useChatStatus must be used within a ChatStatusProvider");return e},l=e=>{let{children:t}=e;const[n,i]=(0,r.useState)(!1),[l,c]=(0,r.useState)(null),[,u,d]=(0,s.M3)("chat");(0,r.useEffect)((()=>{n?u():d()}),[n,u,d]);const m=(0,r.useMemo)((()=>({isWaitingForResponse:n,setIsWaitingForResponse:i,error:l,setError:c})),[n,l]);return(0,o.jsx)(a.Provider,{value:m,children:t})}},50578:(e,t,n)=>{n.d(t,{M3:()=>i,oo:()=>a});var r=n(65043),s=n(70579);const o=(0,r.createContext)(null),a=e=>{let{children:t}=e;const[n,a]=(0,r.useState)({}),i=(0,r.useCallback)(((e,t)=>{a((n=>({...n,[e]:t})))}),[]),l=(0,r.useCallback)((e=>!!n[e]),[n]),c=Object.values(n).some((e=>e));return(0,s.jsx)(o.Provider,{value:{setLoading:i,isLoading:l,anyLoading:c},children:t})},i=e=>{const t=(0,r.useContext)(o);if(!t)throw new Error("useLoading must be used within LoadingProvider");const{setLoading:n,isLoading:s}=t,a=(0,r.useCallback)((()=>n(e,!0)),[n,e]),i=(0,r.useCallback)((()=>n(e,!1)),[n,e]);return[s(e),a,i]}},52523:(e,t,n)=>{n.d(t,{v:()=>f});var r=n(65043),s=n(13005),o=n(91578),a=n(96377),i=n(20409),l=n(36514),c=n(52932),u=n(14255),d=n(71789),m=n(92503),h=n(92167),p=n(70579);const g=(0,r.createContext)(null),f=e=>{let{children:t}=e;const n=(0,r.useMemo)((()=>({isInitialized:!1,setInitialized:e=>{n.isInitialized=e}})),[]);return(0,r.useEffect)((()=>{n.setInitialized(!0)}),[n]),(0,p.jsx)(g.Provider,{value:n,children:(0,p.jsx)(s.N,{children:(0,p.jsx)(o.K,{children:(0,p.jsx)(a.lx,{children:(0,p.jsx)(i.Z,{children:(0,p.jsx)(l.g,{children:(0,p.jsx)(c.U,{children:(0,p.jsx)(u.b,{children:(0,p.jsx)(d.V,{children:(0,p.jsx)(m.h,{children:(0,p.jsx)(h.n,{children:t})})})})})})})})})})})}},52932:(e,t,n)=>{n.d(t,{U:()=>i,m:()=>a});var r=n(65043),s=n(70579);const o=(0,r.createContext)(),a=()=>{const e=(0,r.useContext)(o);if(void 0===e)throw new Error("useChatHistory must be used within a ChatHistoryProvider");return e},i=e=>{let{children:t}=e;const[n,a]=(0,r.useState)([]),i=(0,r.useRef)([]),l=(0,r.useCallback)((e=>{a((t=>{const n="function"==typeof e?e(t):e;return i.current=n,n}))}),[]),c=(0,r.useCallback)(((e,t,n)=>{const r={role:e,content:t,timestamp:Date.now(),...n&&{metrics:n}};return l((e=>[...e,r])),r}),[l]),u=(0,r.useCallback)((e=>{l((t=>{const n=t.length-1;if(n<0)return t;const r=t[n];if("assistant"!==r.role||r.content===e)return t;const s=[...t];return s[n]={...r,content:e},s}))}),[l]),d=(0,r.useMemo)((()=>({chatHistory:n,chatHistoryRef:i,setChatHistory:l,addMessageToHistory:c,updateChatWithContent:u})),[n,l,c,u]);return(0,s.jsx)(o.Provider,{value:d,children:t})}},71789:(e,t,n)=>{n.d(t,{$:()=>f,V:()=>y});var r=n(65043),s=n(91578),o=n(96377),a=n(20409),i=n(35016),l=n(52932),c=n(36514),u=n(14255),d=n(87164),m=n(10446),h=n.n(m),p=n(70579);const g=(0,r.createContext)(),f=()=>{const e=(0,r.useContext)(g);if(void 0===e)throw new Error("useStreamingEvents must be used within a StreamingEventsProvider");return e},y=e=>{let{children:t}=e;const{apiUrl:m}=(0,s.g)(),{selectedModel:f}=(0,o.fn)(),{getModelAdjustedSettings:y}=(0,a.t)(),{idToken:w}=(0,i.A)(),{chatHistoryRef:v,setChatHistory:C,addMessageToHistory:k,updateChatWithContent:b}=(0,l.m)(),{setIsWaitingForResponse:T,setError:x}=(0,c.A)(),{resetPerformanceMetrics:M,startPerformanceTimer:S,updatePerformanceMetrics:P}=(0,u.B)(),E=(0,r.useRef)(""),A=(0,r.useRef)(null),j=(0,r.useRef)(null),R=(0,r.useRef)(!1),I=(0,r.useRef)(!1),_=(0,r.useMemo)((()=>h()((e=>b(e)),20)),[b]),L=(0,r.useRef)(null),F=(0,r.useRef)(null),D=(0,r.useCallback)((()=>(F.current||(L.current||(L.current=new URL(n(64339),n.b)),F.current=new Worker(L.current,{type:"module"})),F.current)),[]),N=(0,r.useCallback)((e=>new Promise(((t,n)=>{const r=D();r.onmessage=e=>t(e.data),r.onerror=n,r.postMessage(e)}))),[D]),O=(0,r.useCallback)((()=>{C((e=>{const t=[...e],n=t[t.length-1];if(n&&"assistant"===n.role){const e=n.content,t=" [Error occurred during generation]";e.includes(t)||(n.content=e?`${e}${t}`:"Error occurred during generation",n.metrics&&(n.metrics.isComplete=!0,n.metrics.error=!0))}return t}))}),[C]),U=(0,r.useCallback)((async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2)+Date.now().toString(36);A.current=n;const r=null!==t&&Number.isInteger(t)&&t>=0;if(!e||!f)return x("Please enter a message and select a model"),null;const s=`${f.provider}/${f.id}`;if(!s)return x("Invalid model selection"),null;let o;r?C((n=>{const r=n.slice(0,t);return o={role:"user",content:e,timestamp:Date.now()},[...r,o]})):o=k("user",e),M(),S(),I.current=!1,T(!0),x(null),E.current="",R.current=!0,k("assistant","");let a=setTimeout((()=>{var e;null===(e=j.current)||void 0===e||e.abort("timeout"),x("Connection timed out"),T(!1)}),6e4);const i=new AbortController;j.current=i;try{const e=y(f),t=v.current.map((e=>{let{metrics:t,...n}=e;return n}));!e.systemPrompt||t.length&&"system"===t[0].role||t.unshift({role:"system",content:e.systemPrompt,timestamp:Date.now()-1}),t.push(o);const r={requestId:n,model:s,messages:t,temperature:e.temperature,max_tokens:e.max_tokens,top_p:e.top_p,frequency_penalty:e.frequency_penalty,presence_penalty:e.presence_penalty},u={"Content-Type":"application/json",Accept:"text/event-stream","Cache-Control":"no-cache"};w&&(u.Authorization=`Bearer ${w}`);const h=await(0,d.J)(new URL("/api/chat/stream",m).toString(),{method:"POST",headers:u,body:JSON.stringify(r),signal:i.signal,cache:"no-store"});if(!h.ok)throw new Error(`API error: ${h.status}`);const p=h.body.getReader(),g=new TextDecoder("utf-8");let C="";for(;;){const{done:e,value:t}=await p.read();if(clearTimeout(a),a=setTimeout((()=>{var e;null===(e=j.current)||void 0===e||e.abort(),x("Connection timed out"),T(!1)}),6e4),e)break;const n=g.decode(t,{stream:!0});try{const e=await N(n);for(const t of e){var l,c;t.content&&(I.current||(P(1),I.current=!0),C+=t.content,E.current=C,_(C));const e=null!==(l=null===(c=t.usage)||void 0===c?void 0:c.completionTokens)&&void 0!==l?l:0;P(e,t.isDone,t.usage,t.finishReason)}}catch{}}return _.flush(),b(E.current),E.current}catch(e){return O(),null}finally{clearTimeout(a),R.current=!1,T(!1),A.current=null}}),[m,f,y,w,v,C,k,b,_,x,T,M,S,P,N,O]),$=(0,r.useCallback)((async()=>{j.current&&j.current.abort("user_stopped");const e=A.current;if(e){const t={"Content-Type":"application/json"};w&&(t.Authorization=`Bearer ${w}`);try{await(0,d.J)(new URL("/api/chat/stop",m).toString(),{method:"POST",headers:t,body:JSON.stringify({requestId:e})})}catch{}finally{A.current=null,j.current=null}}return R.current=!1,T(!1),!0}),[m,w,T]),H=(0,r.useMemo)((()=>({streamMessageWithFetch:U,stopStreaming:$,parseStreamChunk:N,streamingTextRef:E,isStreaming:()=>R.current})),[U,$,N]);return(0,p.jsx)(g.Provider,{value:H,children:t})}},83717:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});n(65043);var r=n(23232),s=n(70579);const o=e=>{let{size:t="medium",tag:n}=e;const o=r.A[`Spinner--${t}`]||r.A["Spinner--medium"];return(0,s.jsx)("div",{className:`${r.A.Spinner} ${o}`,"data-loading-tag":n,"aria-label":"Loading",role:"status",children:(0,s.jsx)("div",{className:r.A.Spinner__loader})})}},88046:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(65043),s=n(50578),o=n(92637);const a=()=>{const[e]=(0,s.M3)("auth"),t=e,{showToast:n,dismissToast:a}=(0,o.d)(),i=(0,r.useRef)(null);return(0,r.useEffect)((()=>(t?i.current=n({type:"info",message:"Loading in progress...",duration:0}):i.current&&(a(i.current),n({type:"success",message:"Loading complete",duration:2e3}),i.current=null),()=>{i.current&&(a(i.current),i.current=null)})),[e]),null}},91578:(e,t,n)=>{n.d(t,{K:()=>i,g:()=>a});var r=n(65043),s=n(70579);const o=(0,r.createContext)(),a=()=>{const e=(0,r.useContext)(o);if(void 0===e)throw new Error("useApi must be used within an ApiProvider");return e},i=e=>{let{children:t}=e;const[n]=(0,r.useState)("http://localhost:3000"),a=(0,r.useMemo)((()=>({apiUrl:n})),[n]);return(0,s.jsx)(o.Provider,{value:a,children:t})}},92167:(e,t,n)=>{n.d(t,{n:()=>w,r:()=>y});var r=n(65043),s=n(91578),o=n(96377),a=n(20409),i=n(35016),l=n(52932),c=n(36514),u=n(14255),d=n(71789),m=n(87164),h=n(73512),p=n(92637),g=n(70579);const f=(0,r.createContext)(),y=()=>{const e=(0,r.useContext)(f);if(void 0===e)throw new Error("useChatControl must be used within a ChatControlProvider");return e},w=e=>{let{children:t}=e;const n=(0,r.useRef)(null),{apiUrl:y}=(0,s.g)(),{selectedModel:w}=(0,o.fn)(),{settings:v,getModelAdjustedSettings:C}=(0,a.t)(),{idToken:k}=(0,i.A)(),{chatHistoryRef:b,setChatHistory:T,addMessageToHistory:x}=(0,l.m)(),{setIsWaitingForResponse:M,setError:S}=(0,c.A)(),{resetPerformanceMetrics:P,startPerformanceTimer:E,setTokenMetricsForLastMessage:A}=(0,u.B)(),{streamMessageWithFetch:j,stopStreaming:R}=(0,d.$)(),{showToast:I}=((0,h.GM)(),(0,p.d)()),_=(0,r.useCallback)((e=>e&&e.provider&&e.id?`${e.provider}/${e.id}`:null),[]),L=(0,r.useCallback)((async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2)+Date.now().toString(36);n.current=r;const s=null!==t&&Number.isInteger(t)&&t>=0;if(v.streaming)return j(e,s?t:null);if(!e||!w)return S("Please enter a message and select a model"),null;const o=_(w);if(!o)return S("Invalid model selection"),null;let a;s?T((n=>{const r=n.slice(0,t);return a={role:"user",content:e,timestamp:Date.now()},[...r,a]})):a=x("user",e);const i=Date.now();M(!0),S(null);try{var l,c,u,d,h,p;const e=C(w),t=b.current.map((e=>{let{metrics:t,...n}=e;return n}));!e.systemPrompt||t.length&&"system"===t[0].role||t.unshift({role:"system",content:e.systemPrompt,timestamp:Date.now()-1}),t.push(a);const n={requestId:r,model:o,messages:t,temperature:e.temperature,max_tokens:e.max_tokens,top_p:e.top_p,frequency_penalty:e.frequency_penalty,presence_penalty:e.presence_penalty};P(),E();const s={"Content-Type":"application/json",Accept:"application/json"};k&&(s.Authorization=`Bearer ${k}`);const f=await(0,m.J)(new URL("/api/chat/completions",y).toString(),{method:"POST",headers:s,body:JSON.stringify(n)});if(!f.ok){let e=`API error: ${f.status}`;try{var g;const t=await f.json();e=(null==t||null===(g=t.error)||void 0===g?void 0:g.message)||(null==t?void 0:t.message)||e}catch{}throw new Error(e)}const v=await f.json(),T=v.content||"No Response returned",M=v.usage||{},S=null!==(l=null!==(c=M.promptTokens)&&void 0!==c?c:M.prompt_tokens)&&void 0!==l?l:0,A=null!==(u=null!==(d=M.completionTokens)&&void 0!==d?d:M.completion_tokens)&&void 0!==u?u:0,j=null!==(h=null!==(p=M.totalTokens)&&void 0!==p?p:M.total_tokens)&&void 0!==h?h:A,R=Date.now(),I=R-i,_=A>0?A:0,L={startTime:i,endTime:R,elapsedTime:I,tokenCount:_,tokensPerSecond:I?Math.round(_/(I/1e3)*10)/10:null,isComplete:!0,timeToFirstToken:null,promptTokens:S,completionTokens:A,totalTokens:j,finishReason:v.finishReason};return x("assistant",T,L),T}catch(e){return S(e.message),x("error",e.message||"An error occurred"),null}finally{n.current=null,M(!1)}}),[y,w,v.streaming,C,k,b,T,x,j,_,P,E,S,M]),F=(0,r.useCallback)((async()=>(R(),!0)),[R]),D=(0,r.useCallback)((()=>{T([]),P()}),[T,P]),N=(0,r.useCallback)((()=>{b.current.length>0&&D()}),[b,D]),O=(0,r.useCallback)((()=>{0!==b.current.length&&window.confirm("Are you sure you want to clear the current chat?")&&(D(),I({type:"info",message:"Chat has been cleared"}))}),[b,D,I]),U=(0,r.useCallback)((()=>{const e=b.current;if(e.length)try{const t=e.map((e=>{const t="user"===e.role?"You":"assistant"===e.role?(null==w?void 0:w.name)||"Assistant":e.role;let n="";return"string"==typeof e.content?n=e.content:Array.isArray(e.content)&&(n=e.content.map((e=>"text"===e.type?e.text:"[Image]")).join("\n")),`${t}: ${n}\n`})).join(""),n=new Blob([t],{type:"text/plain"}),r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download=`chat_${(new Date).toISOString().replace(/:/g,"-")}.txt`,document.body.appendChild(s),s.click(),I({type:"success",message:"Chat downloaded successfully"}),document.body.removeChild(s),URL.revokeObjectURL(r)}catch(e){I({type:"error",message:"Failed to download chat. Please try again."})}}),[b,w,I]),$=(0,r.useCallback)((e=>{}),[]),H=(0,r.useMemo)((()=>({sendMessage:L,stopGeneration:F,addMessageToHistory:x,clearChat:D,newChat:N,resetChat:O,downloadChat:U,getOrCreateConversation:$,setTokenMetricsForLastMessage:A})),[L,F,x,D,N,O,U,$,A]);return(0,g.jsx)(f.Provider,{value:H,children:t})}},92503:(e,t,n)=>{n.d(t,{P:()=>l,h:()=>c});var r=n(65043),s=n(52932),o=n(36514),a=n(70579);const i=(0,r.createContext)(),l=()=>{const e=(0,r.useContext)(i);if(void 0===e)throw new Error("useChatState must be used within a ChatStateProvider");return e},c=e=>{let{children:t}=e;const{chatHistory:n,chatHistoryRef:l}=(0,s.m)(),{isWaitingForResponse:c,error:u}=(0,o.A)(),d=(0,r.useMemo)((()=>({chatHistory:n,chatHistoryRef:l,isWaitingForResponse:c,error:u})),[n,c,u]);return(0,a.jsx)(i.Provider,{value:d,children:t})}},92637:(e,t,n)=>{n.d(t,{t:()=>m,d:()=>l});var r=n(65043),s=n(65360),o=n(70579);const a=e=>{let{toasts:t,dismissToast:n}=e;return(0,o.jsx)("div",{className:s.A.toastContainer,children:t.map((e=>(0,o.jsxs)("div",{className:`${s.A.toast} ${s.A[e.type]||""}`,children:[(0,o.jsx)("span",{className:s.A.message,children:e.message}),(0,o.jsx)("button",{type:"button",className:s.A.closeButton,onClick:()=>n(e.id),"aria-label":"Close notification",children:"Ã—"})]},e.id)))})},i=(0,r.createContext)(),l=()=>{const e=(0,r.useContext)(i);if(!e)throw new Error("useToast must be used within a ToastProvider");return e},c="ADD_TOAST",u="REMOVE_TOAST";function d(e,t){switch(t.type){case c:return[...e,t.payload];case u:return e.filter((e=>e.id!==t.payload));default:return e}}const m=e=>{let{children:t}=e;const[n,s]=(0,r.useReducer)(d,[]),l=(0,r.useCallback)((e=>{let{type:t,message:n,duration:r=3e3}=e;const o=Date.now().toString()+Math.random().toString(36).substr(2,9);return s({type:c,payload:{id:o,type:t,message:n,duration:r}}),setTimeout((()=>s({type:u,payload:o})),r),o}),[]),m=(0,r.useCallback)((e=>{s({type:u,payload:e})}),[]);return(0,o.jsxs)(i.Provider,{value:{showToast:l,dismissToast:m},children:[t,(0,o.jsx)(a,{toasts:n,dismissToast:m})]})}},96377:(e,t,n)=>{n.d(t,{N7:()=>p,fn:()=>h,lx:()=>g});var r=n(65043),s=n(91578),o=n(94916),a=n(35016),i=n(72152),l=n(92637),c=n(50578),u=n(70579);const d=(0,r.createContext)(),m=(0,r.createContext)(),h=()=>{const e=(0,r.useContext)(d);if(void 0===e)throw new Error("useModel must be used within a ModelProvider");return e},p=()=>{const e=(0,r.useContext)(m);if(void 0===e)throw new Error("useModelFilter must be used within a ModelProvider");return e},g=e=>{let{children:t}=e;const{cacheEnabled:h}=(0,i.Y)(),{apiUrl:p}=(0,s.g)(),{idToken:g}=(0,a.A)(),{showToast:f}=(0,l.d)(),[y,w]=(0,r.useState)([]),[v,C]=(0,r.useState)({}),[k,b]=(0,r.useState)([]),[T,x]=(0,r.useState)(null),[M,S]=(0,r.useState)(!0),[P,E]=(0,r.useState)(null),[A,j]=(0,o.M)("showExperimental",!1),[R,I]=(0,r.useState)({search:"",categories:{Chat:!0,Image:!0,Embedding:!0}}),[,_,L]=(0,c.M3)("models");(0,r.useEffect)((()=>{M?_():L()}),[M,_,L]);const F=(0,r.useCallback)((e=>e&&e.timestamp&&Date.now()-e.timestamp<432e6&&e.allModels&&e.processedModels&&e.experimentalModels),[]);(0,r.useEffect)((()=>{if("undefined"!=typeof window)return window.isCacheValid=F,()=>{delete window.isCacheValid}}),[F]);const D=(0,r.useCallback)((e=>{try{const t={allModels:e.allModels,processedModels:e.processedModels,experimentalModels:e.experimentalModels,timestamp:Date.now()};localStorage.setItem("modelDropdownCache",JSON.stringify(t))}catch(e){}}),[]),N=(0,r.useCallback)(((e,t)=>{I((n=>({...n,categories:{...n.categories,[e]:t}})))}),[]),O=(0,r.useCallback)((e=>{I((t=>({...t,search:e})))}),[]),U=(0,r.useCallback)((e=>{(null==T?void 0:T.id)!==(null==e?void 0:e.id)&&x(e)}),[T,x]),$=(0,r.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;S(!0),E(null);try{const r={Accept:"application/json"};if(e){const e=t||g;e&&(r.Authorization=`Bearer ${e}`)}const s=new URL("/api/models/classified",p).toString(),o=await fetch(s,{headers:r});if(!o.ok){let e=`Error fetching models: ${o.status}`;throw new Error(e)}const a=await o.json(),i=new Worker(new URL(n.p+n.u(6961),n.b),{type:void 0});i.postMessage(a),i.onmessage=e=>{let{data:t}=e;if(t.error)E(t.error),f({type:"error",message:t.error});else{const{allModels:e,processedModels:n,experimentalModels:r}=t;if(h){const t=localStorage.getItem("modelDropdownCache");let s;try{s=JSON.parse(t)}catch{s=null}(!s||JSON.stringify(s.allModels)!==JSON.stringify(e)||JSON.stringify(s.processedModels)!==JSON.stringify(n)||JSON.stringify(s.experimentalModels)!==JSON.stringify(r))&&(w(e),C(n),b(r),D({allModels:e,processedModels:n,experimentalModels:r}))}else w(e),C(n),b(r)}S(!1),i.terminate()},i.onerror=e=>{E(e.message),f({type:"error",message:e.message}),S(!1),i.terminate()}}catch(e){E(e.message||"Failed to load model data"),f({type:"error",message:e.message||"Failed to load model data"})}}),[p,D,g,h,f]),H=(0,r.useRef)(!1),J=(0,r.useRef)(!1);(0,r.useEffect)((()=>{if(!H.current){if(h){const e=localStorage.getItem("modelDropdownCache");let t;try{t=JSON.parse(e)}catch{t=null}t&&window.isCacheValid(t)&&(w(t.allModels),C(t.processedModels),b(t.experimentalModels),S(!1))}let e=null;try{e=localStorage.getItem("idToken")}catch{}e?(J.current=!0,$(!0,e)):$(!1),H.current=!0}}),[]),(0,r.useEffect)((()=>{H.current&&g&&!J.current&&(J.current=!0,$(!0))}),[g,$]),(0,r.useEffect)((()=>{!T&&y.length>0&&x(y[0])}),[y,T]);const W=(0,r.useCallback)((()=>{j((e=>!e))}),[j]),z=(0,r.useMemo)((()=>({allModels:y,processedModels:v,experimentalModels:k,selectedModel:T,isLoading:M,error:P,showExperimental:A,isExperimentalModelsEnabled:A,toggleExperimentalModels:W,setShowExperimental:j,selectModel:U,refreshModels:$})),[y,v,k,T,M,P,A,W,j,U,$]),q=(0,r.useMemo)((()=>({modelFilter:R,updateCategoryFilter:N,updateSearchFilter:O})),[R,N,O]);return(0,u.jsx)(d.Provider,{value:z,children:(0,u.jsx)(m.Provider,{value:q,children:t})})}}}]);
//# sourceMappingURL=main-52f0199e.bcf1a239.js.map