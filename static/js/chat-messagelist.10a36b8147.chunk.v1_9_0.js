"use strict";(self.webpackChunkai_chat_interface=self.webpackChunkai_chat_interface||[]).push([["chat-messagelist"],{1465:(e,s,a)=>{a.d(s,{n:()=>n});var t=a(17906),r=a(94916);const n=e=>{const s=`profilePicture_${e}`,[a,n]=(0,r.M)(s,null),[i,o]=(0,t.J0)(null),[l,c]=(0,t.J0)(!1),[m,d]=(0,t.J0)(null);return(0,t.vJ)((()=>{let s=!0;if(!e)return o(null),void c(!1);let t=a;if(t){if("string"==typeof t){const e={data:t,timestamp:Date.now()};n(e),t=e}if(t.timestamp&&Date.now()-t.timestamp<864e5&&t.data)return o(t.data),void c(!1);n(null)}return c(!0),fetch(e).then((e=>{if(!e.ok)throw new Error(`Failed to fetch image: ${e.status}`);return e.blob()})).then((e=>new Promise(((s,a)=>{const t=new FileReader;t.onloadend=()=>s(t.result),t.onerror=a,t.readAsDataURL(e)})))).then((e=>{if(!s)return;const a={data:e,timestamp:Date.now()};n(a),o(e)})).catch((e=>{s&&d(e)})).finally((()=>{s&&c(!1)})),()=>{s=!1}}),[e,a,n]),{profilePicture:i,loading:l,error:m}}},12807:(e,s,a)=>{a.d(s,{rP:()=>t});const t=e=>{if("string"!=typeof e||""===e)return"";const s=new RegExp("(```[\\s\\S]*?```)|^(\\s*)\\\\\\[([\\s\\S]*?)\\\\\\](.*)|^(\\s*)\\[\\\\/([\\s\\S]*?)\\\\/](.*)|\\\\\\(\\s*(.*?)\\s*\\\\\\)","gm");let a=e.replace(s,((e,s,a,t,r,n,i,o,l)=>void 0!==s?s:void 0!==a?`${a}$$${t}$$`:void 0!==n?`${n}$$${i}$$`:void 0!==l?`$${l.trim()}$`:e));return a=a.replace(/\n{3,}/g,"\n\n"),a=a.replace(/\n{3,}/g,"\n\n"),a}},43548:(e,s,a)=>{a.r(s),a.d(s,{default:()=>M});var t=a(17906),r=a(66519),n=a(92503),i=a(94692),o=a(30591);function l(e){return e?e<1e3?`${e}ms`:`${(e/1e3).toFixed(1)}s`:"0.0s"}var c=a(12807),m=a(63121);const d=(0,t.RZ)((()=>Promise.all([a.e("markdown"),a.e("katex-9241dc7c"),a.e("katex-ff6c5009"),a.e("vendor.micromark-core-commonmark-7bcc962f"),a.e("vendor.micromark-core-commonmark-3f280b54"),a.e("vendor.micromark-core-commonmark-de7a737e"),a.e("vendor.micromark-core-commonmark-63b8257e"),a.e("vendor.remark-rehype-bb555bc8"),a.e("vendor.remark-rehype-329b9836"),a.e("vendor.hast-util-from-dom-fe9b1242"),a.e("vendor.hast-util-from-dom-379f00e3"),a.e("vendor.micromark-eb1fd148"),a.e("vendor.micromark-0d7ea0ba"),a.e("vendor.mdast-util-gfm-autolink-literal"),a.e("vendor.micromark-extension-gfm-table"),a.e("vendor.vfile"),a.e("vendor.mdast-util-from-markdown"),a.e("vendor.property-information"),a.e("vendor.micromark-extension-gfm-autolink-literal"),a.e("vendor.micromark-extension-math"),a.e("vendor.micromark-extension-gfm-footnote"),a.e("vendors-node_modules_extend_index_js-node_modules_inline-style-parser_index_js-node_modules_b-bb45d9"),a.e("vendors-node_modules_micromark-factory-label_index_js-node_modules_micromark-factory-title_in-604cc4"),a.e("vendors-node_modules_prop-types_index_js-node_modules_micromark-util-classify-character_index-98f830"),a.e("vendors-node_modules_ccount_index_js-node_modules_mdast-util-gfm_lib_index_js"),a.e("vendors-node_modules_mdast-util-to-markdown_lib_handle_inline-code_js-node_modules_mdast-util-b824d0"),a.e("vendors-node_modules_hast-util-from-html-isomorphic_lib_browser_js-node_modules_hast-util-to--d97c0b"),a.e("vendors-node_modules_unist-util-find-after_lib_index_js-node_modules_unist-util-visit-parents-1cc2f3"),a.e("markdown-renderer")]).then(a.bind(a,19224))));function u(e){let{children:s}=e;return(0,m.Y)(t.tY,{fallback:(0,m.Y)("div",{children:s}),children:(0,m.Y)(d,{children:s})})}const _=(0,t.RZ)((()=>Promise.all([a.e("styles-b2c1640e"),a.e("styles-31743c5a"),a.e("styles-b4afe919"),a.e("styles-fe5b6f8a"),a.e("styles-88d3322f"),a.e("styles-61a228d7"),a.e("styles-237f6cdc"),a.e("streaming-message")]).then(a.bind(a,74759))));let g;const h=e=>{let{message:s,isStreaming:r=!1,onEditMessage:n=null,overrideContent:d=null,avatarUrl:h=null}=e;const f=null!=d?d:s.content,[p,v]=(0,t.J0)(!1),b=(0,t.Kr)((()=>"assistant"===s.role?f:(0,c.rP)(f)),[f,s.role]),[C,M]=(0,t.J0)(b);(0,t.vJ)((()=>{M(b)}),[b]),(0,t.vJ)((()=>{if("assistant"!==s.role||"string"!=typeof f||"undefined"==typeof Worker)return;const e=s.timestamp,t=("undefined"==typeof Worker||g||(g=new Worker(new URL(a.p+a.u("src_workers_texProcessor_js"),a.b),{type:void 0})),g),r=s=>{s.data.id===e&&(s.data.success?M(s.data.data):M(f))};return t.addEventListener("message",r),t.postMessage({id:e,content:f}),()=>{t.removeEventListener("message",r)}}),[f,s.role,s.timestamp]);const k=(0,t.Kr)((()=>{switch(s.role){case"user":return h?(0,m.Y)("img",{src:h,alt:"User avatar",className:o.A.ChatMessage__avatarImg}):null;case"assistant":return(0,m.Y)(i.MiJ,{size:16,className:o.A.ChatMessage__icon});case"system":return(0,m.Y)(i.L64,{size:16,className:o.A.ChatMessage__icon});case"error":return(0,m.Y)(i._0O,{size:16,className:o.A.ChatMessage__icon});default:return null}}),[s.role,h]),A=(0,t.Kr)((()=>{switch(s.role){case"user":return o.A["ChatMessage--user"];case"assistant":return o.A["ChatMessage--assistant"];case"system":return o.A["ChatMessage--system"];case"error":return o.A["ChatMessage--error"];default:return""}}),[s.role]),y=(0,t.Kr)((()=>!("assistant"!==s.role||!s.metrics)),[s.role,s.metrics]),N=(0,t.hb)((()=>{const e="string"==typeof s.content?s.content:Array.isArray(s.content)?s.content.filter((e=>"text"===e.type)).map((e=>e.text)).join("\n"):"";navigator.clipboard.writeText(e).then((()=>{v(!0),setTimeout((()=>v(!1)),2e3)}))}),[s.content]),Y=(0,t.Kr)((()=>(0,m.Y)("button",{className:`${o.A.ChatMessage__copyMessageButton} ${"assistant"===s.role&&y?o.A.ChatMessage__copyMessageButtonInMetrics:o.A.ChatMessage__copyMessageButtonBottomRight}`,onClick:N,"aria-label":"Copy message",title:"Copy message",children:p?(0,m.Y)(i.Srz,{size:16}):(0,m.Y)(i.TdU,{size:16})})),[N,s.role,y,p]),$=(0,t.hb)((()=>{n&&n(s)}),[n,s]),x=(0,t.Kr)((()=>"user"===s.role?(0,m.Y)("button",{className:o.A.ChatMessage__editMessageButton,onClick:$,"aria-label":"Edit message",title:"Edit message",children:(0,m.Y)(i.R2l,{size:16})}):null),[s.role,$]);return(0,m.FD)("div",{className:o.A.ChatMessage+" "+A,children:[(0,m.FD)("div",{className:o.A.ChatMessage__body,children:[k&&(0,m.Y)("div",{className:o.A.ChatMessage__avatar,children:k}),(0,m.FD)("div",{className:o.A.ChatMessage__contentWrapper,children:[(0,m.Y)(t.tY,{fallback:null,children:(0,m.Y)("div",{className:o.A.ChatMessage__content,children:"assistant"===s.role?(0,m.Y)(_,{content:C,isStreaming:r}):(0,m.Y)(u,{children:C})})}),"assistant"===s.role&&(()=>{if(!y||!s.metrics)return null;const e=r,{elapsedTime:a,tokenCount:t,tokensPerSecond:n,timeToFirstToken:c,promptTokens:d,completionTokens:u,totalTokens:_,finishReason:g}=s.metrics;return null!=a||null!=t||null!=n||null!=c||null!=d||null!=u||null!=_||null!=g?(0,m.FD)("div",{className:o.A.ChatMessage__metricsContainer,children:[null!=c&&0!==c&&(0,m.FD)("span",{className:o.A.ChatMessage__metric,children:[(0,m.Y)(i.O4,{size:14,className:o.A.ChatMessage__metricIcon}),"First Token: ",l(c)]}),null!=a&&0!==a&&(0,m.FD)("span",{className:o.A.ChatMessage__metric,children:[(0,m.Y)(i.O4,{size:14,className:o.A.ChatMessage__metricIcon}),"Total Time: ",l(a)]}),null!=t&&0!==t&&(0,m.FD)("span",{className:o.A.ChatMessage__metric,children:[(0,m.Y)(i.MiJ,{size:14,className:o.A.ChatMessage__metricIcon}),"Tokens: ",t]}),null!=d&&0!==d&&(0,m.FD)("span",{className:o.A.ChatMessage__metric,children:[(0,m.Y)(i.MiJ,{size:14,className:o.A.ChatMessage__metricIcon}),"Prompt: ",d]}),null!=u&&0!==u&&(0,m.FD)("span",{className:o.A.ChatMessage__metric,children:[(0,m.Y)(i.MiJ,{size:14,className:o.A.ChatMessage__metricIcon}),"Completion: ",u]}),null!=_&&0!==_&&(0,m.FD)("span",{className:o.A.ChatMessage__metric,children:[(0,m.Y)(i.MiJ,{size:14,className:o.A.ChatMessage__metricIcon}),"Total: ",_]}),null!=n&&0!==n&&(0,m.FD)("span",{className:o.A.ChatMessage__metric,children:[(0,m.Y)(i.BHx,{size:14,className:o.A.ChatMessage__metricIcon}),"Speed: ",n," t/s"]}),null!=g&&""!==g&&"stop"!==g.toLowerCase()&&"unknown"!==g.toLowerCase()&&(0,m.FD)("span",{className:o.A.ChatMessage__metric,children:[(0,m.Y)(i._0O,{size:14,className:o.A.ChatMessage__metricIcon}),g]}),e&&(0,m.FD)("span",{className:`${o.A.ChatMessage__metric} ${o.A.ChatMessage__generatingIndicator}`,children:[(0,m.Y)("span",{className:o.A.ChatMessage__generatingDot}),"Generating..."]}),Y]}):null})(),"user"!==s.role&&("assistant"!==s.role||!y)&&Y]})]}),"user"===s.role&&(0,m.FD)("div",{className:o.A.ChatMessage__actions,children:[x,Y]})]})};h.displayName="ChatMessage";const f=(0,t.ph)(h);var p=a(20104);const v=e=>{let{src:s,alt:a,onClose:r}=e;if(!s)return null;const n=(0,m.Y)("div",{className:p.A.ImageOverlay,onClick:r,role:"dialog","aria-modal":"true",title:"Click to close image",children:(0,m.Y)("img",{src:s,alt:a,className:p.A.ImageOverlay__image,onClick:e=>{e.stopPropagation()}})});return t.Ay.createPortal(n,document.body)};var b=a(1465);const C=(0,t.Rf)(((e,s)=>{let{messages:i,error:o,onEditMessage:l}=e;const{isWaitingForResponse:c}=(0,n.P)(),[d,u]=(0,t.J0)(null),{profilePicture:_}=(0,b.n)(d),[g,h]=(0,t.J0)((()=>localStorage.getItem("idToken"))),[p,C]=(0,t.J0)(null);(0,t.vJ)((()=>{if(!g)return;let e;return(async()=>{const{getFirebaseAuth:s}=await Promise.all([a.e("firebase-19f9d112"),a.e("firebase-a456dcbb"),a.e("vendor.firebase-15d6dbba"),a.e("vendor.firebase-1b4271fd"),a.e("vendor.firebase-608eddd6"),a.e("firebase-config")]).then(a.bind(a,91729)),{onAuthStateChanged:t}=await Promise.all([a.e("firebase-19f9d112"),a.e("firebase-a456dcbb"),a.e("vendor.firebase-15d6dbba"),a.e("vendor.firebase-1b4271fd"),a.e("vendor.firebase-608eddd6"),a.e("firebase-auth")]).then(a.bind(a,94135)),r=s();r&&(e=t(r,(async e=>{if(e){u(e.photoURL||null);try{const s=await e.getIdToken();h(s)}catch{h(null)}}else u(null),h(null)})))})(),()=>{e&&e()}}),[g]);const M=(0,t.Kr)((()=>{const e=[...i];if(o){const s=Date.now();e.push({id:s,role:"error",content:o,timestamp:s})}return e}),[i,o]);return(0,m.FD)(m.FK,{children:[(0,m.Y)("div",{className:r.A.MessageList,ref:s,"aria-live":"polite","aria-relevant":"additions text",children:M.map(((e,s)=>{var a;const t=s===M.length-1,n="assistant"===e.role&&t&&c&&!(null!==(a=e.metrics)&&void 0!==a&&a.isComplete),{images:i,text:o}=function(e){if(!e)return{images:[],text:e};if(Array.isArray(e)){const{images:s,texts:a}=e.reduce(((e,s)=>("image_url"===s.type?e.images.push({url:s.image_url.url,alt:s.image_url.alt||s.alt||null}):"text"===s.type&&e.texts.push(s.text),e)),{images:[],texts:[]});return{images:s,text:a.join(" ")}}return{images:[],text:e}}(e.content),u=e.timestamp?`${e.role}-${e.timestamp}-${s}`:`${e.role}-${s}`;return(0,m.FD)("div",{className:r.A.MessageList__messageRow,children:["user"===e.role&&i.length>0&&(0,m.Y)("div",{className:r.A.MessageList__imageContainer,children:i.map(((e,s)=>(0,m.Y)("img",{src:e.url,alt:e.alt||`Uploaded image ${s+1}`,className:`${r.A.MessageList__messageImage} ${r.A.MessageList__clickableImage}`,onClick:()=>{return s=e.url,void C(s);var s}},`${u}-img-${s}`)))}),(o||"user"!==e.role)&&(0,m.Y)(f,{message:e,overrideContent:o||void 0,isStreaming:n,onEditMessage:"user"===e.role?l:void 0,avatarUrl:"user"===e.role&&g?_||d:void 0})]},u)}))}),p&&(0,m.Y)(v,{src:p,alt:"Image preview",onClose:()=>{C(null)}})]})}));C.displayName="MessageList";const M=(0,t.ph)(C)}}]);
//# sourceMappingURL=chat-messagelist.10a36b8147.chunk.v1_9_0.js.map