"use strict";(self.webpackChunkai_chat_interface=self.webpackChunkai_chat_interface||[]).push([[9823],{1465:(e,s,t)=>{t.d(s,{n:()=>r});var a=t(65043),n=t(94916);const r=e=>{const s=`profilePicture_${e}`,[t,r]=(0,n.M)(s,null),[l,i]=(0,a.useState)(null),[o,c]=(0,a.useState)(!1),[m,u]=(0,a.useState)(null);return(0,a.useEffect)((()=>{let s=!0;if(!e)return i(null),void c(!1);let a=t;if(a){if("string"==typeof a){const e={data:a,timestamp:Date.now()};r(e),a=e}if(a.timestamp&&Date.now()-a.timestamp<864e5&&a.data)return i(a.data),void c(!1);r(null)}return c(!0),fetch(e).then((e=>{if(!e.ok)throw new Error(`Failed to fetch image: ${e.status}`);return e.blob()})).then((e=>new Promise(((s,t)=>{const a=new FileReader;a.onloadend=()=>s(a.result),a.onerror=t,a.readAsDataURL(e)})))).then((e=>{if(!s)return;const t={data:e,timestamp:Date.now()};r(t),i(e)})).catch((e=>{s&&u(e)})).finally((()=>{s&&c(!1)})),()=>{s=!1}}),[e,t,r]),{profilePicture:l,loading:o,error:m}}},12807:(e,s,t)=>{t.d(s,{rP:()=>a});const a=e=>{if("string"!=typeof e||""===e)return"";const s=new RegExp("(```[\\s\\S]*?```)|^(\\s*)\\\\\\[([\\s\\S]*?)\\\\\\](.*)|^(\\s*)\\[\\\\/([\\s\\S]*?)\\\\/](.*)|\\\\\\(\\s*(.*?)\\s*\\\\\\)","gm");let t=e.replace(s,((e,s,t,a,n,r,l,i,o)=>void 0!==s?s:void 0!==t?`${t}$$${a}$$`:void 0!==r?`${r}$$${l}$$`:void 0!==o?`$${o.trim()}$`:e));return t=t.replace(/\n{3,}/g,"\n\n"),t=t.replace(/\n{3,}/g,"\n\n"),t}},43548:(e,s,t)=>{t.r(s),t.d(s,{default:()=>j});var a=t(65043),n=t(66519),r=t(92503),l=t(94692),i=t(30591);function o(e){return e?e<1e3?`${e}ms`:`${(e/1e3).toFixed(1)}s`:"0.0s"}var c=t(12807),m=t(70579);const u=(0,a.lazy)((()=>Promise.all([t.e(4314),t.e(208),t.e(5764),t.e(2042),t.e(4370),t.e(1042),t.e(4912),t.e(4910),t.e(268),t.e(496),t.e(6716),t.e(8990),t.e(8360),t.e(4377),t.e(3542),t.e(8467),t.e(5419),t.e(5174),t.e(7007),t.e(1524),t.e(5433),t.e(4431),t.e(9173),t.e(4537),t.e(1802),t.e(4191),t.e(5028),t.e(535),t.e(5100),t.e(393),t.e(5039),t.e(5444)]).then(t.bind(t,19224))));function g(e){let{children:s}=e;return(0,m.jsx)(a.Suspense,{fallback:(0,m.jsx)("div",{children:s}),children:(0,m.jsx)(u,{children:s})})}const d=(0,a.lazy)((()=>Promise.all([t.e(4314),t.e(208),t.e(5764),t.e(2412),t.e(6017),t.e(399),t.e(4917),t.e(7777),t.e(438),t.e(662),t.e(7272),t.e(7390),t.e(2042),t.e(4370),t.e(1042),t.e(4912),t.e(4910),t.e(268),t.e(496),t.e(6716),t.e(8990),t.e(8360),t.e(4377),t.e(3542),t.e(4734),t.e(6755),t.e(4182),t.e(4582),t.e(8162),t.e(6760),t.e(1217),t.e(822),t.e(4335),t.e(6814),t.e(2489),t.e(9734),t.e(5522),t.e(5080),t.e(1927),t.e(9283),t.e(8476),t.e(5816),t.e(4120),t.e(7295),t.e(237),t.e(9104),t.e(2993),t.e(9889),t.e(392),t.e(7514),t.e(8482),t.e(5418),t.e(5174),t.e(7007),t.e(1524),t.e(5433),t.e(4431),t.e(9173),t.e(4537),t.e(1802),t.e(4191),t.e(5028),t.e(535),t.e(5100),t.e(393),t.e(5039),t.e(1506),t.e(5796),t.e(4266),t.e(7210),t.e(3484),t.e(9579)]).then(t.bind(t,74759))));let h;const _=e=>{let{message:s,isStreaming:n=!1,onEditMessage:r=null,overrideContent:u=null,avatarUrl:_=null}=e;const p=null!=u?u:s.content,[M,x]=(0,a.useState)(!1),C=(0,a.useMemo)((()=>"assistant"===s.role?p:(0,c.rP)(p)),[p,s.role]),[f,A]=(0,a.useState)(C);(0,a.useEffect)((()=>{A(C)}),[C]),(0,a.useEffect)((()=>{if("assistant"!==s.role||"string"!=typeof p||"undefined"==typeof Worker)return;const e=s.timestamp,a=("undefined"==typeof Worker||h||(h=new Worker(new URL(t.p+t.u(2465),t.b),{type:void 0})),h),n=s=>{s.data.id===e&&(s.data.success?A(s.data.data):A(p))};return a.addEventListener("message",n),a.postMessage({id:e,content:p}),()=>{a.removeEventListener("message",n)}}),[p,s.role,s.timestamp]);const j=(0,a.useMemo)((()=>{switch(s.role){case"user":return _?(0,m.jsx)("img",{src:_,alt:"User avatar",className:i.A.ChatMessage__avatarImg}):null;case"assistant":return(0,m.jsx)(l.MiJ,{size:16,className:i.A.ChatMessage__icon});case"system":return(0,m.jsx)(l.L64,{size:16,className:i.A.ChatMessage__icon});case"error":return(0,m.jsx)(l._0O,{size:16,className:i.A.ChatMessage__icon});default:return null}}),[s.role,_]),v=(0,a.useMemo)((()=>{switch(s.role){case"user":return i.A["ChatMessage--user"];case"assistant":return i.A["ChatMessage--assistant"];case"system":return i.A["ChatMessage--system"];case"error":return i.A["ChatMessage--error"];default:return""}}),[s.role]),N=(0,a.useMemo)((()=>!("assistant"!==s.role||!s.metrics)),[s.role,s.metrics]),y=(0,a.useCallback)((()=>{const e="string"==typeof s.content?s.content:Array.isArray(s.content)?s.content.filter((e=>"text"===e.type)).map((e=>e.text)).join("\n"):"";navigator.clipboard.writeText(e).then((()=>{x(!0),setTimeout((()=>x(!1)),2e3)}))}),[s.content]),$=(0,a.useMemo)((()=>(0,m.jsx)("button",{className:`${i.A.ChatMessage__copyMessageButton} ${"assistant"===s.role&&N?i.A.ChatMessage__copyMessageButtonInMetrics:i.A.ChatMessage__copyMessageButtonBottomRight}`,onClick:y,"aria-label":"Copy message",title:"Copy message",children:M?(0,m.jsx)(l.Srz,{size:16}):(0,m.jsx)(l.TdU,{size:16})})),[y,s.role,N,M]),k=(0,a.useCallback)((()=>{r&&r(s)}),[r,s]),w=(0,a.useMemo)((()=>"user"===s.role?(0,m.jsx)("button",{className:i.A.ChatMessage__editMessageButton,onClick:k,"aria-label":"Edit message",title:"Edit message",children:(0,m.jsx)(l.R2l,{size:16})}):null),[s.role,k]);return(0,m.jsxs)("div",{className:i.A.ChatMessage+" "+v,children:[(0,m.jsxs)("div",{className:i.A.ChatMessage__body,children:[j&&(0,m.jsx)("div",{className:i.A.ChatMessage__avatar,children:j}),(0,m.jsxs)("div",{className:i.A.ChatMessage__contentWrapper,children:[(0,m.jsx)(a.Suspense,{fallback:null,children:(0,m.jsx)("div",{className:i.A.ChatMessage__content,children:"assistant"===s.role?(0,m.jsx)(d,{content:f,isStreaming:n}):(0,m.jsx)(g,{children:f})})}),"assistant"===s.role&&(()=>{if(!N||!s.metrics)return null;const e=n,{elapsedTime:t,tokenCount:a,tokensPerSecond:r,timeToFirstToken:c,promptTokens:u,completionTokens:g,totalTokens:d,finishReason:h}=s.metrics;return null!=t||null!=a||null!=r||null!=c||null!=u||null!=g||null!=d||null!=h?(0,m.jsxs)("div",{className:i.A.ChatMessage__metricsContainer,children:[null!=c&&0!==c&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.O4,{size:14,className:i.A.ChatMessage__metricIcon}),"First Token: ",o(c)]}),null!=t&&0!==t&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.O4,{size:14,className:i.A.ChatMessage__metricIcon}),"Total Time: ",o(t)]}),null!=a&&0!==a&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.MiJ,{size:14,className:i.A.ChatMessage__metricIcon}),"Tokens: ",a]}),null!=u&&0!==u&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.MiJ,{size:14,className:i.A.ChatMessage__metricIcon}),"Prompt: ",u]}),null!=g&&0!==g&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.MiJ,{size:14,className:i.A.ChatMessage__metricIcon}),"Completion: ",g]}),null!=d&&0!==d&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.MiJ,{size:14,className:i.A.ChatMessage__metricIcon}),"Total: ",d]}),null!=r&&0!==r&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.BHx,{size:14,className:i.A.ChatMessage__metricIcon}),"Speed: ",r," t/s"]}),null!=h&&""!==h&&"stop"!==h.toLowerCase()&&"unknown"!==h.toLowerCase()&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l._0O,{size:14,className:i.A.ChatMessage__metricIcon}),h]}),e&&(0,m.jsxs)("span",{className:`${i.A.ChatMessage__metric} ${i.A.ChatMessage__generatingIndicator}`,children:[(0,m.jsx)("span",{className:i.A.ChatMessage__generatingDot}),"Generating..."]}),$]}):null})(),"user"!==s.role&&("assistant"!==s.role||!N)&&$]})]}),"user"===s.role&&(0,m.jsxs)("div",{className:i.A.ChatMessage__actions,children:[w,$]})]})};_.displayName="ChatMessage";const p=(0,a.memo)(_);var M=t(97950),x=t(20104);const C=e=>{let{src:s,alt:t,onClose:a}=e;if(!s)return null;const n=(0,m.jsx)("div",{className:x.A.ImageOverlay,onClick:a,role:"dialog","aria-modal":"true",title:"Click to close image",children:(0,m.jsx)("img",{src:s,alt:t,className:x.A.ImageOverlay__image,onClick:e=>{e.stopPropagation()}})});return M.createPortal(n,document.body)};var f=t(1465);const A=(0,a.forwardRef)(((e,s)=>{let{messages:l,error:i,onEditMessage:o}=e;const{isWaitingForResponse:c}=(0,r.P)(),[u,g]=(0,a.useState)(null),{profilePicture:d}=(0,f.n)(u),[h,_]=(0,a.useState)((()=>localStorage.getItem("idToken"))),[M,x]=(0,a.useState)(null);(0,a.useEffect)((()=>{if(!h)return;let e;return(async()=>{const{getFirebaseAuth:s}=await Promise.all([t.e(3424),t.e(2052),t.e(4698),t.e(2702),t.e(8986),t.e(3815),t.e(8507)]).then(t.bind(t,91729)),{onAuthStateChanged:a}=await Promise.all([t.e(3424),t.e(2052),t.e(4698),t.e(2702),t.e(8986),t.e(3815),t.e(2991)]).then(t.bind(t,94135)),n=s();n&&(e=a(n,(async e=>{if(e){g(e.photoURL||null);try{const s=await e.getIdToken();_(s)}catch{_(null)}}else g(null),_(null)})))})(),()=>{e&&e()}}),[h]);const A=(0,a.useMemo)((()=>{const e=[...l];if(i){const s=Date.now();e.push({id:s,role:"error",content:i,timestamp:s})}return e}),[l,i]);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:n.A.MessageList,ref:s,"aria-live":"polite","aria-relevant":"additions text",children:A.map(((e,s)=>{var t;const a=s===A.length-1,r="assistant"===e.role&&a&&c&&!(null!==(t=e.metrics)&&void 0!==t&&t.isComplete),{images:l,text:i}=function(e){if(!e)return{images:[],text:e};if(Array.isArray(e)){const{images:s,texts:t}=e.reduce(((e,s)=>("image_url"===s.type?e.images.push({url:s.image_url.url,alt:s.image_url.alt||s.alt||null}):"text"===s.type&&e.texts.push(s.text),e)),{images:[],texts:[]});return{images:s,text:t.join(" ")}}return{images:[],text:e}}(e.content),g=e.timestamp?`${e.role}-${e.timestamp}-${s}`:`${e.role}-${s}`;return(0,m.jsxs)("div",{className:n.A.MessageList__messageRow,children:["user"===e.role&&l.length>0&&(0,m.jsx)("div",{className:n.A.MessageList__imageContainer,children:l.map(((e,s)=>(0,m.jsx)("img",{src:e.url,alt:e.alt||`Uploaded image ${s+1}`,className:`${n.A.MessageList__messageImage} ${n.A.MessageList__clickableImage}`,onClick:()=>{return s=e.url,void x(s);var s}},`${g}-img-${s}`)))}),(i||"user"!==e.role)&&(0,m.jsx)(p,{message:e,overrideContent:i||void 0,isStreaming:r,onEditMessage:"user"===e.role?o:void 0,avatarUrl:"user"===e.role&&h?d||u:void 0})]},g)}))}),M&&(0,m.jsx)(C,{src:M,alt:"Image preview",onClose:()=>{x(null)}})]})}));A.displayName="MessageList";const j=(0,a.memo)(A)}}]);
//# sourceMappingURL=chat-messagelist.7ac04bbdb2.chunk.v1_7_5.js.map