"use strict";(self.webpackChunkai_chat_interface=self.webpackChunkai_chat_interface||[]).push([[9823],{12807:(e,s,a)=>{a.d(s,{rP:()=>t});const t=e=>{if("string"!=typeof e||""===e)return"";const s=new RegExp("(```[\\s\\S]*?```)|^(\\s*)\\\\\\[([\\s\\S]*?)\\\\\\](.*)|^(\\s*)\\[\\\\/([\\s\\S]*?)\\\\/](.*)|\\\\\\(\\s*(.*?)\\s*\\\\\\)","gm");let a=e.replace(s,((e,s,a,t,n,r,i,l,o)=>void 0!==s?s:void 0!==a?`${a}$$${t}$$`:void 0!==r?`${r}$$${i}$$`:void 0!==o?`$${o.trim()}$`:e));return a=a.replace(/\n{3,}/g,"\n\n"),a=a.replace(/\n{3,}/g,"\n\n"),a}},43548:(e,s,a)=>{a.r(s),a.d(s,{default:()=>A});var t=a(65043),n=a(66519),r=a(92503),i=a(94692),l=a(30591);function o(e){return e?e<1e3?`${e}ms`:`${(e/1e3).toFixed(1)}s`:"0.0s"}var c=a(12807),m=a(70579);const u=(0,t.lazy)((()=>Promise.all([a.e(4314),a.e(208),a.e(5764),a.e(2042),a.e(4370),a.e(1042),a.e(4912),a.e(4910),a.e(268),a.e(496),a.e(6716),a.e(8990),a.e(8360),a.e(4377),a.e(3542),a.e(8467),a.e(5419),a.e(5174),a.e(7007),a.e(1524),a.e(5433),a.e(4431),a.e(9173),a.e(4537),a.e(1802),a.e(4191),a.e(5028),a.e(535),a.e(5100),a.e(393),a.e(5039),a.e(5444)]).then(a.bind(a,19224))));function g(e){let{children:s}=e;return(0,m.jsx)(t.Suspense,{fallback:(0,m.jsx)("div",{children:s}),children:(0,m.jsx)(u,{children:s})})}const d=(0,t.lazy)((()=>Promise.all([a.e(4314),a.e(208),a.e(5764),a.e(2412),a.e(6017),a.e(399),a.e(4917),a.e(7777),a.e(438),a.e(662),a.e(7272),a.e(7390),a.e(2042),a.e(4370),a.e(1042),a.e(4912),a.e(4910),a.e(268),a.e(496),a.e(6716),a.e(8990),a.e(8360),a.e(4377),a.e(3542),a.e(4734),a.e(6755),a.e(4182),a.e(4582),a.e(8162),a.e(6760),a.e(1217),a.e(822),a.e(4335),a.e(6814),a.e(2489),a.e(9734),a.e(5522),a.e(5080),a.e(1927),a.e(9283),a.e(8476),a.e(5816),a.e(4120),a.e(7295),a.e(237),a.e(9104),a.e(2993),a.e(9889),a.e(392),a.e(7514),a.e(8482),a.e(5418),a.e(5174),a.e(7007),a.e(1524),a.e(5433),a.e(4431),a.e(9173),a.e(4537),a.e(1802),a.e(4191),a.e(5028),a.e(535),a.e(5100),a.e(393),a.e(5039),a.e(1506),a.e(5796),a.e(4266),a.e(7210),a.e(3484),a.e(9579)]).then(a.bind(a,74759))));let h;const _=e=>{let{message:s,isStreaming:n=!1,onEditMessage:r=null,overrideContent:u=null}=e;const _=null!=u?u:s.content,[p,M]=(0,t.useState)(!1),x=(0,t.useMemo)((()=>"assistant"===s.role?_:(0,c.rP)(_)),[_,s.role]),[C,j]=(0,t.useState)(x);(0,t.useEffect)((()=>{if("assistant"!==s.role||"string"!=typeof _||"undefined"==typeof Worker)return;const e=s.timestamp,t=("undefined"==typeof Worker||h||(h=new Worker(new URL(a.p+a.u(2465),a.b),{type:void 0})),h),n=s=>{s.data.id===e&&(s.data.success?j(s.data.data):j(_))};return t.addEventListener("message",n),t.postMessage({id:e,content:_}),()=>{t.removeEventListener("message",n)}}),[_,s.role,s.timestamp]);const A=(0,t.useMemo)((()=>{switch(s.role){case"user":return(0,m.jsx)(i.nXn,{size:16,className:l.A.ChatMessage__icon});case"assistant":return(0,m.jsx)(i.MiJ,{size:16,className:l.A.ChatMessage__icon});case"system":return(0,m.jsx)(i.L64,{size:16,className:l.A.ChatMessage__icon});case"error":return(0,m.jsx)(i._0O,{size:16,className:l.A.ChatMessage__icon});default:return null}}),[s.role]),N=(0,t.useMemo)((()=>{switch(s.role){case"user":return l.A["ChatMessage--user"];case"assistant":return l.A["ChatMessage--assistant"];case"system":return l.A["ChatMessage--system"];case"error":return l.A["ChatMessage--error"];default:return""}}),[s.role]),v=(0,t.useMemo)((()=>!("assistant"!==s.role||!s.metrics)),[s.role,s.metrics]),f=(0,t.useCallback)((()=>{const e="string"==typeof s.content?s.content:Array.isArray(s.content)?s.content.filter((e=>"text"===e.type)).map((e=>e.text)).join("\n"):"";navigator.clipboard.writeText(e).then((()=>{M(!0),setTimeout((()=>M(!1)),2e3)}))}),[s.content]),$=(0,t.useMemo)((()=>(0,m.jsx)("button",{className:`${l.A.ChatMessage__copyMessageButton} ${"assistant"===s.role&&v?l.A.ChatMessage__copyMessageButtonInMetrics:l.A.ChatMessage__copyMessageButtonBottomRight}`,onClick:f,"aria-label":"Copy message",title:"Copy message",children:p?(0,m.jsx)(i.Srz,{size:16}):(0,m.jsx)(i.TdU,{size:16})})),[f,s.role,v,p]),y=(0,t.useCallback)((()=>{r&&r(s)}),[r,s]),k=(0,t.useMemo)((()=>"user"===s.role?(0,m.jsx)("button",{className:l.A.ChatMessage__editMessageButton,onClick:y,"aria-label":"Edit message",title:"Edit message",children:(0,m.jsx)(i.R2l,{size:16})}):null),[s.role,y]);return(0,m.jsxs)("div",{className:l.A.ChatMessage+" "+N,children:[(0,m.jsx)("div",{className:l.A.ChatMessage__avatar,children:A}),(0,m.jsxs)("div",{className:l.A.ChatMessage__contentWrapper,children:[(0,m.jsx)(t.Suspense,{fallback:null,children:(0,m.jsx)("div",{className:l.A.ChatMessage__content,children:"assistant"===s.role?(0,m.jsx)(d,{content:C,isStreaming:n}):(0,m.jsx)(g,{children:C})})}),"assistant"===s.role&&(()=>{if(!v||!s.metrics)return null;const e=n,{elapsedTime:a,tokenCount:t,tokensPerSecond:r,timeToFirstToken:c,promptTokens:u,completionTokens:g,totalTokens:d,finishReason:h}=s.metrics;return null!=a||null!=t||null!=r||null!=c||null!=u||null!=g||null!=d||null!=h?(0,m.jsxs)("div",{className:l.A.ChatMessage__metricsContainer,children:[null!=c&&0!==c&&(0,m.jsxs)("span",{className:l.A.ChatMessage__metric,children:[(0,m.jsx)(i.O4,{size:14,className:l.A.ChatMessage__metricIcon}),"First Token: ",o(c)]}),null!=a&&0!==a&&(0,m.jsxs)("span",{className:l.A.ChatMessage__metric,children:[(0,m.jsx)(i.O4,{size:14,className:l.A.ChatMessage__metricIcon}),"Total Time: ",o(a)]}),null!=t&&0!==t&&(0,m.jsxs)("span",{className:l.A.ChatMessage__metric,children:[(0,m.jsx)(i.MiJ,{size:14,className:l.A.ChatMessage__metricIcon}),"Tokens: ",t]}),null!=u&&0!==u&&(0,m.jsxs)("span",{className:l.A.ChatMessage__metric,children:[(0,m.jsx)(i.MiJ,{size:14,className:l.A.ChatMessage__metricIcon}),"Prompt: ",u]}),null!=g&&0!==g&&(0,m.jsxs)("span",{className:l.A.ChatMessage__metric,children:[(0,m.jsx)(i.MiJ,{size:14,className:l.A.ChatMessage__metricIcon}),"Completion: ",g]}),null!=d&&0!==d&&(0,m.jsxs)("span",{className:l.A.ChatMessage__metric,children:[(0,m.jsx)(i.MiJ,{size:14,className:l.A.ChatMessage__metricIcon}),"Total: ",d]}),null!=r&&0!==r&&(0,m.jsxs)("span",{className:l.A.ChatMessage__metric,children:[(0,m.jsx)(i.BHx,{size:14,className:l.A.ChatMessage__metricIcon}),"Speed: ",r," t/s"]}),null!=h&&""!==h&&(0,m.jsxs)("span",{className:l.A.ChatMessage__metric,children:[(0,m.jsx)(i._0O,{size:14,className:l.A.ChatMessage__metricIcon}),h]}),e&&(0,m.jsxs)("span",{className:`${l.A.ChatMessage__metric} ${l.A.ChatMessage__generatingIndicator}`,children:[(0,m.jsx)("span",{className:l.A.ChatMessage__generatingDot}),"Generating..."]}),$]}):null})(),"user"!==s.role&&("assistant"!==s.role||!v)&&$]}),"user"===s.role&&(0,m.jsxs)("div",{className:l.A.ChatMessage__userButtonContainer,children:[k,$]})]})};_.displayName="ChatMessage";const p=(0,t.memo)(_);var M=a(97950),x=a(20104);const C=e=>{let{src:s,alt:a,isOpen:t,onClose:n}=e;if(!s||!t)return null;const r=(0,m.jsx)("div",{className:x.A.ImageOverlay,onClick:n,role:"dialog","aria-modal":"true",title:"Click to close image",children:(0,m.jsx)("img",{src:s,alt:a,className:x.A.ImageOverlay__image,onClick:e=>{e.stopPropagation()}})});return M.createPortal(r,document.body)},j=(0,t.forwardRef)(((e,s)=>{let{messages:a,error:i,onEditMessage:l}=e;const{isWaitingForResponse:o}=(0,r.P)(),[c,u]=(0,t.useState)(null),g=(0,t.useMemo)((()=>{const e=[...a];return i&&e.push({role:"error",content:i,timestamp:Date.now()}),e}),[a,i]);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:n.A.MessageList,ref:s,"aria-live":"polite","aria-relevant":"additions text",children:g.map(((e,s)=>{var a;const t=s===g.length-1,r="assistant"===e.role&&t&&o&&!(null!==(a=e.metrics)&&void 0!==a&&a.isComplete),{images:i,text:c}=function(e){if(!e)return{images:[],text:e};if(Array.isArray(e)){const{images:s,texts:a}=e.reduce(((e,s)=>("image_url"===s.type?e.images.push({url:s.image_url.url,alt:s.image_url.alt||s.alt||null}):"text"===s.type&&e.texts.push(s.text),e)),{images:[],texts:[]});return{images:s,text:a.join(" ")}}return{images:[],text:e}}(e.content),d=e.timestamp?`${e.role}-${e.timestamp}-${s}`:`${e.role}-${s}`;return(0,m.jsxs)("div",{className:n.A.MessageList__messageRow,children:["user"===e.role&&i.length>0&&(0,m.jsx)("div",{className:n.A.MessageList__imageContainer,children:i.map(((e,s)=>(0,m.jsx)("img",{src:e.url,alt:e.alt||`Uploaded image ${s+1}`,className:`${n.A.MessageList__messageImage} ${n.A.MessageList__clickableImage}`,onClick:()=>{return s=e.url,void u(s);var s}},`${d}-img-${s}`)))}),(c||"user"!==e.role)&&(0,m.jsx)(p,{message:e,overrideContent:c||void 0,isStreaming:r,onEditMessage:"user"===e.role?l:void 0})]},d)}))}),(0,m.jsx)(C,{src:c,onClose:()=>{u(null)}})]})}));j.displayName="MessageList";const A=(0,t.memo)(j)}}]);
//# sourceMappingURL=chat-messagelist.d38db82d.chunk.js.map