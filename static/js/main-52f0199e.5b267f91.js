"use strict";(self.webpackChunkai_chat_interface=self.webpackChunkai_chat_interface||[]).push([[3326],{35016:(e,t,n)=>{n.d(t,{A:()=>i,O:()=>a});var r=n(65043),s=n(70579);const o=(0,r.createContext)(),i=()=>{const e=(0,r.useContext)(o);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},a=e=>{let{children:t}=e;const[i,a]=(0,r.useState)(null),[l,c]=(0,r.useState)(null),[u,d]=(0,r.useState)(!1),[h,m]=(0,r.useState)(null),[p,g]=(0,r.useState)(!1),[v,f]=(0,r.useState)(!1),y=(0,r.useCallback)((async()=>{g(!0)}),[g]),C=(0,r.useCallback)((async()=>{if(!v)return;const{getFirebaseAuth:e}=await Promise.all([n.e(3424),n.e(5171),n.e(4698),n.e(2702),n.e(8986),n.e(3815),n.e(8507)]).then(n.bind(n,91729)),{signOut:t}=await Promise.all([n.e(3424),n.e(5171),n.e(4698),n.e(2702),n.e(8986),n.e(3815),n.e(2991)]).then(n.bind(n,94135)),r=e();if(r)try{await t(r)}catch(e){m(e.message||"Failed to logout.")}else m("Firebase not initialized.")}),[v,m]);(0,r.useEffect)((()=>{let e=null;const t=()=>{f(!0),r()},r=async()=>{d(!0);const{getFirebaseAuth:t}=await Promise.all([n.e(3424),n.e(5171),n.e(4698),n.e(2702),n.e(8986),n.e(3815),n.e(8507)]).then(n.bind(n,91729)),{onAuthStateChanged:r}=await Promise.all([n.e(3424),n.e(5171),n.e(4698),n.e(2702),n.e(8986),n.e(3815),n.e(2991)]).then(n.bind(n,94135)),s=t();s?e=r(s,(async e=>{if(a(e),e)try{const t=await e.getIdToken();c(t);try{localStorage.setItem("idToken",t)}catch(e){}m(null),g(!1)}catch(e){m("Failed to get authentication token."),c(null);const{signOut:t}=await Promise.all([n.e(3424),n.e(5171),n.e(4698),n.e(2702),n.e(8986),n.e(3815),n.e(2991)]).then(n.bind(n,94135));await t(s)}else{c(null);try{localStorage.removeItem("idToken")}catch(e){}g(!1)}d(!1)})):d(!1)};return window.addEventListener("firebaseInitialized",t),()=>{window.removeEventListener("firebaseInitialized",t),"function"==typeof e&&e()}}),[]);const w=(0,r.useMemo)((()=>({currentUser:i,idToken:l,loading:u,error:h,login:y,logout:C,isAuthenticated:!!i&&!!l,isLoggingIn:p,setIsLoggingIn:g,isFirebaseInitialized:v})),[i,l,u,h,y,C,p,g,v]);return(0,s.jsx)(o.Provider,{value:w,children:t})}},36514:(e,t,n)=>{n.d(t,{A:()=>i,g:()=>a});var r=n(65043),s=n(70579);const o=(0,r.createContext)(),i=()=>{const e=(0,r.useContext)(o);if(void 0===e)throw new Error("useChatStatus must be used within a ChatStatusProvider");return e},a=e=>{let{children:t}=e;const[n,i]=(0,r.useState)(!1),[a,l]=(0,r.useState)(null),c=(0,r.useMemo)((()=>({isWaitingForResponse:n,setIsWaitingForResponse:i,error:a,setError:l})),[n,a]);return(0,s.jsx)(o.Provider,{value:c,children:t})}},52523:(e,t,n)=>{n.d(t,{v:()=>v});var r=n(65043),s=n(13005),o=n(91578),i=n(96377),a=n(20409),l=n(36514),c=n(52932),u=n(14255),d=n(71789),h=n(92503),m=n(92167),p=n(70579);const g=(0,r.createContext)(null),v=e=>{let{children:t}=e;const n=(0,r.useMemo)((()=>({isInitialized:!1,setInitialized:e=>{n.isInitialized=e}})),[]);return(0,r.useEffect)((()=>{n.setInitialized(!0)}),[n]),(0,p.jsx)(g.Provider,{value:n,children:(0,p.jsx)(s.N,{children:(0,p.jsx)(o.K,{children:(0,p.jsx)(i.lx,{children:(0,p.jsx)(a.Z,{children:(0,p.jsx)(l.g,{children:(0,p.jsx)(c.U,{children:(0,p.jsx)(u.b,{children:(0,p.jsx)(d.V,{children:(0,p.jsx)(h.h,{children:(0,p.jsx)(m.n,{children:t})})})})})})})})})})})}},52932:(e,t,n)=>{n.d(t,{U:()=>a,m:()=>i});var r=n(65043),s=n(70579);const o=(0,r.createContext)(),i=()=>{const e=(0,r.useContext)(o);if(void 0===e)throw new Error("useChatHistory must be used within a ChatHistoryProvider");return e},a=e=>{let{children:t}=e;const[n,i]=(0,r.useState)([]),a=(0,r.useRef)([]),l=(0,r.useCallback)((e=>{i((t=>{const n="function"==typeof e?e(t):e;return a.current=n,n}))}),[]),c=(0,r.useCallback)(((e,t,n)=>{const r={role:e,content:t,timestamp:Date.now(),...n&&{metrics:n}};return l((e=>[...e,r])),r}),[l]),u=(0,r.useCallback)((e=>{l((t=>{const n=t.length-1;if(n<0)return t;const r=t[n];if("assistant"!==r.role||r.content===e)return t;const s=[...t];return s[n]={...r,content:e},s}))}),[l]),d=(0,r.useMemo)((()=>({chatHistory:n,chatHistoryRef:a,setChatHistory:l,addMessageToHistory:c,updateChatWithContent:u})),[n,l,c,u]);return(0,s.jsx)(o.Provider,{value:d,children:t})}},83717:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var r=n(65043),s=n(23232),o=n(70579);const i=e=>{let{size:t="medium",color:n}=e;const r=s.A[t]||s.A.medium,i=n?{borderTopColor:n}:{};return(0,o.jsx)("div",{className:`${s.A.spinnerContainer} ${r}`,children:(0,o.jsx)("div",{className:s.A.spinner,style:i,"aria-label":"Loading",role:"status"})})},a=r.memo(i)},91578:(e,t,n)=>{n.d(t,{K:()=>a,g:()=>i});var r=n(65043),s=n(70579);const o=(0,r.createContext)(),i=()=>{const e=(0,r.useContext)(o);if(void 0===e)throw new Error("useApi must be used within an ApiProvider");return e},a=e=>{let{children:t}=e;const[n]=(0,r.useState)("http://localhost:3000"),i=(0,r.useMemo)((()=>({apiUrl:n})),[n]);return(0,s.jsx)(o.Provider,{value:i,children:t})}},92167:(e,t,n)=>{n.d(t,{n:()=>v,r:()=>g});var r=n(65043),s=n(91578),o=n(96377),i=n(20409),a=n(35016),l=n(52932),c=n(36514),u=n(14255),d=n(71789),h=n(87164),m=n(70579);const p=(0,r.createContext)(),g=()=>{const e=(0,r.useContext)(p);if(void 0===e)throw new Error("useChatControl must be used within a ChatControlProvider");return e},v=e=>{let{children:t}=e;const n=(0,r.useRef)(null),{apiUrl:g}=(0,s.g)(),{selectedModel:v}=(0,o.fn)(),{settings:f,getModelAdjustedSettings:y}=(0,i.t)(),{idToken:C}=(0,a.A)(),{chatHistoryRef:w,setChatHistory:b,addMessageToHistory:k}=(0,l.m)(),{setIsWaitingForResponse:x,setError:j}=(0,c.A)(),{resetPerformanceMetrics:P,startPerformanceTimer:S,setTokenMetricsForLastMessage:T}=(0,u.B)(),{streamMessageWithFetch:A,stopStreaming:I}=(0,d.$)(),M=(0,r.useCallback)((e=>e&&e.provider&&e.id?`${e.provider}/${e.id}`:null),[]),R=(0,r.useCallback)((async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2)+Date.now().toString(36);n.current=r;const s=null!==t&&Number.isInteger(t)&&t>=0;if(f.streaming)return A(e,s?t:null);if(!e||!v)return j("Please enter a message and select a model"),null;const o=M(v);if(!o)return j("Invalid model selection"),null;let i;s?b((n=>{const r=n.slice(0,t);return i={role:"user",content:e,timestamp:Date.now()},[...r,i]})):i=k("user",e);const a=Date.now();x(!0),j(null);try{var l,c,u,d,m,p;const e=y(v),t=w.current.map((e=>{let{metrics:t,...n}=e;return n}));!e.systemPrompt||t.length&&"system"===t[0].role||t.unshift({role:"system",content:e.systemPrompt,timestamp:Date.now()-1}),t.push(i);const n={requestId:r,model:o,messages:t,temperature:e.temperature,max_tokens:e.max_tokens,top_p:e.top_p,frequency_penalty:e.frequency_penalty,presence_penalty:e.presence_penalty};P(),S();const s={"Content-Type":"application/json",Accept:"application/json"};C&&(s.Authorization=`Bearer ${C}`);const f=await(0,h.J)(new URL("/api/chat/completions",g).toString(),{method:"POST",headers:s,body:JSON.stringify(n)});if(!f.ok){let e=`API error: ${f.status}`;try{var T;const t=await f.json();e=(null==t||null===(T=t.error)||void 0===T?void 0:T.message)||(null==t?void 0:t.message)||e}catch{}throw new Error(e)}const b=await f.json(),x=b.content||"No Response returned",j=b.usage||{},A=null!==(l=null!==(c=j.promptTokens)&&void 0!==c?c:j.prompt_tokens)&&void 0!==l?l:0,I=null!==(u=null!==(d=j.completionTokens)&&void 0!==d?d:j.completion_tokens)&&void 0!==u?u:0,M=null!==(m=null!==(p=j.totalTokens)&&void 0!==p?p:j.total_tokens)&&void 0!==m?m:I,R=Date.now(),_=R-a,F=I>0?I:0,H={startTime:a,endTime:R,elapsedTime:_,tokenCount:F,tokensPerSecond:_?Math.round(F/(_/1e3)*10)/10:null,isComplete:!0,timeToFirstToken:null,promptTokens:A,completionTokens:I,totalTokens:M,finishReason:b.finishReason};return k("assistant",x,H),x}catch(e){return j(e.message),k("error",e.message||"An error occurred"),null}finally{n.current=null,x(!1)}}),[g,v,f.streaming,y,C,w,b,k,A,M,P,S,j,x]),_=(0,r.useCallback)((async()=>(I(),!0)),[I]),F=(0,r.useCallback)((()=>{b([]),P()}),[b,P]),H=(0,r.useCallback)((()=>{const e=w.current;if(!e.length)return;const t=e.map((e=>`${"user"===e.role?"You":"assistant"===e.role?(null==v?void 0:v.name)||"Assistant":e.role}: ${"string"==typeof e.content?e.content:""}\n`)).join(""),n=new Blob([t],{type:"text/plain"}),r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download=`chat_${(new Date).toISOString()}.txt`,document.body.appendChild(s),s.click(),setTimeout((()=>{document.body.removeChild(s),URL.revokeObjectURL(r)}),100)}),[v]),E=(0,r.useCallback)((e=>{}),[]),U=(0,r.useMemo)((()=>({sendMessage:R,stopGeneration:_,addMessageToHistory:k,clearChat:F,downloadChatHistory:H,getOrCreateConversation:E,setTokenMetricsForLastMessage:T})),[R,_,k,F,H,E,T]);return(0,m.jsx)(p.Provider,{value:U,children:t})}},92503:(e,t,n)=>{n.d(t,{P:()=>l,h:()=>c});var r=n(65043),s=n(52932),o=n(36514),i=n(70579);const a=(0,r.createContext)(),l=()=>{const e=(0,r.useContext)(a);if(void 0===e)throw new Error("useChatState must be used within a ChatStateProvider");return e},c=e=>{let{children:t}=e;const{chatHistory:n,chatHistoryRef:l}=(0,s.m)(),{isWaitingForResponse:c,error:u}=(0,o.A)(),d=(0,r.useMemo)((()=>({chatHistory:n,chatHistoryRef:l,isWaitingForResponse:c,error:u})),[n,c,u]);return(0,i.jsx)(a.Provider,{value:d,children:t})}}}]);
//# sourceMappingURL=main-52f0199e.5b267f91.js.map