"use strict";(self.webpackChunkai_chat_interface=self.webpackChunkai_chat_interface||[]).push([[9823],{12807:(e,s,a)=>{a.d(s,{rP:()=>t});const t=e=>{if("string"!=typeof e||""===e)return"";const s=new RegExp("(```[\\s\\S]*?```)|^(\\s*)\\\\\\[([\\s\\S]*?)\\\\\\](.*)|^(\\s*)\\[\\\\/([\\s\\S]*?)\\\\/](.*)|\\\\\\(\\s*(.*?)\\s*\\\\\\)","gm");let a=e.replace(s,((e,s,a,t,n,r,l,i,o)=>void 0!==s?s:void 0!==a?`${a}$$${t}$$`:void 0!==r?`${r}$$${l}$$`:void 0!==o?`$${o.trim()}$`:e));return a=a.replace(/\n{3,}/g,"\n\n"),a=a.replace(/\n{3,}/g,"\n\n"),a}},43548:(e,s,a)=>{a.r(s),a.d(s,{default:()=>A});var t=a(65043),n=a(66519),r=a(92503),l=a(94692),i=a(30591);function o(e){return e?e<1e3?`${e}ms`:`${(e/1e3).toFixed(1)}s`:"0.0s"}var c=a(12807),m=a(70579);const u=(0,t.lazy)((()=>Promise.all([a.e(4314),a.e(208),a.e(5764),a.e(2042),a.e(4370),a.e(1042),a.e(4912),a.e(4910),a.e(268),a.e(496),a.e(6716),a.e(8990),a.e(8360),a.e(4377),a.e(3542),a.e(8467),a.e(5419),a.e(5174),a.e(7007),a.e(1524),a.e(5433),a.e(4431),a.e(9173),a.e(4537),a.e(1802),a.e(4191),a.e(5028),a.e(535),a.e(5100),a.e(393),a.e(5039),a.e(5444)]).then(a.bind(a,19224))));function g(e){let{children:s}=e;return(0,m.jsx)(t.Suspense,{fallback:(0,m.jsx)("div",{children:s}),children:(0,m.jsx)(u,{children:s})})}const d=(0,t.lazy)((()=>Promise.all([a.e(4314),a.e(208),a.e(5764),a.e(2412),a.e(6017),a.e(399),a.e(4917),a.e(7777),a.e(438),a.e(662),a.e(7272),a.e(7390),a.e(2042),a.e(4370),a.e(1042),a.e(4912),a.e(4910),a.e(268),a.e(496),a.e(6716),a.e(8990),a.e(8360),a.e(4377),a.e(3542),a.e(4734),a.e(6755),a.e(4182),a.e(4582),a.e(8162),a.e(6760),a.e(1217),a.e(822),a.e(4335),a.e(6814),a.e(2489),a.e(9734),a.e(5522),a.e(5080),a.e(1927),a.e(9283),a.e(8476),a.e(5816),a.e(4120),a.e(7295),a.e(237),a.e(9104),a.e(2993),a.e(9889),a.e(392),a.e(7514),a.e(8482),a.e(5418),a.e(5174),a.e(7007),a.e(1524),a.e(5433),a.e(4431),a.e(9173),a.e(4537),a.e(1802),a.e(4191),a.e(5028),a.e(535),a.e(5100),a.e(393),a.e(5039),a.e(1506),a.e(5796),a.e(4266),a.e(7210),a.e(3484),a.e(9579)]).then(a.bind(a,74759))));let h;const _=e=>{let{message:s,isStreaming:n=!1,onEditMessage:r=null,overrideContent:u=null,avatarUrl:_=null}=e;const p=null!=u?u:s.content,[M,x]=(0,t.useState)(!1),C=(0,t.useMemo)((()=>"assistant"===s.role?p:(0,c.rP)(p)),[p,s.role]),[j,A]=(0,t.useState)(C);(0,t.useEffect)((()=>{A(C)}),[C]),(0,t.useEffect)((()=>{if("assistant"!==s.role||"string"!=typeof p||"undefined"==typeof Worker)return;const e=s.timestamp,t=("undefined"==typeof Worker||h||(h=new Worker(new URL(a.p+a.u(2465),a.b),{type:void 0})),h),n=s=>{s.data.id===e&&(s.data.success?A(s.data.data):A(p))};return t.addEventListener("message",n),t.postMessage({id:e,content:p}),()=>{t.removeEventListener("message",n)}}),[p,s.role,s.timestamp]);const v=(0,t.useMemo)((()=>{switch(s.role){case"user":return _?(0,m.jsx)("img",{src:_,alt:"User avatar",className:i.A.ChatMessage__avatarImg}):null;case"assistant":return(0,m.jsx)(l.MiJ,{size:16,className:i.A.ChatMessage__icon});case"system":return(0,m.jsx)(l.L64,{size:16,className:i.A.ChatMessage__icon});case"error":return(0,m.jsx)(l._0O,{size:16,className:i.A.ChatMessage__icon});default:return null}}),[s.role,_]),f=(0,t.useMemo)((()=>{switch(s.role){case"user":return i.A["ChatMessage--user"];case"assistant":return i.A["ChatMessage--assistant"];case"system":return i.A["ChatMessage--system"];case"error":return i.A["ChatMessage--error"];default:return""}}),[s.role]),N=(0,t.useMemo)((()=>!("assistant"!==s.role||!s.metrics)),[s.role,s.metrics]),y=(0,t.useCallback)((()=>{const e="string"==typeof s.content?s.content:Array.isArray(s.content)?s.content.filter((e=>"text"===e.type)).map((e=>e.text)).join("\n"):"";navigator.clipboard.writeText(e).then((()=>{x(!0),setTimeout((()=>x(!1)),2e3)}))}),[s.content]),$=(0,t.useMemo)((()=>(0,m.jsx)("button",{className:`${i.A.ChatMessage__copyMessageButton} ${"assistant"===s.role&&N?i.A.ChatMessage__copyMessageButtonInMetrics:i.A.ChatMessage__copyMessageButtonBottomRight}`,onClick:y,"aria-label":"Copy message",title:"Copy message",children:M?(0,m.jsx)(l.Srz,{size:16}):(0,m.jsx)(l.TdU,{size:16})})),[y,s.role,N,M]),k=(0,t.useCallback)((()=>{r&&r(s)}),[r,s]),b=(0,t.useMemo)((()=>"user"===s.role?(0,m.jsx)("button",{className:i.A.ChatMessage__editMessageButton,onClick:k,"aria-label":"Edit message",title:"Edit message",children:(0,m.jsx)(l.R2l,{size:16})}):null),[s.role,k]);return(0,m.jsxs)("div",{className:i.A.ChatMessage+" "+f,children:[(0,m.jsxs)("div",{className:i.A.ChatMessage__body,children:[v&&(0,m.jsx)("div",{className:i.A.ChatMessage__avatar,children:v}),(0,m.jsxs)("div",{className:i.A.ChatMessage__contentWrapper,children:[(0,m.jsx)(t.Suspense,{fallback:null,children:(0,m.jsx)("div",{className:i.A.ChatMessage__content,children:"assistant"===s.role?(0,m.jsx)(d,{content:j,isStreaming:n}):(0,m.jsx)(g,{children:j})})}),"assistant"===s.role&&(()=>{if(!N||!s.metrics)return null;const e=n,{elapsedTime:a,tokenCount:t,tokensPerSecond:r,timeToFirstToken:c,promptTokens:u,completionTokens:g,totalTokens:d,finishReason:h}=s.metrics;return null!=a||null!=t||null!=r||null!=c||null!=u||null!=g||null!=d||null!=h?(0,m.jsxs)("div",{className:i.A.ChatMessage__metricsContainer,children:[null!=c&&0!==c&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.O4,{size:14,className:i.A.ChatMessage__metricIcon}),"First Token: ",o(c)]}),null!=a&&0!==a&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.O4,{size:14,className:i.A.ChatMessage__metricIcon}),"Total Time: ",o(a)]}),null!=t&&0!==t&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.MiJ,{size:14,className:i.A.ChatMessage__metricIcon}),"Tokens: ",t]}),null!=u&&0!==u&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.MiJ,{size:14,className:i.A.ChatMessage__metricIcon}),"Prompt: ",u]}),null!=g&&0!==g&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.MiJ,{size:14,className:i.A.ChatMessage__metricIcon}),"Completion: ",g]}),null!=d&&0!==d&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.MiJ,{size:14,className:i.A.ChatMessage__metricIcon}),"Total: ",d]}),null!=r&&0!==r&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.BHx,{size:14,className:i.A.ChatMessage__metricIcon}),"Speed: ",r," t/s"]}),null!=h&&""!==h&&"stop"!==h.toLowerCase()&&"unknown"!==h.toLowerCase()&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l._0O,{size:14,className:i.A.ChatMessage__metricIcon}),h]}),e&&(0,m.jsxs)("span",{className:`${i.A.ChatMessage__metric} ${i.A.ChatMessage__generatingIndicator}`,children:[(0,m.jsx)("span",{className:i.A.ChatMessage__generatingDot}),"Generating..."]}),$]}):null})(),"user"!==s.role&&("assistant"!==s.role||!N)&&$]})]}),"user"===s.role&&(0,m.jsxs)("div",{className:i.A.ChatMessage__actions,children:[b,$]})]})};_.displayName="ChatMessage";const p=(0,t.memo)(_);var M=a(97950),x=a(20104);const C=e=>{let{src:s,alt:a,onClose:t}=e;if(!s)return null;const n=(0,m.jsx)("div",{className:x.A.ImageOverlay,onClick:t,role:"dialog","aria-modal":"true",title:"Click to close image",children:(0,m.jsx)("img",{src:s,alt:a,className:x.A.ImageOverlay__image,onClick:e=>{e.stopPropagation()}})});return M.createPortal(n,document.body)},j=(0,t.forwardRef)(((e,s)=>{let{messages:l,error:i,onEditMessage:o}=e;const{isWaitingForResponse:c}=(0,r.P)(),[u,g]=(0,t.useState)(null),[d,h]=(0,t.useState)((()=>localStorage.getItem("idToken"))),[_,M]=(0,t.useState)(null);(0,t.useEffect)((()=>{if(!d)return;let e;return(async()=>{const{getFirebaseAuth:s}=await Promise.all([a.e(3424),a.e(2052),a.e(4698),a.e(2702),a.e(8986),a.e(3815),a.e(8507)]).then(a.bind(a,91729)),{onAuthStateChanged:t}=await Promise.all([a.e(3424),a.e(2052),a.e(4698),a.e(2702),a.e(8986),a.e(3815),a.e(2991)]).then(a.bind(a,94135)),n=s();n&&(e=t(n,(async e=>{if(e){g(e.photoURL||null);try{const s=await e.getIdToken();h(s)}catch{h(null)}}else g(null),h(null)})))})(),()=>{e&&e()}}),[d]);const x=(0,t.useMemo)((()=>{const e=[...l];if(i){const s=Date.now();e.push({id:s,role:"error",content:i,timestamp:s})}return e}),[l,i]);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:n.A.MessageList,ref:s,"aria-live":"polite","aria-relevant":"additions text",children:x.map(((e,s)=>{var a;const t=s===x.length-1,r="assistant"===e.role&&t&&c&&!(null!==(a=e.metrics)&&void 0!==a&&a.isComplete),{images:l,text:i}=function(e){if(!e)return{images:[],text:e};if(Array.isArray(e)){const{images:s,texts:a}=e.reduce(((e,s)=>("image_url"===s.type?e.images.push({url:s.image_url.url,alt:s.image_url.alt||s.alt||null}):"text"===s.type&&e.texts.push(s.text),e)),{images:[],texts:[]});return{images:s,text:a.join(" ")}}return{images:[],text:e}}(e.content),g=e.timestamp?`${e.role}-${e.timestamp}-${s}`:`${e.role}-${s}`;return(0,m.jsxs)("div",{className:n.A.MessageList__messageRow,children:["user"===e.role&&l.length>0&&(0,m.jsx)("div",{className:n.A.MessageList__imageContainer,children:l.map(((e,s)=>(0,m.jsx)("img",{src:e.url,alt:e.alt||`Uploaded image ${s+1}`,className:`${n.A.MessageList__messageImage} ${n.A.MessageList__clickableImage}`,onClick:()=>{return s=e.url,void M(s);var s}},`${g}-img-${s}`)))}),(i||"user"!==e.role)&&(0,m.jsx)(p,{message:e,overrideContent:i||void 0,isStreaming:r,onEditMessage:"user"===e.role?o:void 0,avatarUrl:"user"===e.role&&d?u:void 0})]},g)}))}),_&&(0,m.jsx)(C,{src:_,alt:"Image preview",onClose:()=>{M(null)}})]})}));j.displayName="MessageList";const A=(0,t.memo)(j)}}]);
//# sourceMappingURL=chat-messagelist.58198fdee2.chunk.v1_7.js.map