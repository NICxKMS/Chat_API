"use strict";(self.webpackChunkai_chat_interface=self.webpackChunkai_chat_interface||[]).push([["app-large-4f064d56"],{1681:(e,n,t)=>{t.d(n,{M3:()=>i,oo:()=>s});var r=t(85908),o=t(44440);const a=(0,r.q6)(null),s=e=>{let{children:n}=e;const[t,s]=(0,r.J0)({}),i=(0,r.hb)(((e,n)=>{s((t=>({...t,[e]:n})))}),[]),l=(0,r.hb)((e=>!!t[e]),[t]),d=Object.values(t).some((e=>e));return(0,o.Y)(a.Provider,{value:{setLoading:i,isLoading:l,anyLoading:d},children:n})},i=e=>{const n=(0,r.NT)(a);if(!n)throw new Error("useLoading must be used within LoadingProvider");const{setLoading:t,isLoading:o}=n,s=(0,r.hb)((()=>t(e,!0)),[t,e]),i=(0,r.hb)((()=>t(e,!1)),[t,e]);return[o(e),s,i]}},16473:(e,n,t)=>{t.d(n,{A:()=>l,O:()=>d});var r=t(85908),o=t(98096),a=t(1681),s=t(44440);const i=(0,r.q6)(),l=()=>{const e=(0,r.NT)(i);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},d=e=>{let{children:n}=e;const[l,d]=(0,r.J0)(null),[c,u]=(0,r.J0)(null),[m,p]=(0,r.J0)(!1),[,h,b]=(0,a.M3)("auth"),[v,g]=(0,r.J0)(null),[f,y]=(0,r.J0)(!1),[w,T]=(0,r.J0)(!1),{showToast:k}=(0,o.d)();(0,r.vJ)((()=>{m?h():b()}),[m,h,b]);const P=(0,r.hb)((async()=>{if(w)return!0;try{const{getFirebaseAuth:e}=await Promise.all([t.e("firebase-19f9d112"),t.e("firebase-e7e1e1be"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9"),t.e("app-large-4f064d56"),t.e("app-large-31743c5a")]).then(t.bind(t,71752));if(e())return T(!0),!0;throw new Error("Firebase Auth could not be initialized by ensureFirebaseReady")}catch(e){return g(e.message||"Failed to initialize authentication service."),T(!1),k({type:"error",message:e.message||"Failed to initialize auth service."}),!1}}),[w,k]),C=(0,r.hb)((async()=>{y(!0),await P()}),[y,P]),M=(0,r.hb)((async()=>{if(!await P())return void k({type:"error",message:"Authentication service not ready for logout."});const{getFirebaseAuth:e}=await Promise.all([t.e("firebase-19f9d112"),t.e("firebase-e7e1e1be"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9"),t.e("app-large-4f064d56"),t.e("app-large-31743c5a")]).then(t.bind(t,71752)),{signOut:n}=await Promise.all([t.e("firebase-19f9d112"),t.e("firebase-e7e1e1be"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9")]).then(t.bind(t,2660)),r=e();if(!r){const e="Firebase not initialized for logout.";return g(e),void k({type:"error",message:e})}try{await n(r)}catch(o){const e=o.message||"Failed to logout.";g(e),k({type:"error",message:e})}}),[P,g,k]);(0,r.vJ)((()=>{let e=null;return(async()=>{if(!await P())return;p(!0);const{getFirebaseAuth:n}=await Promise.all([t.e("firebase-19f9d112"),t.e("firebase-e7e1e1be"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9"),t.e("app-large-4f064d56"),t.e("app-large-31743c5a")]).then(t.bind(t,71752)),{onAuthStateChanged:r}=await Promise.all([t.e("firebase-19f9d112"),t.e("firebase-e7e1e1be"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9")]).then(t.bind(t,2660)),o=n();o?e=r(o,(async e=>{if(d(e),e)try{const t=await e.getIdToken();u(t);try{localStorage.setItem("idToken",t)}catch(n){}g(null),y(!1)}catch(r){const e="Failed to get authentication token.";g(e),k({type:"error",message:e}),u(null);try{const{signOut:e}=await Promise.all([t.e("firebase-19f9d112"),t.e("firebase-e7e1e1be"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9")]).then(t.bind(t,2660));await e(o)}catch(a){}}else{u(null);try{localStorage.removeItem("idToken")}catch(n){}y(!1)}p(!1)})):p(!1)})(),()=>{"function"==typeof e&&e()}}),[k,P]);const S=(0,r.Kr)((()=>({currentUser:l,idToken:c,loading:m,error:v,login:C,logout:M,isAuthenticated:!!l&&!!c,isLoggingIn:f,setIsLoggingIn:y,isFirebaseReady:w,ensureFirebaseReady:P})),[l,c,m,v,C,M,f,y,w,P]);return(0,s.Y)(i.Provider,{value:S,children:n})}},21344:(e,n,t)=>{t.d(n,{Z:()=>d,t:()=>l});var r=t(85908),o=t(9055),a=t(44440);const s={temperature:.7,top_p:1,max_tokens:8191,frequency_penalty:0,presence_penalty:0,streaming:!0,systemPrompt:"# ðŸ§  System Instruction: University-Level AI Assistant Guide\n\n**You are a knowledgeable, friendly, and supportive university-level assistant.**\nYour mission is to help students understand complex topics with clarity, encouragement, and structureâ€”like a brilliant but approachable mentor or senior student.\n\n---\n\n## âœ¨ Core Principles for Every Response\n\nTo ensure clarity, efficiency, and student comprehension, adhere to these fundamental principles in **every response**:\n\n*   **ðŸ“Š Prioritize Visuals over Dense Text:** **Always try to use tabular or other visual information in place of text if possible.** Use tables, structured lists, and simplified diagrams (described in text) to convey maximum information in minimal words, making concepts immediately graspable.\n*   **ðŸŽ¯ Direct, Concise & Focused:** **Only answer what is directly asked for, and do not explain in detail unless explicitly requested** (e.g., \"explain in detail,\" \"tell me more\"). Always strive for **concise and compact** explanations, avoiding extraneous information. Provide comprehensive content or deeper dives only when prompted or when the topic's inherent complexity *for the specific question* absolutely necessitates it for foundational understanding.\n*   **ðŸ“ Mandatory Math & Code Formatting:** Correct markdown formatting for **mathematical formulas ($ $$)** and **code blocks** is strictly required whenever they are included.\n\n---\n\n## ðŸ“ Response Structure & Content Guidelines\n\nWhile highly adaptable to the specific query, aim to incorporate these elements for optimal learning:\n\n### âœ… 1. Welcoming Introduction\n\nStart every response with a **positive, encouraging, and supportive intro** to set a friendly and helpful tone.\n\n> *Examples:*\n> *   \"Alright! Let's break this down togetherâ€”I'll explain everything step by step with clear examples and helpful tips!\"\n> *   \"You've got this! Here's a structured and easy-to-follow explanation tailored just for you.\"\n\n### 2. Adaptive Content Organization\n\nOrganize your content clearly using markdown headings and visual aids. The specific headings, their order, and their depth should **adapt to best suit the query's complexity and the required level of detail.**\n\n*   **Heading Hierarchy:** Use markdown heading levels ('##', '###', '####', etc.) to create a clear, logical, and multi-level hierarchy. **Maintain an appropriate level/depth for both headings and the content they introduce.** Avoid unnecessary deep nesting; only use more multi-level answering if explicitly requested or inherently necessary for clarity.\n*   **Emoji Usage:** Use emojis **mildly and thoughtfully**, primarily at the start of headings or to highlight key points. They should be **relevant and contextually appropriate**, subtly enhancing clarity and engagement without being overwhelming or purely decorative.\n*   **Whitespace & Readability:** Ensure generous whitespace between sections, paragraphs, and list items. Consistently use bullet points, numbered lists, and clear spacing to enhance readability.\n\n### 3. Core Explanation Elements (Flexible)\n\nIntegrate the following elements as needed, choosing their inclusion, order, and depth based on the user's request and the topic's demands:\n\n*   **Concept Definition:** What is it? Why does it matter? Define jargon.\n*   **Operational Details:** How does it work? Practical applications.\n*   **Examples:** Concrete instances, including formulas or code.\n*   **Key Insights:** Tips, best practices, common pitfalls, comparisons.\n\n### 4. Math & Code Formatting\n\n*   **ðŸ“ Math:**\n    *   Inline: '$E = mc^2$'\n    *   Block:\n        '\n        $$\n        E = mc^2\n        $$\n        '\n\n### 5. Clear Concluding Sections\n\nConclude each response with **one** summary section, using bold headers and bullets:\n\n*   '# âœ… Key Takeaways' â€” *Concise summary for revision.*\n*   '# ðŸ” Next Steps / Related Topics' â€” *Suggestions for deeper exploration or application.*\n\n### 6. Offer Optional Extras\n\nAlways conclude by offering further resources or different learning formats to empower the student:\n\n> \"Would you like me to share any of these optional extras to help you even more?\"\n> *   ðŸ“‹ A summary table\n> *   ðŸ’» Specific code snippets\n> *   ðŸ§  Quick revision notes\n> *   ðŸ“˜ Further reading suggestions\n\n---\n\n## ðŸ—£ï¸ Tone & Formatting Principles\n\n*   **ðŸ§‘â€ðŸ« Tone:** Friendly, motivating, and peer-likeâ€”never robotic or dry. Aim for an approachable, expert voice.\n*   **ðŸ’¡ Accuracy:** Ensure all information is academically sound and precise.\n*   **ðŸ§¼ Formatting Details:**\n    *   **Bold** for emphasis.\n    *   *Italics* for subtle notes or definitions.\n    *   Tables, structured lists, and simplified diagrams for dense or comparative info.\n    *   Emojis used thoughtfully to enhance context.\n\n---\n## ðŸŒŸ The Golden Rule\n\n**Prioritize clarity, accuracy, and student comprehension above all else.** Every element of your response should be directly relevant to the student's query, making learning effective and enjoyable while maintaining a high standard of presentation."},i=(0,r.q6)(),l=()=>{const e=(0,r.NT)(i);if(void 0===e)throw new Error("useSettings must be used within a SettingsProvider");return e},d=e=>{let{children:n}=e;const[t,l]=(0,o.M)("appSettings",s),d=(0,r.hb)(((e,n)=>{e in s&&l((t=>({...t,[e]:n})))}),[l]),c=(0,r.hb)((()=>{l(s)}),[l]),u=(0,r.hb)((e=>!!e&&(!0===e.requiresFixedTemperature||e.properties&&e.properties.includes("fixed_temperature")||e.id&&e.id.toLowerCase().startsWith("o")||e.series&&"o-series"===e.series.toLowerCase())),[]),m=(0,r.hb)((e=>u(e)?{...t,temperature:1}:t),[t,u]),p=(0,r.Kr)((()=>({settings:t,updateSetting:d,resetSettings:c,shouldRestrictTemperature:u,getModelAdjustedSettings:m})),[t,d,c,u,m]);return(0,a.Y)(i.Provider,{value:p,children:n})}},33804:(e,n,t)=>{t.d(n,{P:()=>l,h:()=>d});var r=t(85908),o=t(69643),a=t(66883),s=t(44440);const i=(0,r.q6)(),l=()=>{const e=(0,r.NT)(i);if(void 0===e)throw new Error("useChatState must be used within a ChatStateProvider");return e},d=e=>{let{children:n}=e;const{chatHistory:t,chatHistoryRef:l}=(0,o.m)(),{isWaitingForResponse:d,error:c}=(0,a.A)(),u=(0,r.Kr)((()=>({chatHistory:t,chatHistoryRef:l,isWaitingForResponse:d,error:c})),[t,l,d,c]);return(0,s.Y)(i.Provider,{value:u,children:n})}},35406:(e,n,t)=>{t.d(n,{N7:()=>v,fn:()=>b,lx:()=>g});var r=t(85908),o=t(69817),a=t(9055),s=t(16473),i=t(69573),l=t(98096),d=t(1681),c=t(51437),u=t.n(c),m=t(44440);const p=(0,r.q6)(),h=(0,r.q6)(),b=()=>{const e=(0,r.NT)(p);if(void 0===e)throw new Error("useModel must be used within a ModelProvider");return e},v=()=>{const e=(0,r.NT)(h);if(void 0===e)throw new Error("useModelFilter must be used within a ModelProvider");return e},g=e=>{let{children:n}=e;const{cacheEnabled:t}=(0,i.Y)(),{apiUrl:c}=(0,o.g)(),{idToken:b}=(0,s.A)(),{showToast:v}=(0,l.d)(),[g,f]=(0,r.J0)([]),[y,w]=(0,r.J0)({}),[T,k]=(0,r.J0)([]),[P,C]=(0,a.M)("selectedModel",null),[M,S]=(0,r.J0)(!0),[A,x]=(0,r.J0)(null),[E,I]=(0,a.M)("showExperimental",!1),[F,R]=(0,r.J0)({search:"",categories:{Chat:!0,Image:!0,Embedding:!0}}),[,O,N]=(0,d.M3)("models");(0,r.vJ)((()=>{M?O():N()}),[M,O,N]);const L=(0,r.hb)((e=>e&&e.timestamp&&Date.now()-e.timestamp<432e6&&e.allModels&&e.processedModels&&e.experimentalModels),[]);(0,r.vJ)((()=>{if("undefined"!=typeof window)return window.isCacheValid=L,()=>{delete window.isCacheValid}}),[L]);const J=(0,r.hb)((e=>{try{const n={allModels:e.allModels,processedModels:e.processedModels,experimentalModels:e.experimentalModels,timestamp:Date.now()};localStorage.setItem("modelDropdownCache",JSON.stringify(n))}catch(A){}}),[]),Y=(0,r.hb)(((e,n)=>{R((t=>({...t,categories:{...t.categories,[e]:n}})))}),[]),_=(0,r.hb)((e=>{R((n=>({...n,search:e})))}),[]),D=(0,r.hb)((e=>{(null==P?void 0:P.id)!==(null==e?void 0:e.id)&&C(e)}),[P,C]),z=(0,r.hb)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;S(!0),x(null);try{const r={Accept:"application/json"};if(e){const e=n||b;e&&(r.Authorization=`Bearer ${e}`)}const o=new URL("/api/models/classified",c).toString(),a=await fetch(o,{headers:r});if(!a.ok){let e=`Error fetching models: ${a.status}`;throw new Error(e)}const s=await a.json(),i=new(u());i.onmessage=e=>{let{data:n}=e;if(n.error)x(n.error),v({type:"error",message:n.error});else{const{allModels:e,processedModels:r,experimentalModels:o}=n;if(t){const n=localStorage.getItem("modelDropdownCache");let t;try{t=JSON.parse(n)}catch{t=null}(!t||JSON.stringify(t.allModels)!==JSON.stringify(e)||JSON.stringify(t.processedModels)!==JSON.stringify(r)||JSON.stringify(t.experimentalModels)!==JSON.stringify(o))&&(f(e),w(r),k(o),J({allModels:e,processedModels:r,experimentalModels:o}))}else f(e),w(r),k(o)}S(!1),i.terminate()},i.onerror=e=>{x(e.message),v({type:"error",message:e.message}),S(!1),i.terminate()},i.postMessage(s)}catch(r){x(r.message||"Failed to load model data"),v({type:"error",message:r.message||"Failed to load model data"})}}),[c,J,b,t,v]),q=(0,r.li)(!1),H=(0,r.li)(!1);(0,r.vJ)((()=>{if(!q.current){if(t){const e=localStorage.getItem("modelDropdownCache");let n;try{n=JSON.parse(e)}catch{n=null}n&&window.isCacheValid(n)&&(f(n.allModels),w(n.processedModels),k(n.experimentalModels),S(!1))}let e=null;try{e=localStorage.getItem("idToken")}catch{}e?(H.current=!0,z(!0,e)):z(!1),q.current=!0}}),[]),(0,r.vJ)((()=>{q.current&&b&&!H.current&&(H.current=!0,z(!0))}),[b,z]),(0,r.vJ)((()=>{!P&&g.length>0&&C(g[0])}),[g,P,C]);const j=(0,r.hb)((()=>{I((e=>!e))}),[I]),$=(0,r.Kr)((()=>({allModels:g,processedModels:y,experimentalModels:T,selectedModel:P,isLoading:M,error:A,showExperimental:E,isExperimentalModelsEnabled:E,toggleExperimentalModels:j,setShowExperimental:I,selectModel:D,refreshModels:z})),[g,y,T,P,M,A,E,j,I,D,z]),U=(0,r.Kr)((()=>({modelFilter:F,updateCategoryFilter:Y,updateSearchFilter:_})),[F,Y,_]);return(0,m.Y)(p.Provider,{value:$,children:(0,m.Y)(h.Provider,{value:U,children:n})})}},42692:(e,n,t)=>{t.r(n),t.d(n,{default:()=>O});var r=t(85908),o=t(16473),a=t(96926),s=t(69817),i=t(35406),l=t(21344),d=t(66883),c=t(69643),u=t(72378),m=t(16594),p=t(33804),h=t(54860),b=t(44440);const v=(0,r.q6)(null),g=e=>{let{children:n}=e;const t=(0,r.Kr)((()=>({isInitialized:!1,setInitialized:e=>{t.isInitialized=e}})),[]);return(0,r.vJ)((()=>{t.setInitialized(!0)}),[t]),(0,b.Y)(v.Provider,{value:t,children:(0,b.Y)(a.N,{children:(0,b.Y)(s.K,{children:(0,b.Y)(i.lx,{children:(0,b.Y)(l.Z,{children:(0,b.Y)(d.g,{children:(0,b.Y)(c.U,{children:(0,b.Y)(u.b,{children:(0,b.Y)(m.V,{children:(0,b.Y)(p.h,{children:(0,b.Y)(h.n,{children:n})})})})})})})})})})})};var f=t(25627),y=t(10943),w=t(1245);const T={layout:()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9"),t.e("app-large-4f064d56"),t.e("app-large-31743c5a"),t.e("core-layout")]).then(t.bind(t,42727)),spinner:()=>Promise.resolve().then(t.bind(t,25627))},k={chatContainer:()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9"),t.e("app-large-4f064d56"),t.e("app-large-31743c5a"),t.e("chat-container")]).then(t.bind(t,30154)),chatInput:()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9"),t.e("chat-input")]).then(t.bind(t,5930)),messageList:()=>Promise.all([t.e("worker-bundle"),t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9"),t.e("app-large-4f064d56"),t.e("app-large-31743c5a"),t.e("common")]).then(t.bind(t,70622)),sidebar:()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9"),t.e("app-large-4f064d56"),t.e("app-large-31743c5a"),t.e("layout-sidebar")]).then(t.bind(t,96223)),mainContent:()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("layout-main")]).then(t.bind(t,15873))},P=()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9"),t.e("login-modal")]).then(t.bind(t,42981)),C=(0,w.vL)([()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9"),t.e("app-large-4f064d56"),t.e("app-large-31743c5a"),t.e("common")]).then(t.bind(t,44209)),()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9"),t.e("app-large-4f064d56"),t.e("app-large-31743c5a"),t.e("common")]).then(t.bind(t,16090)),()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9"),t.e("app-large-4f064d56"),t.e("app-large-31743c5a"),t.e("common")]).then(t.bind(t,62773)),()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9"),t.e("app-large-4f064d56"),t.e("app-large-31743c5a"),t.e("common")]).then(t.bind(t,93370)),()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9"),t.e("app-large-4f064d56"),t.e("app-large-31743c5a"),t.e("common")]).then(t.bind(t,87570))],"ui-controls"),M=(0,w.vL)([()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("app-large-4f064d56"),t.e("app-large-31743c5a"),t.e("common"),t.e("features")]).then(t.bind(t,8436)),()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("app-large-4f064d56"),t.e("app-large-31743c5a"),t.e("common"),t.e("features")]).then(t.bind(t,51633)),()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("app-large-4f064d56"),t.e("app-large-31743c5a"),t.e("common"),t.e("features")]).then(t.bind(t,83017))],"features"),S={markdownRenderer:()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("markdown-5aff3c09"),t.e("markdown-2b4841d6"),t.e("markdown-63b8257e"),t.e("markdown-278f6fe7"),t.e("markdown-4c3361fb"),t.e("markdown-27545368"),t.e("katex-9241dc7c"),t.e("katex-6f17a2aa"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9"),t.e("heavy-markdown")]).then(t.bind(t,18623)),streamingMessage:()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("vendor-refractor-f166f706"),t.e("vendor-refractor-750e2801"),t.e("vendor-refractor-914a1695"),t.e("vendor-refractor-afec7163"),t.e("vendor-refractor-69bdd742"),t.e("vendor-refractor-1b8f8385"),t.e("vendor-refractor-06f96589"),t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9"),t.e("app-large-4f064d56"),t.e("app-large-31743c5a"),t.e("common"),t.e("streaming-message")]).then(t.bind(t,65026)),imageOverlay:()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("common")]).then(t.bind(t,27304)),typingIndicator:()=>Promise.all([t.e("styles-e96e9bea"),t.e("styles-31743c5a"),t.e("heavy-typing")]).then(t.bind(t,29078))},A=(0,w.vL)([()=>Promise.all([t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9")]).then(t.bind(t,51189)),()=>Promise.all([t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9")]).then(t.t.bind(t,26331,23)),()=>Promise.all([t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9")]).then(t.t.bind(t,17696,23)),()=>Promise.all([t.e("vendor-bundle-49d0a293"),t.e("vendor-bundle-91c40cd8"),t.e("vendor-bundle-5a94f17d"),t.e("vendor-bundle-876a8ab6"),t.e("vendor-bundle-d3e56ce9")]).then(t.bind(t,54934))],"micro-bundle"),x=(0,r.RZ)(T.layout),E=(0,r.RZ)(P),I=(0,w.CS)(),F=(0,w.qq)();function R(){const[e,n]=(0,r.J0)("initializing"),[t,a]=(0,r.J0)(new Set),[s,i]=(0,r.J0)(null),{isLoggingIn:l,setIsLoggingIn:d}=(0,o.A)();return(0,r.vJ)((()=>{let t=!1;return async function(){y.Hp.mark(y.wz.APP_START);const r=F.getStrategy();i(r);try{if(n("core"),I.startLoad("core"),await(0,w.$n)(T,{groupName:"core",timeout:r.timeout,retries:r.skipNonEssential?1:2}),t)return;if(I.endLoad("core",!0),y.Hp.mark(y.wz.IMPORTANT_COMPONENTS_LOADED),a((e=>new Set([...e,"core"]))),n("essential"),I.startLoad("essential"),await(0,w.$n)(k,{groupName:"essential",timeout:r.timeout,retries:r.skipNonEssential?1:2}),t)return;if(I.endLoad("essential",!0),a((e=>new Set([...e,"essential"]))),n("controls"),I.startLoad("ui-controls"),await(0,w.$n)(C,{groupName:"ui-controls",timeout:r.timeout,retries:1}),t)return;I.endLoad("ui-controls",!0),y.Hp.mark(y.wz.COMPONENT_LOAD),y.Hp.measure(y.l9.COMPONENT_LOAD,y.wz.APP_START,y.wz.COMPONENT_LOAD),a((e=>new Set([...e,"ui-controls"]))),n("ready"),requestAnimationFrame((()=>{t||(y.Hp.mark(y.wz.APP_INTERACTIVE),y.Hp.measure(y.l9.TIME_TO_INTERACTIVE,y.wz.APP_START,y.wz.APP_INTERACTIVE),r.skipNonEssential||setTimeout((()=>{y.Hp.mark(y.wz.POST_INTERACTIVE_PRELOAD_START);const e={"secondary-features":{imports:M,priority:0,options:{timeout:r.timeout}},"heavy-components":{imports:{streamingMessage:S.streamingMessage,imageOverlay:S.imageOverlay,typingIndicator:S.typingIndicator},priority:1,options:{timeout:1.5*r.timeout}},"micro-components":{imports:A,priority:3,options:{timeout:r.timeout}}};(0,w.Oj)(e,{maxConcurrent:2*r.maxConcurrent,priorityDelay:r.priorityDelay,idleTimeout:r.timeout}),Object.keys(e).forEach((e=>{I.startLoad(e)}))}),250))}))}catch(o){I.endLoad(e,!1),n("error")}}(),()=>{t=!0,y.Hp.clear()}}),[]),"ready"===e||t.has("ui-controls"),"initializing"===e||"core"===e?(0,b.FD)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",flexDirection:"column",gap:"1rem"},children:[(0,b.Y)(f.default,{size:"medium"}),(0,b.FD)("div",{style:{fontSize:"0.875rem",opacity:.7},children:["Loading ",e,"...",s&&(0,b.FD)("div",{style:{fontSize:"0.75rem",marginTop:"0.5rem"},children:["Network: ",s.effectiveType||"detecting..."]})]})]}):"error"===e?(0,b.FD)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",flexDirection:"column",gap:"1rem"},children:[(0,b.Y)("div",{children:"âš ï¸ Loading Error"}),(0,b.Y)("button",{onClick:()=>window.location.reload(),children:"Reload App"}),!1]}):(0,b.FD)(b.FK,{children:[(0,b.Y)(r.tY,{fallback:(0,b.Y)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},children:(0,b.Y)(f.default,{size:"small"})}),children:(0,b.Y)(x,{})}),l&&t.has("ui-controls")&&(0,b.Y)(r.tY,{fallback:(0,b.Y)(f.default,{size:"small"}),children:(0,b.Y)(E,{onClose:()=>d(!1)})}),!1]})}function O(){return(0,b.Y)(o.O,{children:(0,b.Y)(g,{children:(0,b.Y)(R,{})})})}},54860:(e,n,t)=>{t.d(n,{n:()=>g,r:()=>v});var r=t(85908),o=t(69817),a=t(35406),s=t(21344),i=t(16473),l=t(69643),d=t(66883),c=t(72378),u=t(16594),m=t(93827),p=t(98096),h=t(44440);const b=(0,r.q6)(),v=()=>{const e=(0,r.NT)(b);if(void 0===e)throw new Error("useChatControl must be used within a ChatControlProvider");return e},g=e=>{let{children:n}=e;const t=(0,r.li)(null),{apiUrl:v}=(0,o.g)(),{selectedModel:g}=(0,a.fn)(),{settings:f,getModelAdjustedSettings:y}=(0,s.t)(),{idToken:w}=(0,i.A)(),{chatHistoryRef:T,setChatHistory:k,addMessageToHistory:P}=(0,l.m)(),{setIsWaitingForResponse:C,setError:M}=(0,d.A)(),{resetPerformanceMetrics:S,startPerformanceTimer:A,setTokenMetricsForLastMessage:x}=(0,c.B)(),{streamMessageWithFetch:E,stopStreaming:I}=(0,u.$)(),{showToast:F}=(0,p.d)(),R=(0,r.hb)((e=>e&&e.provider&&e.id?`${e.provider}/${e.id}`:null),[]),O=(0,r.hb)((async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2)+Date.now().toString(36);t.current=r;const o=null!==n&&Number.isInteger(n)&&n>=0;if(f.streaming)return E(e,o?n:null);if(!e||!g)return M("Please enter a message and select a model"),null;const a=R(g);if(!a)return M("Invalid model selection"),null;let s;o?k((t=>{const r=t.slice(0,n),o=t[n];return s={...o,content:e},[...r,s]})):s=P("user",e);const i=Date.now();C(!0),M(null);try{var l,d,c,u,p,h,b;const e=y(g),n=T.current.map((e=>{let{metrics:n,...t}=e;return t}));!e.systemPrompt||n.length&&"system"===n[0].role||n.unshift({role:"system",content:e.systemPrompt,timestamp:Date.now()-1}),n.push(s);const t={requestId:r,model:a,messages:n,temperature:e.temperature,max_tokens:e.max_tokens,top_p:e.top_p,frequency_penalty:e.frequency_penalty,presence_penalty:e.presence_penalty};S(),A();const o={"Content-Type":"application/json",Accept:"application/json"};w&&(o.Authorization=`Bearer ${w}`);const f=await(0,m.J)(new URL("/api/chat/completions",v).toString(),{method:"POST",headers:o,body:JSON.stringify(t)});if(!f.ok){let e=`API error: ${f.status}`;try{var x;const n=await f.json();e=(null==n||null===(x=n.error)||void 0===x?void 0:x.message)||(null==n?void 0:n.message)||e}catch{}throw new Error(e)}const k=await f.json();if(null!==(l=k.error)&&void 0!==l&&l.message||"error"===k.finishReason){var I,F,O,N,L,J,Y;const e=(null===(I=k.error)||void 0===I?void 0:I.message)||"Error occurred during generation";M(e);const n=k.usage||{},t=null!==(F=null!==(O=n.promptTokens)&&void 0!==O?O:n.prompt_tokens)&&void 0!==F?F:0,r=null!==(N=null!==(L=n.completionTokens)&&void 0!==L?L:n.completion_tokens)&&void 0!==N?N:0,o=null!==(J=null!==(Y=n.totalTokens)&&void 0!==Y?Y:n.total_tokens)&&void 0!==J?J:r,a=Date.now(),s=a-i,l={startTime:i,endTime:a,elapsedTime:s,tokenCount:r,tokensPerSecond:s?Math.round(r/(s/1e3)*10)/10:null,isComplete:!0,timeToFirstToken:null,promptTokens:t,completionTokens:r,totalTokens:o,finishReason:k.finishReason||"error",error:!0};return P("assistant",e,l),null}const C=k.content||"No Response returned",E=k.usage||{},R=null!==(d=null!==(c=E.promptTokens)&&void 0!==c?c:E.prompt_tokens)&&void 0!==d?d:0,_=null!==(u=null!==(p=E.completionTokens)&&void 0!==p?p:E.completion_tokens)&&void 0!==u?u:0,D=null!==(h=null!==(b=E.totalTokens)&&void 0!==b?b:E.total_tokens)&&void 0!==h?h:_,z=Date.now(),q=z-i,H=_>0?_:0,j={startTime:i,endTime:z,elapsedTime:q,tokenCount:H,tokensPerSecond:q?Math.round(H/(q/1e3)*10)/10:null,isComplete:!0,timeToFirstToken:null,promptTokens:R,completionTokens:_,totalTokens:D,finishReason:k.finishReason};return P("assistant",C,j),C}catch(_){return M(_.message),P("assistant",_.message||"An error occurred"),null}finally{t.current=null,C(!1)}}),[v,g,f.streaming,y,w,T,k,P,E,R,S,A,M,C]),N=(0,r.hb)((async()=>(I(),!0)),[I]),L=(0,r.hb)((()=>{k([]),S()}),[k,S]),J=(0,r.hb)((()=>{T.current.length>0&&L()}),[T,L]),Y=(0,r.hb)((()=>{0!==T.current.length&&window.confirm("Are you sure you want to clear the current chat?")&&(L(),F({type:"info",message:"Chat has been cleared"}))}),[T,L,F]),_=(0,r.hb)((()=>{const e=T.current;if(e.length)try{const n=e.map((e=>{const n="user"===e.role?"You":"assistant"===e.role?(null==g?void 0:g.name)||"Assistant":e.role;let t="";return"string"==typeof e.content?t=e.content:Array.isArray(e.content)&&(t=e.content.map((e=>"text"===e.type?e.text:"[Image]")).join("\n")),`${n}: ${t}\n`})).join(""),t=new Blob([n],{type:"text/plain"}),r=URL.createObjectURL(t),o=document.createElement("a");o.href=r,o.download=`chat_${(new Date).toISOString().replace(/:/g,"-")}.txt`,document.body.appendChild(o),o.click(),F({type:"success",message:"Chat downloaded successfully"}),document.body.removeChild(o),URL.revokeObjectURL(r)}catch(n){F({type:"error",message:"Failed to download chat. Please try again."})}}),[T,g,F]),D=(0,r.hb)((e=>{}),[]),z=(0,r.Kr)((()=>({sendMessage:O,stopGeneration:N,addMessageToHistory:P,clearChat:L,newChat:J,resetChat:Y,downloadChat:_,getOrCreateConversation:D,setTokenMetricsForLastMessage:x})),[O,N,P,L,J,Y,_,D,x]);return(0,h.Y)(b.Provider,{value:z,children:n})}},66883:(e,n,t)=>{t.d(n,{A:()=>i,g:()=>l});var r=t(85908),o=t(1681),a=t(44440);const s=(0,r.q6)(),i=()=>{const e=(0,r.NT)(s);if(void 0===e)throw new Error("useChatStatus must be used within a ChatStatusProvider");return e},l=e=>{let{children:n}=e;const[t,i]=(0,r.J0)(!1),[l,d]=(0,r.J0)(null),[,c,u]=(0,o.M3)("chat");(0,r.vJ)((()=>{t?c():u()}),[t,c,u]);const m=(0,r.Kr)((()=>({isWaitingForResponse:t,setIsWaitingForResponse:i,error:l,setError:d})),[t,l]);return(0,a.Y)(s.Provider,{value:m,children:n})}},69643:(e,n,t)=>{t.d(n,{U:()=>i,m:()=>s});var r=t(85908),o=t(44440);const a=(0,r.q6)(),s=()=>{const e=(0,r.NT)(a);if(void 0===e)throw new Error("useChatHistory must be used within a ChatHistoryProvider");return e},i=e=>{let{children:n}=e;const[t,s]=(0,r.J0)([]),i=(0,r.li)([]),l=(0,r.hb)((e=>{s((n=>{const t="function"==typeof e?e(n):e;return i.current=t,t}))}),[]),d=(0,r.hb)(((e,n,t)=>{const r=Date.now(),o={id:r,role:e,content:n,timestamp:r,...t&&{metrics:t}};return l((e=>[...e,o])),o}),[l]),c=(0,r.hb)((e=>{l((n=>{const t=n.length-1;if(t<0)return n;const r=n[t];if("assistant"!==r.role||r.content===e)return n;const o=[...n];return o[t]={...r,content:e},o}))}),[l]),u=(0,r.Kr)((()=>({chatHistory:t,chatHistoryRef:i,setChatHistory:l,addMessageToHistory:d,updateChatWithContent:c})),[t,l,d,c]);return(0,o.Y)(a.Provider,{value:u,children:n})}},69817:(e,n,t)=>{t.d(n,{K:()=>i,g:()=>s});var r=t(85908),o=t(44440);const a=(0,r.q6)(),s=()=>{const e=(0,r.NT)(a);if(void 0===e)throw new Error("useApi must be used within an ApiProvider");return e},i=e=>{let{children:n}=e;const[t]=(0,r.J0)("http://localhost:3000"),s=(0,r.Kr)((()=>({apiUrl:t})),[t]);return(0,o.Y)(a.Provider,{value:s,children:n})}},72378:(e,n,t)=>{t.d(n,{B:()=>i,b:()=>l});var r=t(85908),o=t(69643),a=t(44440);const s=(0,r.q6)(),i=()=>{const e=(0,r.NT)(s);if(void 0===e)throw new Error("usePerformanceMetrics must be used within a PerformanceMetricsProvider");return e},l=e=>{let{children:n}=e;const{setChatHistory:t}=(0,o.m)(),[i,l]=(0,r.J0)({startTime:null,endTime:null,elapsedTime:null,tokenCount:null,tokensPerSecond:null,isComplete:!1,timeToFirstToken:null,promptTokens:null,completionTokens:null,totalTokens:null,finishReason:null}),d=(0,r.hb)((()=>{l({startTime:null,endTime:null,elapsedTime:null,tokenCount:null,tokensPerSecond:null,isComplete:!1,timeToFirstToken:null,promptTokens:null,completionTokens:null,totalTokens:null,finishReason:null})}),[]),c=(0,r.hb)((()=>{l((e=>({...e,startTime:Date.now(),isComplete:!1})))}),[]),u=(0,r.hb)((function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;l((o=>{const a=Date.now(),s=o.startTime?a-o.startTime:0,i=e&&s?Math.round(e/(s/1e3)*10)/10:o.tokensPerSecond,l=o.timeToFirstToken||(e>0?s:null);return{startTime:o.startTime,endTime:a,elapsedTime:s,tokenCount:e,tokensPerSecond:i,isComplete:n,timeToFirstToken:l,promptTokens:(null==t?void 0:t.promptTokens)||o.promptTokens,completionTokens:(null==t?void 0:t.completionTokens)||o.completionTokens,totalTokens:(null==t?void 0:t.totalTokens)||o.totalTokens,finishReason:r||o.finishReason}}))}),[]);(0,r.vJ)((()=>{null!=i.endTime&&t((e=>{const n=[...e],t=n[n.length-1];return t&&"assistant"===t.role&&(t.metrics={...i}),n}))}),[i,t]);const m=(0,r.hb)((e=>{t((n=>{const t=[...n],r=t[t.length-1];return r&&"assistant"===r.role&&(r.metrics={...r.metrics||{},...e,isComplete:!0}),t}))}),[t]),p=(0,r.Kr)((()=>({currentMessageMetrics:i,resetPerformanceMetrics:d,startPerformanceTimer:c,updatePerformanceMetrics:u,setTokenMetricsForLastMessage:m})),[i,d,c,u,m]);return(0,a.Y)(s.Provider,{value:p,children:n})}}}]);
//# sourceMappingURL=app-large-4f064d56.452e956af2.v1_9_7.js.map