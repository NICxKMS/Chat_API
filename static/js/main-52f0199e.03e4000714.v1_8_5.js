"use strict";(self.webpackChunkai_chat_interface=self.webpackChunkai_chat_interface||[]).push([[3326],{35016:(e,t,s)=>{s.d(t,{A:()=>i,O:()=>c});var n=s(65043),o=s(47035),r=s(50578),a=s(70579);const l=(0,n.createContext)(),i=()=>{const e=(0,n.useContext)(l);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},c=e=>{let{children:t}=e;const[i,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(null),[m,h]=(0,n.useState)(!1),[,p,g]=(0,r.M3)("auth"),[f,v]=(0,n.useState)(null),[w,y]=(0,n.useState)(!1),[C,k]=(0,n.useState)(!1),{showToast:x}=(0,o.d)();(0,n.useEffect)((()=>{m?p():g()}),[m,p,g]);const M=(0,n.useCallback)((async()=>{y(!0)}),[y]),b=(0,n.useCallback)((async()=>{if(!C)return;const{getFirebaseAuth:e}=await Promise.all([s.e(3424),s.e(2052),s.e(4698),s.e(2702),s.e(8986),s.e(3815),s.e(8507)]).then(s.bind(s,91729)),{signOut:t}=await Promise.all([s.e(3424),s.e(2052),s.e(4698),s.e(2702),s.e(8986),s.e(3815),s.e(2991)]).then(s.bind(s,94135)),n=e();if(!n){const e="Firebase not initialized.";return v(e),void x({type:"error",message:e})}try{await t(n)}catch(e){const t=e.message||"Failed to logout.";v(t),x({type:"error",message:t})}}),[C,v,x]);(0,n.useEffect)((()=>{let e=null;const t=()=>{k(!0),n()},n=async()=>{h(!0);const{getFirebaseAuth:t}=await Promise.all([s.e(3424),s.e(2052),s.e(4698),s.e(2702),s.e(8986),s.e(3815),s.e(8507)]).then(s.bind(s,91729)),{onAuthStateChanged:n}=await Promise.all([s.e(3424),s.e(2052),s.e(4698),s.e(2702),s.e(8986),s.e(3815),s.e(2991)]).then(s.bind(s,94135)),o=t();o?e=n(o,(async e=>{if(c(e),e)try{const t=await e.getIdToken();u(t);try{localStorage.setItem("idToken",t)}catch(e){}v(null),y(!1)}catch(e){const t="Failed to get authentication token.";v(t),x({type:"error",message:t}),u(null);const{signOut:n}=await Promise.all([s.e(3424),s.e(2052),s.e(4698),s.e(2702),s.e(8986),s.e(3815),s.e(2991)]).then(s.bind(s,94135));await n(o)}else{u(null);try{localStorage.removeItem("idToken")}catch(e){}y(!1)}h(!1)})):h(!1)};return window.addEventListener("firebaseInitialized",t),()=>{window.removeEventListener("firebaseInitialized",t),"function"==typeof e&&e()}}),[x]);const S=(0,n.useMemo)((()=>({currentUser:i,idToken:d,loading:m,error:f,login:M,logout:b,isAuthenticated:!!i&&!!d,isLoggingIn:w,setIsLoggingIn:y,isFirebaseInitialized:C})),[i,d,m,f,M,b,w,y,C]);return(0,a.jsx)(l.Provider,{value:S,children:t})}},36514:(e,t,s)=>{s.d(t,{A:()=>l,g:()=>i});var n=s(65043),o=s(50578),r=s(70579);const a=(0,n.createContext)(),l=()=>{const e=(0,n.useContext)(a);if(void 0===e)throw new Error("useChatStatus must be used within a ChatStatusProvider");return e},i=e=>{let{children:t}=e;const[s,l]=(0,n.useState)(!1),[i,c]=(0,n.useState)(null),[,d,u]=(0,o.M3)("chat");(0,n.useEffect)((()=>{s?d():u()}),[s,d,u]);const m=(0,n.useMemo)((()=>({isWaitingForResponse:s,setIsWaitingForResponse:l,error:i,setError:c})),[s,i]);return(0,r.jsx)(a.Provider,{value:m,children:t})}},50578:(e,t,s)=>{s.d(t,{M3:()=>l,oo:()=>a});var n=s(65043),o=s(70579);const r=(0,n.createContext)(null),a=e=>{let{children:t}=e;const[s,a]=(0,n.useState)({}),l=(0,n.useCallback)(((e,t)=>{a((s=>({...s,[e]:t})))}),[]),i=(0,n.useCallback)((e=>!!s[e]),[s]),c=Object.values(s).some((e=>e));return(0,o.jsx)(r.Provider,{value:{setLoading:l,isLoading:i,anyLoading:c},children:t})},l=e=>{const t=(0,n.useContext)(r);if(!t)throw new Error("useLoading must be used within LoadingProvider");const{setLoading:s,isLoading:o}=t,a=(0,n.useCallback)((()=>s(e,!0)),[s,e]),l=(0,n.useCallback)((()=>s(e,!1)),[s,e]);return[o(e),a,l]}},52523:(e,t,s)=>{s.d(t,{v:()=>f});var n=s(65043),o=s(13005),r=s(91578),a=s(96377),l=s(20409),i=s(36514),c=s(52932),d=s(14255),u=s(71789),m=s(92503),h=s(92167),p=s(70579);const g=(0,n.createContext)(null),f=e=>{let{children:t}=e;const s=(0,n.useMemo)((()=>({isInitialized:!1,setInitialized:e=>{s.isInitialized=e}})),[]);return(0,n.useEffect)((()=>{s.setInitialized(!0)}),[s]),(0,p.jsx)(g.Provider,{value:s,children:(0,p.jsx)(o.N,{children:(0,p.jsx)(r.K,{children:(0,p.jsx)(a.lx,{children:(0,p.jsx)(l.Z,{children:(0,p.jsx)(i.g,{children:(0,p.jsx)(c.U,{children:(0,p.jsx)(d.b,{children:(0,p.jsx)(u.V,{children:(0,p.jsx)(m.h,{children:(0,p.jsx)(h.n,{children:t})})})})})})})})})})})}},52932:(e,t,s)=>{s.d(t,{U:()=>l,m:()=>a});var n=s(65043),o=s(70579);const r=(0,n.createContext)(),a=()=>{const e=(0,n.useContext)(r);if(void 0===e)throw new Error("useChatHistory must be used within a ChatHistoryProvider");return e},l=e=>{let{children:t}=e;const[s,a]=(0,n.useState)([]),l=(0,n.useRef)([]),i=(0,n.useCallback)((e=>{a((t=>{const s="function"==typeof e?e(t):e;return l.current=s,s}))}),[]),c=(0,n.useCallback)(((e,t,s)=>{const n=Date.now(),o={id:n,role:e,content:t,timestamp:n,...s&&{metrics:s}};return i((e=>[...e,o])),o}),[i]),d=(0,n.useCallback)((e=>{i((t=>{const s=t.length-1;if(s<0)return t;const n=t[s];if("assistant"!==n.role||n.content===e)return t;const o=[...t];return o[s]={...n,content:e},o}))}),[i]),u=(0,n.useMemo)((()=>({chatHistory:s,chatHistoryRef:l,setChatHistory:i,addMessageToHistory:c,updateChatWithContent:d})),[s,i,c,d]);return(0,o.jsx)(r.Provider,{value:u,children:t})}},57040:(e,t,s)=>{s.d(t,{A:()=>r});s(65043);var n=s(65360),o=s(70579);const r=e=>{let{toasts:t,dismissToast:s}=e;return(0,o.jsx)("div",{className:n.A.toastContainer,children:t.map((e=>(0,o.jsxs)("div",{className:`${n.A.toast} ${n.A[e.type]||""}`,children:[(0,o.jsx)("span",{className:n.A.message,children:e.message}),(0,o.jsx)("button",{type:"button",className:n.A.closeButton,onClick:()=>s(e.id),"aria-label":"Close notification",children:"Ã—"})]},e.id)))})}},83717:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});s(65043);var n=s(23232),o=s(70579);const r=e=>{let{size:t="medium",tag:s}=e;const r=n.A[`Spinner--${t}`]||n.A["Spinner--medium"];return(0,o.jsx)("div",{className:`${n.A.Spinner} ${r}`,"data-loading-tag":s,"aria-label":"Loading",role:"status",children:(0,o.jsx)("div",{className:n.A.Spinner__loader})})}},88046:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(65043),o=s(50578),r=s(47035);const a=()=>{const[e]=(0,o.M3)("auth"),t=e,{showToast:s,dismissToast:a}=(0,r.d)(),l=(0,n.useRef)(null);return(0,n.useEffect)((()=>(t?l.current=s({type:"info",message:"Loading in progress...",duration:0}):l.current&&(a(l.current),s({type:"success",message:"Loading complete",duration:2e3}),l.current=null),()=>{l.current&&(a(l.current),l.current=null)})),[t,s,a]),null}},91578:(e,t,s)=>{s.d(t,{K:()=>l,g:()=>a});var n=s(65043),o=s(70579);const r=(0,n.createContext)(),a=()=>{const e=(0,n.useContext)(r);if(void 0===e)throw new Error("useApi must be used within an ApiProvider");return e},l=e=>{let{children:t}=e;const[s]=(0,n.useState)("http://localhost:3000"),a=(0,n.useMemo)((()=>({apiUrl:s})),[s]);return(0,o.jsx)(r.Provider,{value:a,children:t})}},92167:(e,t,s)=>{s.d(t,{n:()=>v,r:()=>f});var n=s(65043),o=s(91578),r=s(96377),a=s(20409),l=s(35016),i=s(52932),c=s(36514),d=s(14255),u=s(71789),m=s(87164),h=s(47035),p=s(70579);const g=(0,n.createContext)(),f=()=>{const e=(0,n.useContext)(g);if(void 0===e)throw new Error("useChatControl must be used within a ChatControlProvider");return e},v=e=>{let{children:t}=e;const s=(0,n.useRef)(null),{apiUrl:f}=(0,o.g)(),{selectedModel:v}=(0,r.fn)(),{settings:w,getModelAdjustedSettings:y}=(0,a.t)(),{idToken:C}=(0,l.A)(),{chatHistoryRef:k,setChatHistory:x,addMessageToHistory:M}=(0,i.m)(),{setIsWaitingForResponse:b,setError:S}=(0,c.A)(),{resetPerformanceMetrics:T,startPerformanceTimer:j,setTokenMetricsForLastMessage:A}=(0,d.B)(),{streamMessageWithFetch:E,stopStreaming:P}=(0,u.$)(),{showToast:I}=(0,h.d)(),R=(0,n.useCallback)((e=>e&&e.provider&&e.id?`${e.provider}/${e.id}`:null),[]),L=(0,n.useCallback)((async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2)+Date.now().toString(36);s.current=n;const o=null!==t&&Number.isInteger(t)&&t>=0;if(w.streaming)return E(e,o?t:null);if(!e||!v)return S("Please enter a message and select a model"),null;const r=R(v);if(!r)return S("Invalid model selection"),null;let a;o?x((s=>{const n=s.slice(0,t),o=s[t];return a={...o,content:e},[...n,a]})):a=M("user",e);const l=Date.now();b(!0),S(null);try{var i,c,d,u,h,p,g;const e=y(v),t=k.current.map((e=>{let{metrics:t,...s}=e;return s}));!e.systemPrompt||t.length&&"system"===t[0].role||t.unshift({role:"system",content:e.systemPrompt,timestamp:Date.now()-1}),t.push(a);const s={requestId:n,model:r,messages:t,temperature:e.temperature,max_tokens:e.max_tokens,top_p:e.top_p,frequency_penalty:e.frequency_penalty,presence_penalty:e.presence_penalty};T(),j();const o={"Content-Type":"application/json",Accept:"application/json"};C&&(o.Authorization=`Bearer ${C}`);const w=await(0,m.J)(new URL("/api/chat/completions",f).toString(),{method:"POST",headers:o,body:JSON.stringify(s)});if(!w.ok){let e=`API error: ${w.status}`;try{var A;const t=await w.json();e=(null==t||null===(A=t.error)||void 0===A?void 0:A.message)||(null==t?void 0:t.message)||e}catch{}throw new Error(e)}const x=await w.json();if(null!==(i=x.error)&&void 0!==i&&i.message||"error"===x.finishReason){var P,I,L,F,_,N,O;const e=(null===(P=x.error)||void 0===P?void 0:P.message)||"Error occurred during generation";S(e);const t=x.usage||{},s=null!==(I=null!==(L=t.promptTokens)&&void 0!==L?L:t.prompt_tokens)&&void 0!==I?I:0,n=null!==(F=null!==(_=t.completionTokens)&&void 0!==_?_:t.completion_tokens)&&void 0!==F?F:0,o=null!==(N=null!==(O=t.totalTokens)&&void 0!==O?O:t.total_tokens)&&void 0!==N?N:n,r=Date.now(),a=r-l,i={startTime:l,endTime:r,elapsedTime:a,tokenCount:n,tokensPerSecond:a?Math.round(n/(a/1e3)*10)/10:null,isComplete:!0,timeToFirstToken:null,promptTokens:s,completionTokens:n,totalTokens:o,finishReason:x.finishReason||"error",error:!0};return M("assistant",e,i),null}const b=x.content||"No Response returned",E=x.usage||{},R=null!==(c=null!==(d=E.promptTokens)&&void 0!==d?d:E.prompt_tokens)&&void 0!==c?c:0,U=null!==(u=null!==(h=E.completionTokens)&&void 0!==h?h:E.completion_tokens)&&void 0!==u?u:0,$=null!==(p=null!==(g=E.totalTokens)&&void 0!==g?g:E.total_tokens)&&void 0!==p?p:U,D=Date.now(),H=D-l,z=U>0?U:0,J={startTime:l,endTime:D,elapsedTime:H,tokenCount:z,tokensPerSecond:H?Math.round(z/(H/1e3)*10)/10:null,isComplete:!0,timeToFirstToken:null,promptTokens:R,completionTokens:U,totalTokens:$,finishReason:x.finishReason};return M("assistant",b,J),b}catch(e){return S(e.message),M("assistant",e.message||"An error occurred"),null}finally{s.current=null,b(!1)}}),[f,v,w.streaming,y,C,k,x,M,E,R,T,j,S,b]),F=(0,n.useCallback)((async()=>(P(),!0)),[P]),_=(0,n.useCallback)((()=>{x([]),T()}),[x,T]),N=(0,n.useCallback)((()=>{k.current.length>0&&_()}),[k,_]),O=(0,n.useCallback)((()=>{0!==k.current.length&&window.confirm("Are you sure you want to clear the current chat?")&&(_(),I({type:"info",message:"Chat has been cleared"}))}),[k,_,I]),U=(0,n.useCallback)((()=>{const e=k.current;if(e.length)try{const t=e.map((e=>{const t="user"===e.role?"You":"assistant"===e.role?(null==v?void 0:v.name)||"Assistant":e.role;let s="";return"string"==typeof e.content?s=e.content:Array.isArray(e.content)&&(s=e.content.map((e=>"text"===e.type?e.text:"[Image]")).join("\n")),`${t}: ${s}\n`})).join(""),s=new Blob([t],{type:"text/plain"}),n=URL.createObjectURL(s),o=document.createElement("a");o.href=n,o.download=`chat_${(new Date).toISOString().replace(/:/g,"-")}.txt`,document.body.appendChild(o),o.click(),I({type:"success",message:"Chat downloaded successfully"}),document.body.removeChild(o),URL.revokeObjectURL(n)}catch(e){I({type:"error",message:"Failed to download chat. Please try again."})}}),[k,v,I]),$=(0,n.useCallback)((e=>{}),[]),D=(0,n.useMemo)((()=>({sendMessage:L,stopGeneration:F,addMessageToHistory:M,clearChat:_,newChat:N,resetChat:O,downloadChat:U,getOrCreateConversation:$,setTokenMetricsForLastMessage:A})),[L,F,M,_,N,O,U,$,A]);return(0,p.jsx)(g.Provider,{value:D,children:t})}},92503:(e,t,s)=>{s.d(t,{P:()=>i,h:()=>c});var n=s(65043),o=s(52932),r=s(36514),a=s(70579);const l=(0,n.createContext)(),i=()=>{const e=(0,n.useContext)(l);if(void 0===e)throw new Error("useChatState must be used within a ChatStateProvider");return e},c=e=>{let{children:t}=e;const{chatHistory:s,chatHistoryRef:i}=(0,o.m)(),{isWaitingForResponse:c,error:d}=(0,r.A)(),u=(0,n.useMemo)((()=>({chatHistory:s,chatHistoryRef:i,isWaitingForResponse:c,error:d})),[s,i,c,d]);return(0,a.jsx)(l.Provider,{value:u,children:t})}},96377:(e,t,s)=>{s.d(t,{N7:()=>p,fn:()=>h,lx:()=>g});var n=s(65043),o=s(91578),r=s(94916),a=s(35016),l=s(72152),i=s(47035),c=s(50578),d=s(70579);const u=(0,n.createContext)(),m=(0,n.createContext)(),h=()=>{const e=(0,n.useContext)(u);if(void 0===e)throw new Error("useModel must be used within a ModelProvider");return e},p=()=>{const e=(0,n.useContext)(m);if(void 0===e)throw new Error("useModelFilter must be used within a ModelProvider");return e},g=e=>{let{children:t}=e;const{cacheEnabled:h}=(0,l.Y)(),{apiUrl:p}=(0,o.g)(),{idToken:g}=(0,a.A)(),{showToast:f}=(0,i.d)(),[v,w]=(0,n.useState)([]),[y,C]=(0,n.useState)({}),[k,x]=(0,n.useState)([]),[M,b]=(0,r.M)("selectedModel",null),[S,T]=(0,n.useState)(!0),[j,A]=(0,n.useState)(null),[E,P]=(0,r.M)("showExperimental",!1),[I,R]=(0,n.useState)({search:"",categories:{Chat:!0,Image:!0,Embedding:!0}}),[,L,F]=(0,c.M3)("models");(0,n.useEffect)((()=>{S?L():F()}),[S,L,F]);const _=(0,n.useCallback)((e=>e&&e.timestamp&&Date.now()-e.timestamp<432e6&&e.allModels&&e.processedModels&&e.experimentalModels),[]);(0,n.useEffect)((()=>{if("undefined"!=typeof window)return window.isCacheValid=_,()=>{delete window.isCacheValid}}),[_]);const N=(0,n.useCallback)((e=>{try{const t={allModels:e.allModels,processedModels:e.processedModels,experimentalModels:e.experimentalModels,timestamp:Date.now()};localStorage.setItem("modelDropdownCache",JSON.stringify(t))}catch(e){}}),[]),O=(0,n.useCallback)(((e,t)=>{R((s=>({...s,categories:{...s.categories,[e]:t}})))}),[]),U=(0,n.useCallback)((e=>{R((t=>({...t,search:e})))}),[]),$=(0,n.useCallback)((e=>{(null==M?void 0:M.id)!==(null==e?void 0:e.id)&&b(e)}),[M,b]),D=(0,n.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;T(!0),A(null);try{const n={Accept:"application/json"};if(e){const e=t||g;e&&(n.Authorization=`Bearer ${e}`)}const o=new URL("/api/models/classified",p).toString(),r=await fetch(o,{headers:n});if(!r.ok){let e=`Error fetching models: ${r.status}`;throw new Error(e)}const a=await r.json(),l=new Worker(new URL(s.p+s.u(6961),s.b),{type:void 0});l.postMessage(a),l.onmessage=e=>{let{data:t}=e;if(t.error)A(t.error),f({type:"error",message:t.error});else{const{allModels:e,processedModels:s,experimentalModels:n}=t;if(h){const t=localStorage.getItem("modelDropdownCache");let o;try{o=JSON.parse(t)}catch{o=null}(!o||JSON.stringify(o.allModels)!==JSON.stringify(e)||JSON.stringify(o.processedModels)!==JSON.stringify(s)||JSON.stringify(o.experimentalModels)!==JSON.stringify(n))&&(w(e),C(s),x(n),N({allModels:e,processedModels:s,experimentalModels:n}))}else w(e),C(s),x(n)}T(!1),l.terminate()},l.onerror=e=>{A(e.message),f({type:"error",message:e.message}),T(!1),l.terminate()}}catch(e){A(e.message||"Failed to load model data"),f({type:"error",message:e.message||"Failed to load model data"})}}),[p,N,g,h,f]),H=(0,n.useRef)(!1),z=(0,n.useRef)(!1);(0,n.useEffect)((()=>{if(!H.current){if(h){const e=localStorage.getItem("modelDropdownCache");let t;try{t=JSON.parse(e)}catch{t=null}t&&window.isCacheValid(t)&&(w(t.allModels),C(t.processedModels),x(t.experimentalModels),T(!1))}let e=null;try{e=localStorage.getItem("idToken")}catch{}e?(z.current=!0,D(!0,e)):D(!1),H.current=!0}}),[]),(0,n.useEffect)((()=>{H.current&&g&&!z.current&&(z.current=!0,D(!0))}),[g,D]),(0,n.useEffect)((()=>{!M&&v.length>0&&b(v[0])}),[v,M,b]);const J=(0,n.useCallback)((()=>{P((e=>!e))}),[P]),W=(0,n.useMemo)((()=>({allModels:v,processedModels:y,experimentalModels:k,selectedModel:M,isLoading:S,error:j,showExperimental:E,isExperimentalModelsEnabled:E,toggleExperimentalModels:J,setShowExperimental:P,selectModel:$,refreshModels:D})),[v,y,k,M,S,j,E,J,P,$,D]),B=(0,n.useMemo)((()=>({modelFilter:I,updateCategoryFilter:O,updateSearchFilter:U})),[I,O,U]);return(0,d.jsx)(u.Provider,{value:W,children:(0,d.jsx)(m.Provider,{value:B,children:t})})}}}]);
//# sourceMappingURL=main-52f0199e.03e4000714.v1_8_5.js.map