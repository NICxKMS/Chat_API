{"version":3,"file":"useProfilePicture-Ba4pQBF9.js","sources":["../../src/hooks/useProfilePicture.jsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useLocalStorage } from './useLocalStorage';\r\n\r\n// Time-to-live for cache entries (1 day in milliseconds)\r\nconst TTL = 24 * 60 * 60 * 1000;\r\n\r\n/**\r\n * Custom hook to fetch and cache user profile picture with a 1-day TTL.\r\n * @param {string} imageUrl - The URL to fetch the profile picture from.\r\n * @returns {{ profilePicture: string | null, loading: boolean, error: any }}\r\n */\r\nexport const useProfilePicture = (imageUrl) => {\r\n  const cacheKey = `profilePicture_${imageUrl}`;\r\n  // cachedEntry is either null, a string (legacy), or { data, timestamp }\r\n  const [cachedEntry, setCachedEntry] = useLocalStorage(cacheKey, null);\r\n  const [profilePicture, setProfilePicture] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    if (!imageUrl) {\r\n      // No URL: clear state\r\n      setProfilePicture(null);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    // Validate cache entry\r\n    let entry = cachedEntry;\r\n    if (entry) {\r\n      // Legacy format: string\r\n      if (typeof entry === 'string') {\r\n        const wrapped = { data: entry, timestamp: Date.now() };\r\n        setCachedEntry(wrapped);\r\n        entry = wrapped;\r\n      }\r\n      // TTL check\r\n      if (\r\n        entry.timestamp &&\r\n        Date.now() - entry.timestamp < TTL &&\r\n        entry.data\r\n      ) {\r\n        setProfilePicture(entry.data);\r\n        setLoading(false);\r\n        return;\r\n      }\r\n      // Expired cache\r\n      setCachedEntry(null);\r\n    }\r\n\r\n    // Fetch and cache new image\r\n    setLoading(true);\r\n    fetch(imageUrl)\r\n      .then((response) => {\r\n        if (!response.ok) throw new Error(`Failed to fetch image: ${response.status}`);\r\n        return response.blob();\r\n      })\r\n      .then(\r\n        (blob) =>\r\n          new Promise((resolve, reject) => {\r\n            const reader = new FileReader();\r\n            reader.onloadend = () => resolve(reader.result);\r\n            reader.onerror = reject;\r\n            reader.readAsDataURL(blob);\r\n          })\r\n      )\r\n      .then((dataUrl) => {\r\n        if (!isMounted) return;\r\n        const entryToCache = { data: dataUrl, timestamp: Date.now() };\r\n        setCachedEntry(entryToCache);\r\n        setProfilePicture(dataUrl);\r\n      })\r\n      .catch((err) => {\r\n        if (!isMounted) return;\r\n        console.error('Error fetching and caching profile image:', err);\r\n        setError(err);\r\n      })\r\n      .finally(() => {\r\n        if (!isMounted) return;\r\n        setLoading(false);\r\n      });\r\n\r\n    return () => {\r\n      isMounted = false;\r\n    };\r\n  }, [imageUrl, cachedEntry, setCachedEntry]);\r\n\r\n  return { profilePicture, loading, error };\r\n}; "],"names":["useProfilePicture","imageUrl","cacheKey","cachedEntry","setCachedEntry","useLocalStorage","profilePicture","setProfilePicture","useState","loading","setLoading","error","setError","useEffect","isMounted","entry","wrapped","data","timestamp","Date","now","then","response","ok","Error","status","blob","Promise","resolve","reject","reader","FileReader","onloadend","result","onerror","readAsDataURL","dataUrl","entryToCache","catch","err","finally"],"mappings":"oFAIA,MAOaA,EAAkCC,IACvCC,MAAAA,EAAW,kBAAkBD,KAE5BE,EAAaC,GAAkBC,EAAgBH,EAAU,OACzDI,EAAgBC,GAAqBC,EAAAA,SAAS,OAC9CC,EAASC,GAAcF,EAAAA,UAAS,IAChCG,EAAOC,GAAYJ,EAAAA,SAAS,MAuE5B,OArEPK,EAAAA,WAAU,KACR,IAAIC,GAAY,EAChB,IAAKb,EAIH,OAFAM,EAAkB,WAClBG,GAAW,GAKb,IAAIK,EAAQZ,EACZ,GAAIY,EAAO,CAEL,GAAiB,iBAAVA,EAAoB,CAC7B,MAAMC,EAAU,CAAEC,KAAMF,EAAOG,UAAWC,KAAKC,OAC/ChB,EAAeY,GACPA,EAAAA,CAAAA,CAIRD,GAAAA,EAAMG,WACNC,KAAKC,MAAQL,EAAMG,UApCf,OAqCJH,EAAME,KAIN,OAFAV,EAAkBQ,EAAME,WACxBP,GAAW,GAIbN,EAAe,KAAI,CAmCrB,OA/BAM,GAAW,GACLT,MAAAA,GACHoB,MAAmBC,IACd,IAACA,EAASC,GAAI,MAAM,IAAIC,MAAM,0BAA0BF,EAASG,UACrE,OAAOH,EAASI,MAAK,IAEtBL,MACEK,GACC,IAAIC,SAAQ,CAACC,EAASC,KACdC,MAAAA,EAAS,IAAIC,WACnBD,EAAOE,UAAY,IAAMJ,EAAQE,EAAOG,QACxCH,EAAOI,QAAUL,EACjBC,EAAOK,cAAcT,EAAI,MAG9BL,MAAkBe,IACjB,IAAKtB,EAAW,OAChB,MAAMuB,EAAe,CAAEpB,KAAMmB,EAASlB,UAAWC,KAAKC,OACtDhB,EAAeiC,GACf9B,EAAkB6B,EAAO,IAE1BE,OAAeC,IACTzB,GAELF,EAAS2B,EAAG,IAEbC,SAAQ,KACF1B,GACLJ,GAAW,EAAK,IAGb,KACOI,GAAA,CAAA,CACd,GACC,CAACb,EAAUE,EAAaC,IAEpB,CAAEE,iBAAgBG,UAASE,QAAM"}